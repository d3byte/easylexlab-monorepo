{"version":3,"sources":["../server/routes.js"],"names":["storage","diskStorage","destination","req","file","cb","filename","Date","now","extname","originalname","upload","routes","get","post","login","secret","getGroups","verifyPassword","recoverPassword","checkToken","sendFeedback","patch","updateInfo","single","res","User","findByIdAndUpdate","body","userName","$set","backgroundUrl","then","json","success","catch","status","message","err","changePassword","addGroup","getUser","learnWords","regCode","delete","addStudent","getGroup","addTest","changeName","deleteMsg","deleteGroup","removeStudent","getTests","getTest","addResult","updateResult","removeStack","newMsg","getNotifications","removeNotification"],"mappings":"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","file":"routes.js","sourcesContent":["import express from 'express';\nimport expressJWT from 'express-jwt';\nimport multer from 'multer';\nimport path from 'path';\n\nimport db from './models';\n\nimport secret from './secret';\n\n// Controller imports\nimport basicConstroller from './controllers/basicController';\nimport userController from './controllers/userController';\nimport groupController from './controllers/groupController';\nimport stackController from './controllers/stackController';\n\nconst storage = multer.diskStorage({\n    destination: function (req, file, cb) {\n        cb(null, 'uploads/')\n    },\n    filename: function (req, file, cb) {\n        cb(null, Date.now() + path.extname(file.originalname))\n    }\n});\n\nconst upload = multer({ storage: storage });\n\nconst routes = express();\n\n// Basic routes\nroutes.get('/', basicConstroller.get);\n\n// User routes\nroutes.post('/signup', userController.post);\nroutes.post('/login', userController.login);\nroutes.post('/groups', expressJWT({ secret }), userController.getGroups);\nroutes.post('/verifypassword', expressJWT({ secret }), userController.verifyPassword);\nroutes.post('/recover', userController.recoverPassword);\nroutes.post('/checktoken', userController.checkToken);\nroutes.post('/feedback', expressJWT({ secret }), userController.sendFeedback);\nroutes.patch('/newinfo', expressJWT({ secret }), userController.updateInfo);\nroutes.post('/upload-image', upload.single('image'), function (req, res) {\n    if(req.file.filename) {\n        db.User.findByIdAndUpdate(req.body.userName, {\n            $set: { backgroundUrl: req.file.filename }\n        }).then(user => {\n            return res.json({\n                success: true\n            });\n        }).catch(err => {\n            return res.status(500).json({\n                message: err\n            });\n        });\n    }\n});\nroutes.patch('/newpassword', expressJWT({ secret }), userController.changePassword);\nroutes.patch('/addgroup', expressJWT({ secret }), userController.addGroup);\nroutes.post('/user', expressJWT({ secret }), userController.getUser);\nroutes.patch('/words', expressJWT({ secret }), userController.learnWords);\n\n// Group routes\nroutes.post('/regcode', expressJWT({ secret }), groupController.regCode);\nroutes.post('/addgroup', expressJWT({ secret }), groupController.post);\nroutes.delete('/deletegroup', expressJWT({ secret }), groupController.delete);\nroutes.patch('/addstudent', groupController.addStudent);\nroutes.post('/getgroups', expressJWT({ secret }), groupController.getGroups);\nroutes.post('/getgroup', expressJWT({ secret }), groupController.getGroup);\nroutes.post('/addtest', expressJWT({ secret }), groupController.addTest);\nroutes.patch('/changename', expressJWT({ secret }), groupController.changeName);\nroutes.post('/deletemsg', expressJWT({ secret }), groupController.deleteMsg);\nroutes.post('/deletegroup', expressJWT({ secret }), groupController.deleteGroup);\nroutes.post('/removestudent', expressJWT({ secret }), groupController.removeStudent);\n\n\n// Stack routes\nroutes.post('/newstack', expressJWT({ secret }), stackController.post);\nroutes.post('/gettests', expressJWT({ secret }), stackController.getTests);\nroutes.post('/gettest', expressJWT({ secret }), stackController.getTest);\nroutes.patch('/addresult', expressJWT({ secret }), stackController.addResult);\nroutes.patch('/updateresult', expressJWT({ secret }), stackController.updateResult);\nroutes.post('/removetask', expressJWT({ secret }), stackController.removeStack);\n\n\n// Notification and message routes\nroutes.post('/newmsg', expressJWT({ secret }), groupController.newMsg);\nroutes.post('/getnotifs', expressJWT({ secret }), userController.getNotifications);\nroutes.post('/removenotif', expressJWT({ secret }), userController.removeNotification);\n\nexport default routes;\n"]}