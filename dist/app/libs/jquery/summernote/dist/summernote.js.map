{"version":3,"sources":["../../../../../../server/app/libs/jquery/summernote/dist/summernote.js"],"names":["factory","define","amd","window","jQuery","$","Array","prototype","reduce","callback","t","Object","len","length","k","value","arguments","TypeError","filter","func","res","thisArg","i","val","call","push","map","T","A","O","kValue","mappedValue","isSupportAmd","isFontInstalled","fontName","testFontName","$tester","css","position","left","top","fontSize","text","appendTo","document","body","originalWidth","width","remove","userAgent","navigator","isMSIE","test","browserVersion","matches","exec","parseFloat","agent","isMac","appVersion","indexOf","isFF","isWebkit","isSafari","jqueryVersion","fn","jquery","hasCodeMirror","require","specified","CodeMirror","isW3CRangeSupport","createRange","eq","itemA","itemB","eq2","peq2","propName","ok","fail","not","f","apply","and","fA","fB","item","self","a","idCounter","uniqueId","prefix","id","rect2bnd","rect","$document","scrollTop","scrollLeft","right","height","bottom","invertObject","obj","inverted","key","hasOwnProperty","namespaceToCamel","namespace","split","name","substring","toUpperCase","join","list","head","array","last","initial","slice","tail","find","pred","idx","all","inArray","contains","sum","memo","v","from","collection","result","clusterBy","aTail","aLast","compact","aResult","unique","results","next","prev","NBSP_CHAR","String","fromCharCode","ZERO_WIDTH_NBSP_CHAR","dom","isEditable","node","hasClass","isControlSizing","buildLayoutInfo","$editor","makeFinder","attr","sIdPrefix","editor","holder","data","editable","popover","handle","dialog","className","$base","options","$dialogHolder","dialogsInBody","dropzone","toolbar","codable","statusbar","makeLayoutInfo","descendant","$target","closest","is","makePredByNodeName","nodeName","isText","nodeType","isVoid","isPara","isLi","isPurePara","isTable","isInline","isBodyContainer","isList","isHr","isBlockquote","isCell","isAnchor","isParaInline","ancestor","isBodyInline","isBody","isClosestSibling","nodeA","nodeB","nextSibling","previousSibling","withClosestSiblings","siblings","blankHTML","nodeLength","nodeValue","childNodes","isEmpty","innerHTML","paddingBlankHTML","parentNode","singleChildAncestor","listAncestor","ancestors","el","lastAncestor","commonAncestor","n","listPrev","nodes","listNext","listDescendant","descendents","fnWalk","current","wrap","wrapperName","parent","wrapper","insertBefore","appendChild","insertAfter","preceding","appendChildNodes","aChild","each","child","isLeftEdgePoint","point","offset","isRightEdgePoint","isEdgePoint","isLeftEdgeOf","isRightEdgeOf","isLeftEdgePointOf","isRightEdgePointOf","hasChildren","prevPoint","isSkipInnerOffset","nextPoint","isSamePoint","pointA","pointB","isVisiblePoint","leftNode","rightNode","prevPointUntil","nextPointUntil","isCharPoint","ch","charAt","walkPoint","startPoint","endPoint","handler","isSkipOffset","makeOffsetPath","reverse","fromOffsetPath","offsets","splitNode","isSkipPaddingBlankHTML","isNotSplitEdgePoint","splitText","childNode","clone","cloneNode","splitTree","root","splitPoint","topAncestor","splitRoot","container","pivot","create","createElement","createText","createTextNode","isRemoveChild","removeNode","removeChild","removeWhile","replace","newNode","style","cssText","isTextarea","$node","stripLinebreaks","html","isNewlineOnBlock","markup","regexTag","match","endSlash","isEndOfInlineContainer","isBlockNode","trim","blank","emptyPara","isBlock","isDiv","isBR","isSpan","isB","isU","isS","isI","isImg","isEmptyAnchor","range","textRangeToPoint","textRange","isStart","parentElement","tester","createTextRange","prevContainer","moveToElementText","compareEndPoints","textRangeStart","curTextNode","collapse","firstChild","pointTester","duplicate","setEndPoint","textCount","dummy","cont","pointToTextRange","textRangeInfo","isCollapseToStart","prevTextNodes","collapseToStart","info","moveStart","WrappedRange","sc","so","ec","eo","nativeRange","w3cRange","setStart","setEnd","getPoints","getStartPoint","getEndPoint","select","nativeRng","selection","getSelection","rangeCount","removeAllRanges","addRange","normalize","getVisiblePoint","isLeftToRight","block","isCollapsed","includeAncestor","fullyContains","leftEdgeNodes","expand","startAncestor","endAncestor","boundaryPoints","isSameContainer","deleteContents","rng","emptyParents","makeIsOn","isOnEditable","isOnList","isOnAnchor","isOnCell","wrapBodyInlineWithPara","inlineSiblings","concat","para","insertNode","pasteHTML","contentsContainer","toString","getWordRange","findAfter","bookmark","s","path","e","paraBookmark","paras","getClientRects","anchorNode","getRangeAt","startContainer","startOffset","endContainer","endOffset","textRangeEnd","isTextNode","createFromNode","createFromNodeBefore","createFromNodeAfter","createFromBookmark","createFromParaBookmark","defaults","version","minHeight","maxHeight","focus","tabsize","styleWithSpan","disableLinkTarget","disableDragAndDrop","disableResizeEditor","disableResizeImage","shortcuts","textareaAutoSync","placeholder","prettifyHtml","iconPrefix","icons","font","bold","italic","underline","clear","strikethrough","superscript","subscript","image","floatLeft","floatRight","floatNone","shapeRounded","shapeCircle","shapeThumbnail","shapeNone","link","unlink","edit","table","hr","insert","lists","unordered","ordered","help","fullscreen","codeview","paragraph","outdent","indent","center","justify","color","recent","history","undo","redo","misc","check","codemirror","mode","htmlMode","lineNumbers","lang","direction","plugin","airMode","airPopover","styleTags","defaultFontName","fontNames","fontNamesIgnoreCheck","fontSizes","colors","lineHeights","insertTableMaxSize","col","row","maximumImageFileSize","oninit","onfocus","onblur","onenter","onkeyup","onkeydown","onImageUpload","onImageUploadError","onMediaDelete","onToolbarClick","onsubmit","onCreateLink","sLinkUrl","keyMap","pc","mac","size","resizeFull","resizeHalf","resizeQuarter","dragImageHere","dropImage","selectFromFiles","maximumFileSize","maximumFileSizeError","url","textToDisplay","openInNewWindow","normal","blockquote","pre","h1","h2","h3","h4","h5","h6","more","background","foreground","transparent","setTransparent","reset","resetToDefault","shortcut","close","textFormatting","action","paragraphFormatting","documentStyle","extraKeys","async","readFileAsDataURL","file","Deferred","deferred","extend","FileReader","onload","sDataURL","target","resolve","onerror","reject","readAsDataURL","promise","createImage","sUrl","filename","$img","one","off","detach","display","isEdit","keyCode","isMove","nameFromCode","code","History","$editable","stack","stackOffset","makeSnapshot","emptyBookmark","contents","applySnapshot","snapshot","recordUndo","Style","jQueryCSS","$obj","propertyNames","propertyName","fromNode","properties","styleInfo","parseInt","stylePara","styleNodes","expandClosestSibling","onlyPartialContains","nodesInRange","tails","elem","$cont","queryCommandState","aOrderedType","isUnordered","lineHeight","toFixed","anchor","Bullet","insertOrderedList","toggleList","insertUnorderedList","clustereds","wrapList","releaseList","listName","wrappedParas","diffLists","listNode","prevList","nextList","isEscapseToBody","releasedParas","headList","lastList","middleList","rootLists","rootList","listNodes","Typing","bullet","insertTab","tab","insertParagraph","nextPara","emptyAnchors","Table","isShift","cell","cells","nextCell","createTable","colCount","rowCount","tds","tdHTML","idxCol","trs","trHTML","idxRow","KEY_BOGUS","Editor","typing","saveRange","thenCollapse","saveNode","copy","restoreRange","restoreNode","index","currentStyle","styleFromNode","triggerOnBeforeChange","$holder","bindCustomEvent","triggerOnChange","beforeCommand","afterCommand","isPreventTrigger","commands","sCmd","execCommand","untab","insertImage","then","$image","Math","min","insertText","textNode","formatBlock","tagName","formatPara","spans","firstSpan","insertHorizontalRule","hrNode","removeBogus","bogusNode","bogusCharIdx","deleteData","removeData","createLink","linkInfo","linkUrl","linkText","isNewWindow","isTextChanged","anchors","removeAttr","startRange","endRange","getLinkInfo","$anchor","sObjColor","oColor","JSON","parse","foreColor","backColor","insertTable","sDim","dimension","floatMe","removeClass","addClass","imageShape","resize","resizeTo","pos","bKeepRatio","imageSize","newRatio","y","x","ratio","removeMedia","Button","update","$container","checkDropdownMenu","$btn","isChecked","btnState","selector","toggleClass","imgFloat","$fontname","selectedFont","$fontsize","$lineHeight","updateRecentColor","button","eventName","$color","$recentColor","colorInfo","stringify","sKey","Toolbar","$toolbar","buttonNode","activate","deactivate","updateFullscreen","bFullscreen","updateCodeview","isCodeview","get","setButtonState","isActive","$button","EDITABLE_PADDING","Statusbar","attach","layoutInfo","on","hStatusbarMousedown","event","preventDefault","stopPropagation","editableTop","currentTarget","nHeight","clientY","max","Popover","posFromPlaceholder","isAirMode","isLeftTop","$placeholder","outerHeight","showPopover","$popover","PX_POPOVER_ARROW_OFFSET_X","$linkPopover","href","hide","$imagePopover","$airPopover","bnd","children","Handle","hHandleMousedown","$handle","posStart","invoke","clientX","shiftKey","$selection","w","outerWidth","h","sizingText","Fullscreen","$window","$scrollbar","toggle","$codable","setsize","isFullscreen","trigger","cm","Codeview","sync","save","isActivated","cmEditor","fromTextArea","tern","server","TernServer","ternServer","updateArgHints","setSize","getValue","toTextArea","isChange","DragAndDrop","attachDragAndDropEvent","$dropzone","$dropzoneMessage","hasEditorSize","langInfo","add","dataTransfer","originalEvent","files","insertImages","insertNodefunc","summernote","types","type","content","getData","toLowerCase","Clipboard","$paste","opacity","ctrlKey","V","setTimeout","pasteByHook","before","pasteByEvent","dataURI","src","decodedData","atob","Uint8Array","charCodeAt","blob","Blob","pasteContent","empty","clipboardData","items","kind","getAsFile","LinkDialog","toggleBtn","isEnable","bindEnterKey","$input","ENTER","showLinkDialog","$dialog","$linkDialog","$linkText","$linkUrl","$linkBtn","$openInNewWindow","prop","modal","state","show","ImageDialog","showImageDialog","$imageDialog","$imageInput","$imageUrl","$imageBtn","replaceWith","click","HelpDialog","showHelpDialog","$helpDialog","EventHandler","modules","dragAndDrop","clipboard","linkDialog","imageDialog","helpDialog","moduleAndMethod","args","splits","hasSeparator","moduleName","methodName","module","getModule","method","callbacks","eventNamespace","hMousedown","hKeyupAndMouseup","hToolbarAndPopoverUpdate","updateStyleInfo","hScroll","hToolbarAndPopoverMousedown","hToolbarAndPopoverClick","parents","isFunction","pluginEvents","PX_PER_EM","hDimensionPickerMove","$picker","$dimensionDisplay","$catcher","$highlighted","$unhighlighted","posOffset","offsetX","undefined","posCatcher","pageX","pageY","offsetY","dim","c","ceil","r","bindKeyMap","keys","metaKey","altKey","keyName","pluginEvent","keyString","$catcherContainer","onInit","onFocus","onBlur","onKeydown","onKeyup","onMousedown","onEnter","onPaste","onBeforeCommand","onChange","attachCustomEvent","blur","keydown","keyup","changeEventName","submit","plugins","init","Renderer","tplButton","label","title","dropdown","tplIconButton","iconClassName","tplPopover","append","tplDialog","footer","tplDropdown","classes","tplButtonInfo","picture","fontname","realFontList","hasDefaultFont","fontsize","colorButtonLabel","colorButton","moreButton","ul","ol","leftButton","centerButton","rightButton","justifyButton","outdentButton","indentButton","tplPopovers","tplLinkPopover","linkButton","unlinkButton","tplImagePopover","fullButton","halfButton","quarterButton","roundedButton","circleButton","thumbnailButton","noneButton","removeButton","tplAirPopover","$content","group","$group","lenGroup","$notePopover","tplHandles","tplShortcut","keyClass","kbd","tplShortcutText","tplShortcutAction","tplShortcutPara","tplShortcutStyle","tplExtraShortcuts","tplShortcutTable","colClass","template","replaceMacKeys","sHtml","tplDialogInfo","imageLimitation","unit","floor","log","readableSize","pow","tplDialogs","dialogs","tplStatusbar","representShortcut","str","createTooltip","sPlacement","invertedKeyMap","$buttons","elBtn","sShortcut","tooltip","placement","createPalette","$palette","paletteContents","lenRow","buttons","lenCol","createLayoutByAirMode","createLayoutByFrame","prependTo","$editingArea","isContentEditable","groupName","groupButtons","btnLength","buttonInfo","$dialogContainer","hasNoteEditor","noteEditorFromHolder","createLayout","layoutInfoFromHolder","removeLayout","getTemplate","iconButton","addButtonInfo","addDialogInfo","dialogInfo","renderer","eventHandler","core","addPlugin","events","langs","locale","isExternalAPICalled","hasInitOptions","$first","first","params","destroy"],"mappings":"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","file":"summernote.js","sourcesContent":["/**\r\n * Super simple wysiwyg editor on Bootstrap v0.6.16\r\n * http://summernote.org/\r\n *\r\n * summernote.js\r\n * Copyright 2013-2015 Alan Hong. and other contributors\r\n * summernote may be freely distributed under the MIT license./\r\n *\r\n * Date: 2015-08-03T16:41Z\r\n */\r\n(function (factory) {\r\n  /* global define */\r\n  if (typeof define === 'function' && define.amd) {\r\n    // AMD. Register as an anonymous module.\r\n    define(['jquery'], factory);\r\n  } else {\r\n    // Browser globals: jQuery\r\n    factory(window.jQuery);\r\n  }\r\n}(function ($) {\r\n  \r\n\r\n\r\n  if (!Array.prototype.reduce) {\r\n    /**\r\n     * Array.prototype.reduce polyfill\r\n     *\r\n     * @param {Function} callback\r\n     * @param {Value} [initialValue]\r\n     * @return {Value}\r\n     *\r\n     * @see http://goo.gl/WNriQD\r\n     */\r\n    Array.prototype.reduce = function (callback) {\r\n      var t = Object(this), len = t.length >>> 0, k = 0, value;\r\n      if (arguments.length === 2) {\r\n        value = arguments[1];\r\n      } else {\r\n        while (k < len && !(k in t)) {\r\n          k++;\r\n        }\r\n        if (k >= len) {\r\n          throw new TypeError('Reduce of empty array with no initial value');\r\n        }\r\n        value = t[k++];\r\n      }\r\n      for (; k < len; k++) {\r\n        if (k in t) {\r\n          value = callback(value, t[k], k, t);\r\n        }\r\n      }\r\n      return value;\r\n    };\r\n  }\r\n\r\n  if ('function' !== typeof Array.prototype.filter) {\r\n    /**\r\n     * Array.prototype.filter polyfill\r\n     *\r\n     * @param {Function} func\r\n     * @return {Array}\r\n     *\r\n     * @see http://goo.gl/T1KFnq\r\n     */\r\n    Array.prototype.filter = function (func) {\r\n      var t = Object(this), len = t.length >>> 0;\r\n\r\n      var res = [];\r\n      var thisArg = arguments.length >= 2 ? arguments[1] : void 0;\r\n      for (var i = 0; i < len; i++) {\r\n        if (i in t) {\r\n          var val = t[i];\r\n          if (func.call(thisArg, val, i, t)) {\r\n            res.push(val);\r\n          }\r\n        }\r\n      }\r\n  \r\n      return res;\r\n    };\r\n  }\r\n\r\n  if (!Array.prototype.map) {\r\n    /**\r\n     * Array.prototype.map polyfill\r\n     *\r\n     * @param {Function} callback\r\n     * @return {Array}\r\n     *\r\n     * @see https://goo.gl/SMWaMK\r\n     */\r\n    Array.prototype.map = function (callback, thisArg) {\r\n      var T, A, k;\r\n      if (this === null) {\r\n        throw new TypeError(' this is null or not defined');\r\n      }\r\n\r\n      var O = Object(this);\r\n      var len = O.length >>> 0;\r\n      if (typeof callback !== 'function') {\r\n        throw new TypeError(callback + ' is not a function');\r\n      }\r\n  \r\n      if (arguments.length > 1) {\r\n        T = thisArg;\r\n      }\r\n  \r\n      A = new Array(len);\r\n      k = 0;\r\n  \r\n      while (k < len) {\r\n        var kValue, mappedValue;\r\n        if (k in O) {\r\n          kValue = O[k];\r\n          mappedValue = callback.call(T, kValue, k, O);\r\n          A[k] = mappedValue;\r\n        }\r\n        k++;\r\n      }\r\n      return A;\r\n    };\r\n  }\r\n\r\n  var isSupportAmd = typeof define === 'function' && define.amd;\r\n\r\n  /**\r\n   * returns whether font is installed or not.\r\n   *\r\n   * @param {String} fontName\r\n   * @return {Boolean}\r\n   */\r\n  var isFontInstalled = function (fontName) {\r\n    var testFontName = fontName === 'Comic Sans MS' ? 'Courier New' : 'Comic Sans MS';\r\n    var $tester = $('<div>').css({\r\n      position: 'absolute',\r\n      left: '-9999px',\r\n      top: '-9999px',\r\n      fontSize: '200px'\r\n    }).text('mmmmmmmmmwwwwwww').appendTo(document.body);\r\n\r\n    var originalWidth = $tester.css('fontFamily', testFontName).width();\r\n    var width = $tester.css('fontFamily', fontName + ',' + testFontName).width();\r\n\r\n    $tester.remove();\r\n\r\n    return originalWidth !== width;\r\n  };\r\n\r\n  var userAgent = navigator.userAgent;\r\n  var isMSIE = /MSIE|Trident/i.test(userAgent);\r\n  var browserVersion;\r\n  if (isMSIE) {\r\n    var matches = /MSIE (\\d+[.]\\d+)/.exec(userAgent);\r\n    if (matches) {\r\n      browserVersion = parseFloat(matches[1]);\r\n    }\r\n    matches = /Trident\\/.*rv:([0-9]{1,}[\\.0-9]{0,})/.exec(userAgent);\r\n    if (matches) {\r\n      browserVersion = parseFloat(matches[1]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @class core.agent\r\n   *\r\n   * Object which check platform and agent\r\n   *\r\n   * @singleton\r\n   * @alternateClassName agent\r\n   */\r\n  var agent = {\r\n    /** @property {Boolean} [isMac=false] true if this agent is Mac  */\r\n    isMac: navigator.appVersion.indexOf('Mac') > -1,\r\n    /** @property {Boolean} [isMSIE=false] true if this agent is a Internet Explorer  */\r\n    isMSIE: isMSIE,\r\n    /** @property {Boolean} [isFF=false] true if this agent is a Firefox  */\r\n    isFF: /firefox/i.test(userAgent),\r\n    isWebkit: /webkit/i.test(userAgent),\r\n    /** @property {Boolean} [isSafari=false] true if this agent is a Safari  */\r\n    isSafari: /safari/i.test(userAgent),\r\n    /** @property {Float} browserVersion current browser version  */\r\n    browserVersion: browserVersion,\r\n    /** @property {String} jqueryVersion current jQuery version string  */\r\n    jqueryVersion: parseFloat($.fn.jquery),\r\n    isSupportAmd: isSupportAmd,\r\n    hasCodeMirror: isSupportAmd ? require.specified('CodeMirror') : !!window.CodeMirror,\r\n    isFontInstalled: isFontInstalled,\r\n    isW3CRangeSupport: !!document.createRange\r\n  };\r\n\r\n  /**\r\n   * @class core.func\r\n   *\r\n   * func utils (for high-order func's arg)\r\n   *\r\n   * @singleton\r\n   * @alternateClassName func\r\n   */\r\n  var func = (function () {\r\n    var eq = function (itemA) {\r\n      return function (itemB) {\r\n        return itemA === itemB;\r\n      };\r\n    };\r\n\r\n    var eq2 = function (itemA, itemB) {\r\n      return itemA === itemB;\r\n    };\r\n\r\n    var peq2 = function (propName) {\r\n      return function (itemA, itemB) {\r\n        return itemA[propName] === itemB[propName];\r\n      };\r\n    };\r\n\r\n    var ok = function () {\r\n      return true;\r\n    };\r\n\r\n    var fail = function () {\r\n      return false;\r\n    };\r\n\r\n    var not = function (f) {\r\n      return function () {\r\n        return !f.apply(f, arguments);\r\n      };\r\n    };\r\n\r\n    var and = function (fA, fB) {\r\n      return function (item) {\r\n        return fA(item) && fB(item);\r\n      };\r\n    };\r\n\r\n    var self = function (a) {\r\n      return a;\r\n    };\r\n\r\n    var idCounter = 0;\r\n\r\n    /**\r\n     * generate a globally-unique id\r\n     *\r\n     * @param {String} [prefix]\r\n     */\r\n    var uniqueId = function (prefix) {\r\n      var id = ++idCounter + '';\r\n      return prefix ? prefix + id : id;\r\n    };\r\n\r\n    /**\r\n     * returns bnd (bounds) from rect\r\n     *\r\n     * - IE Compatability Issue: http://goo.gl/sRLOAo\r\n     * - Scroll Issue: http://goo.gl/sNjUc\r\n     *\r\n     * @param {Rect} rect\r\n     * @return {Object} bounds\r\n     * @return {Number} bounds.top\r\n     * @return {Number} bounds.left\r\n     * @return {Number} bounds.width\r\n     * @return {Number} bounds.height\r\n     */\r\n    var rect2bnd = function (rect) {\r\n      var $document = $(document);\r\n      return {\r\n        top: rect.top + $document.scrollTop(),\r\n        left: rect.left + $document.scrollLeft(),\r\n        width: rect.right - rect.left,\r\n        height: rect.bottom - rect.top\r\n      };\r\n    };\r\n\r\n    /**\r\n     * returns a copy of the object where the keys have become the values and the values the keys.\r\n     * @param {Object} obj\r\n     * @return {Object}\r\n     */\r\n    var invertObject = function (obj) {\r\n      var inverted = {};\r\n      for (var key in obj) {\r\n        if (obj.hasOwnProperty(key)) {\r\n          inverted[obj[key]] = key;\r\n        }\r\n      }\r\n      return inverted;\r\n    };\r\n\r\n    /**\r\n     * @param {String} namespace\r\n     * @param {String} [prefix]\r\n     * @return {String}\r\n     */\r\n    var namespaceToCamel = function (namespace, prefix) {\r\n      prefix = prefix || '';\r\n      return prefix + namespace.split('.').map(function (name) {\r\n        return name.substring(0, 1).toUpperCase() + name.substring(1);\r\n      }).join('');\r\n    };\r\n\r\n    return {\r\n      eq: eq,\r\n      eq2: eq2,\r\n      peq2: peq2,\r\n      ok: ok,\r\n      fail: fail,\r\n      self: self,\r\n      not: not,\r\n      and: and,\r\n      uniqueId: uniqueId,\r\n      rect2bnd: rect2bnd,\r\n      invertObject: invertObject,\r\n      namespaceToCamel: namespaceToCamel\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * @class core.list\r\n   *\r\n   * list utils\r\n   *\r\n   * @singleton\r\n   * @alternateClassName list\r\n   */\r\n  var list = (function () {\r\n    /**\r\n     * returns the first item of an array.\r\n     *\r\n     * @param {Array} array\r\n     */\r\n    var head = function (array) {\r\n      return array[0];\r\n    };\r\n\r\n    /**\r\n     * returns the last item of an array.\r\n     *\r\n     * @param {Array} array\r\n     */\r\n    var last = function (array) {\r\n      return array[array.length - 1];\r\n    };\r\n\r\n    /**\r\n     * returns everything but the last entry of the array.\r\n     *\r\n     * @param {Array} array\r\n     */\r\n    var initial = function (array) {\r\n      return array.slice(0, array.length - 1);\r\n    };\r\n\r\n    /**\r\n     * returns the rest of the items in an array.\r\n     *\r\n     * @param {Array} array\r\n     */\r\n    var tail = function (array) {\r\n      return array.slice(1);\r\n    };\r\n\r\n    /**\r\n     * returns item of array\r\n     */\r\n    var find = function (array, pred) {\r\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\r\n        var item = array[idx];\r\n        if (pred(item)) {\r\n          return item;\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * returns true if all of the values in the array pass the predicate truth test.\r\n     */\r\n    var all = function (array, pred) {\r\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\r\n        if (!pred(array[idx])) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    /**\r\n     * returns index of item\r\n     */\r\n    var indexOf = function (array, item) {\r\n      return $.inArray(item, array);\r\n    };\r\n\r\n    /**\r\n     * returns true if the value is present in the list.\r\n     */\r\n    var contains = function (array, item) {\r\n      return indexOf(array, item) !== -1;\r\n    };\r\n\r\n    /**\r\n     * get sum from a list\r\n     *\r\n     * @param {Array} array - array\r\n     * @param {Function} fn - iterator\r\n     */\r\n    var sum = function (array, fn) {\r\n      fn = fn || func.self;\r\n      return array.reduce(function (memo, v) {\r\n        return memo + fn(v);\r\n      }, 0);\r\n    };\r\n  \r\n    /**\r\n     * returns a copy of the collection with array type.\r\n     * @param {Collection} collection - collection eg) node.childNodes, ...\r\n     */\r\n    var from = function (collection) {\r\n      var result = [], idx = -1, length = collection.length;\r\n      while (++idx < length) {\r\n        result[idx] = collection[idx];\r\n      }\r\n      return result;\r\n    };\r\n  \r\n    /**\r\n     * cluster elements by predicate function.\r\n     *\r\n     * @param {Array} array - array\r\n     * @param {Function} fn - predicate function for cluster rule\r\n     * @param {Array[]}\r\n     */\r\n    var clusterBy = function (array, fn) {\r\n      if (!array.length) { return []; }\r\n      var aTail = tail(array);\r\n      return aTail.reduce(function (memo, v) {\r\n        var aLast = last(memo);\r\n        if (fn(last(aLast), v)) {\r\n          aLast[aLast.length] = v;\r\n        } else {\r\n          memo[memo.length] = [v];\r\n        }\r\n        return memo;\r\n      }, [[head(array)]]);\r\n    };\r\n  \r\n    /**\r\n     * returns a copy of the array with all falsy values removed\r\n     *\r\n     * @param {Array} array - array\r\n     * @param {Function} fn - predicate function for cluster rule\r\n     */\r\n    var compact = function (array) {\r\n      var aResult = [];\r\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\r\n        if (array[idx]) { aResult.push(array[idx]); }\r\n      }\r\n      return aResult;\r\n    };\r\n\r\n    /**\r\n     * produces a duplicate-free version of the array\r\n     *\r\n     * @param {Array} array\r\n     */\r\n    var unique = function (array) {\r\n      var results = [];\r\n\r\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\r\n        if (!contains(results, array[idx])) {\r\n          results.push(array[idx]);\r\n        }\r\n      }\r\n\r\n      return results;\r\n    };\r\n\r\n    /**\r\n     * returns next item.\r\n     * @param {Array} array\r\n     */\r\n    var next = function (array, item) {\r\n      var idx = indexOf(array, item);\r\n      if (idx === -1) { return null; }\r\n\r\n      return array[idx + 1];\r\n    };\r\n\r\n    /**\r\n     * returns prev item.\r\n     * @param {Array} array\r\n     */\r\n    var prev = function (array, item) {\r\n      var idx = indexOf(array, item);\r\n      if (idx === -1) { return null; }\r\n\r\n      return array[idx - 1];\r\n    };\r\n  \r\n    return { head: head, last: last, initial: initial, tail: tail,\r\n             prev: prev, next: next, find: find, contains: contains,\r\n             all: all, sum: sum, from: from,\r\n             clusterBy: clusterBy, compact: compact, unique: unique };\r\n  })();\r\n\r\n\r\n  var NBSP_CHAR = String.fromCharCode(160);\r\n  var ZERO_WIDTH_NBSP_CHAR = '\\ufeff';\r\n\r\n  /**\r\n   * @class core.dom\r\n   *\r\n   * Dom functions\r\n   *\r\n   * @singleton\r\n   * @alternateClassName dom\r\n   */\r\n  var dom = (function () {\r\n    /**\r\n     * @method isEditable\r\n     *\r\n     * returns whether node is `note-editable` or not.\r\n     *\r\n     * @param {Node} node\r\n     * @return {Boolean}\r\n     */\r\n    var isEditable = function (node) {\r\n      return node && $(node).hasClass('note-editable');\r\n    };\r\n\r\n    /**\r\n     * @method isControlSizing\r\n     *\r\n     * returns whether node is `note-control-sizing` or not.\r\n     *\r\n     * @param {Node} node\r\n     * @return {Boolean}\r\n     */\r\n    var isControlSizing = function (node) {\r\n      return node && $(node).hasClass('note-control-sizing');\r\n    };\r\n\r\n    /**\r\n     * @method  buildLayoutInfo\r\n     *\r\n     * build layoutInfo from $editor(.note-editor)\r\n     *\r\n     * @param {jQuery} $editor\r\n     * @return {Object}\r\n     * @return {Function} return.editor\r\n     * @return {Node} return.dropzone\r\n     * @return {Node} return.toolbar\r\n     * @return {Node} return.editable\r\n     * @return {Node} return.codable\r\n     * @return {Node} return.popover\r\n     * @return {Node} return.handle\r\n     * @return {Node} return.dialog\r\n     */\r\n    var buildLayoutInfo = function ($editor) {\r\n      var makeFinder;\r\n\r\n      // air mode\r\n      if ($editor.hasClass('note-air-editor')) {\r\n        var id = list.last($editor.attr('id').split('-'));\r\n        makeFinder = function (sIdPrefix) {\r\n          return function () { return $(sIdPrefix + id); };\r\n        };\r\n\r\n        return {\r\n          editor: function () { return $editor; },\r\n          holder : function () { return $editor.data('holder'); },\r\n          editable: function () { return $editor; },\r\n          popover: makeFinder('#note-popover-'),\r\n          handle: makeFinder('#note-handle-'),\r\n          dialog: makeFinder('#note-dialog-')\r\n        };\r\n\r\n        // frame mode\r\n      } else {\r\n        makeFinder = function (className, $base) {\r\n          $base = $base || $editor;\r\n          return function () { return $base.find(className); };\r\n        };\r\n\r\n        var options = $editor.data('options');\r\n        var $dialogHolder = (options && options.dialogsInBody) ? $(document.body) : null;\r\n\r\n        return {\r\n          editor: function () { return $editor; },\r\n          holder : function () { return $editor.data('holder'); },\r\n          dropzone: makeFinder('.note-dropzone'),\r\n          toolbar: makeFinder('.note-toolbar'),\r\n          editable: makeFinder('.note-editable'),\r\n          codable: makeFinder('.note-codable'),\r\n          statusbar: makeFinder('.note-statusbar'),\r\n          popover: makeFinder('.note-popover'),\r\n          handle: makeFinder('.note-handle'),\r\n          dialog: makeFinder('.note-dialog', $dialogHolder)\r\n        };\r\n      }\r\n    };\r\n\r\n    /**\r\n     * returns makeLayoutInfo from editor's descendant node.\r\n     *\r\n     * @private\r\n     * @param {Node} descendant\r\n     * @return {Object}\r\n     */\r\n    var makeLayoutInfo = function (descendant) {\r\n      var $target = $(descendant).closest('.note-editor, .note-air-editor, .note-air-layout');\r\n\r\n      if (!$target.length) {\r\n        return null;\r\n      }\r\n\r\n      var $editor;\r\n      if ($target.is('.note-editor, .note-air-editor')) {\r\n        $editor = $target;\r\n      } else {\r\n        $editor = $('#note-editor-' + list.last($target.attr('id').split('-')));\r\n      }\r\n\r\n      return buildLayoutInfo($editor);\r\n    };\r\n\r\n    /**\r\n     * @method makePredByNodeName\r\n     *\r\n     * returns predicate which judge whether nodeName is same\r\n     *\r\n     * @param {String} nodeName\r\n     * @return {Function}\r\n     */\r\n    var makePredByNodeName = function (nodeName) {\r\n      nodeName = nodeName.toUpperCase();\r\n      return function (node) {\r\n        return node && node.nodeName.toUpperCase() === nodeName;\r\n      };\r\n    };\r\n\r\n    /**\r\n     * @method isText\r\n     *\r\n     *\r\n     *\r\n     * @param {Node} node\r\n     * @return {Boolean} true if node's type is text(3)\r\n     */\r\n    var isText = function (node) {\r\n      return node && node.nodeType === 3;\r\n    };\r\n\r\n    /**\r\n     * ex) br, col, embed, hr, img, input, ...\r\n     * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\r\n     */\r\n    var isVoid = function (node) {\r\n      return node && /^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase());\r\n    };\r\n\r\n    var isPara = function (node) {\r\n      if (isEditable(node)) {\r\n        return false;\r\n      }\r\n\r\n      // Chrome(v31.0), FF(v25.0.1) use DIV for paragraph\r\n      return node && /^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());\r\n    };\r\n\r\n    var isLi = makePredByNodeName('LI');\r\n\r\n    var isPurePara = function (node) {\r\n      return isPara(node) && !isLi(node);\r\n    };\r\n\r\n    var isTable = makePredByNodeName('TABLE');\r\n\r\n    var isInline = function (node) {\r\n      return !isBodyContainer(node) &&\r\n             !isList(node) &&\r\n             !isHr(node) &&\r\n             !isPara(node) &&\r\n             !isTable(node) &&\r\n             !isBlockquote(node);\r\n    };\r\n\r\n    var isList = function (node) {\r\n      return node && /^UL|^OL/.test(node.nodeName.toUpperCase());\r\n    };\r\n\r\n    var isHr = makePredByNodeName('HR');\r\n\r\n    var isCell = function (node) {\r\n      return node && /^TD|^TH/.test(node.nodeName.toUpperCase());\r\n    };\r\n\r\n    var isBlockquote = makePredByNodeName('BLOCKQUOTE');\r\n\r\n    var isBodyContainer = function (node) {\r\n      return isCell(node) || isBlockquote(node) || isEditable(node);\r\n    };\r\n\r\n    var isAnchor = makePredByNodeName('A');\r\n\r\n    var isParaInline = function (node) {\r\n      return isInline(node) && !!ancestor(node, isPara);\r\n    };\r\n\r\n    var isBodyInline = function (node) {\r\n      return isInline(node) && !ancestor(node, isPara);\r\n    };\r\n\r\n    var isBody = makePredByNodeName('BODY');\r\n\r\n    /**\r\n     * returns whether nodeB is closest sibling of nodeA\r\n     *\r\n     * @param {Node} nodeA\r\n     * @param {Node} nodeB\r\n     * @return {Boolean}\r\n     */\r\n    var isClosestSibling = function (nodeA, nodeB) {\r\n      return nodeA.nextSibling === nodeB ||\r\n             nodeA.previousSibling === nodeB;\r\n    };\r\n\r\n    /**\r\n     * returns array of closest siblings with node\r\n     *\r\n     * @param {Node} node\r\n     * @param {function} [pred] - predicate function\r\n     * @return {Node[]}\r\n     */\r\n    var withClosestSiblings = function (node, pred) {\r\n      pred = pred || func.ok;\r\n\r\n      var siblings = [];\r\n      if (node.previousSibling && pred(node.previousSibling)) {\r\n        siblings.push(node.previousSibling);\r\n      }\r\n      siblings.push(node);\r\n      if (node.nextSibling && pred(node.nextSibling)) {\r\n        siblings.push(node.nextSibling);\r\n      }\r\n      return siblings;\r\n    };\r\n\r\n    /**\r\n     * blank HTML for cursor position\r\n     * - [workaround] old IE only works with &nbsp;\r\n     * - [workaround] IE11 and other browser works with bogus br\r\n     */\r\n    var blankHTML = agent.isMSIE && agent.browserVersion < 11 ? '&nbsp;' : '<br>';\r\n\r\n    /**\r\n     * @method nodeLength\r\n     *\r\n     * returns #text's text size or element's childNodes size\r\n     *\r\n     * @param {Node} node\r\n     */\r\n    var nodeLength = function (node) {\r\n      if (isText(node)) {\r\n        return node.nodeValue.length;\r\n      }\r\n\r\n      return node.childNodes.length;\r\n    };\r\n\r\n    /**\r\n     * returns whether node is empty or not.\r\n     *\r\n     * @param {Node} node\r\n     * @return {Boolean}\r\n     */\r\n    var isEmpty = function (node) {\r\n      var len = nodeLength(node);\r\n\r\n      if (len === 0) {\r\n        return true;\r\n      } else if (!isText(node) && len === 1 && node.innerHTML === blankHTML) {\r\n        // ex) <p><br></p>, <span><br></span>\r\n        return true;\r\n      } else if (list.all(node.childNodes, isText) && node.innerHTML === '') {\r\n        // ex) <p></p>, <span></span>\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * padding blankHTML if node is empty (for cursor position)\r\n     */\r\n    var paddingBlankHTML = function (node) {\r\n      if (!isVoid(node) && !nodeLength(node)) {\r\n        node.innerHTML = blankHTML;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * find nearest ancestor predicate hit\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} pred - predicate function\r\n     */\r\n    var ancestor = function (node, pred) {\r\n      while (node) {\r\n        if (pred(node)) { return node; }\r\n        if (isEditable(node)) { break; }\r\n\r\n        node = node.parentNode;\r\n      }\r\n      return null;\r\n    };\r\n\r\n    /**\r\n     * find nearest ancestor only single child blood line and predicate hit\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} pred - predicate function\r\n     */\r\n    var singleChildAncestor = function (node, pred) {\r\n      node = node.parentNode;\r\n\r\n      while (node) {\r\n        if (nodeLength(node) !== 1) { break; }\r\n        if (pred(node)) { return node; }\r\n        if (isEditable(node)) { break; }\r\n\r\n        node = node.parentNode;\r\n      }\r\n      return null;\r\n    };\r\n\r\n    /**\r\n     * returns new array of ancestor nodes (until predicate hit).\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} [optional] pred - predicate function\r\n     */\r\n    var listAncestor = function (node, pred) {\r\n      pred = pred || func.fail;\r\n\r\n      var ancestors = [];\r\n      ancestor(node, function (el) {\r\n        if (!isEditable(el)) {\r\n          ancestors.push(el);\r\n        }\r\n\r\n        return pred(el);\r\n      });\r\n      return ancestors;\r\n    };\r\n\r\n    /**\r\n     * find farthest ancestor predicate hit\r\n     */\r\n    var lastAncestor = function (node, pred) {\r\n      var ancestors = listAncestor(node);\r\n      return list.last(ancestors.filter(pred));\r\n    };\r\n\r\n    /**\r\n     * returns common ancestor node between two nodes.\r\n     *\r\n     * @param {Node} nodeA\r\n     * @param {Node} nodeB\r\n     */\r\n    var commonAncestor = function (nodeA, nodeB) {\r\n      var ancestors = listAncestor(nodeA);\r\n      for (var n = nodeB; n; n = n.parentNode) {\r\n        if ($.inArray(n, ancestors) > -1) { return n; }\r\n      }\r\n      return null; // difference document area\r\n    };\r\n\r\n    /**\r\n     * listing all previous siblings (until predicate hit).\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} [optional] pred - predicate function\r\n     */\r\n    var listPrev = function (node, pred) {\r\n      pred = pred || func.fail;\r\n\r\n      var nodes = [];\r\n      while (node) {\r\n        if (pred(node)) { break; }\r\n        nodes.push(node);\r\n        node = node.previousSibling;\r\n      }\r\n      return nodes;\r\n    };\r\n\r\n    /**\r\n     * listing next siblings (until predicate hit).\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} [pred] - predicate function\r\n     */\r\n    var listNext = function (node, pred) {\r\n      pred = pred || func.fail;\r\n\r\n      var nodes = [];\r\n      while (node) {\r\n        if (pred(node)) { break; }\r\n        nodes.push(node);\r\n        node = node.nextSibling;\r\n      }\r\n      return nodes;\r\n    };\r\n\r\n    /**\r\n     * listing descendant nodes\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} [pred] - predicate function\r\n     */\r\n    var listDescendant = function (node, pred) {\r\n      var descendents = [];\r\n      pred = pred || func.ok;\r\n\r\n      // start DFS(depth first search) with node\r\n      (function fnWalk(current) {\r\n        if (node !== current && pred(current)) {\r\n          descendents.push(current);\r\n        }\r\n        for (var idx = 0, len = current.childNodes.length; idx < len; idx++) {\r\n          fnWalk(current.childNodes[idx]);\r\n        }\r\n      })(node);\r\n\r\n      return descendents;\r\n    };\r\n\r\n    /**\r\n     * wrap node with new tag.\r\n     *\r\n     * @param {Node} node\r\n     * @param {Node} tagName of wrapper\r\n     * @return {Node} - wrapper\r\n     */\r\n    var wrap = function (node, wrapperName) {\r\n      var parent = node.parentNode;\r\n      var wrapper = $('<' + wrapperName + '>')[0];\r\n\r\n      parent.insertBefore(wrapper, node);\r\n      wrapper.appendChild(node);\r\n\r\n      return wrapper;\r\n    };\r\n\r\n    /**\r\n     * insert node after preceding\r\n     *\r\n     * @param {Node} node\r\n     * @param {Node} preceding - predicate function\r\n     */\r\n    var insertAfter = function (node, preceding) {\r\n      var next = preceding.nextSibling, parent = preceding.parentNode;\r\n      if (next) {\r\n        parent.insertBefore(node, next);\r\n      } else {\r\n        parent.appendChild(node);\r\n      }\r\n      return node;\r\n    };\r\n\r\n    /**\r\n     * append elements.\r\n     *\r\n     * @param {Node} node\r\n     * @param {Collection} aChild\r\n     */\r\n    var appendChildNodes = function (node, aChild) {\r\n      $.each(aChild, function (idx, child) {\r\n        node.appendChild(child);\r\n      });\r\n      return node;\r\n    };\r\n\r\n    /**\r\n     * returns whether boundaryPoint is left edge or not.\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @return {Boolean}\r\n     */\r\n    var isLeftEdgePoint = function (point) {\r\n      return point.offset === 0;\r\n    };\r\n\r\n    /**\r\n     * returns whether boundaryPoint is right edge or not.\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @return {Boolean}\r\n     */\r\n    var isRightEdgePoint = function (point) {\r\n      return point.offset === nodeLength(point.node);\r\n    };\r\n\r\n    /**\r\n     * returns whether boundaryPoint is edge or not.\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @return {Boolean}\r\n     */\r\n    var isEdgePoint = function (point) {\r\n      return isLeftEdgePoint(point) || isRightEdgePoint(point);\r\n    };\r\n\r\n    /**\r\n     * returns wheter node is left edge of ancestor or not.\r\n     *\r\n     * @param {Node} node\r\n     * @param {Node} ancestor\r\n     * @return {Boolean}\r\n     */\r\n    var isLeftEdgeOf = function (node, ancestor) {\r\n      while (node && node !== ancestor) {\r\n        if (position(node) !== 0) {\r\n          return false;\r\n        }\r\n        node = node.parentNode;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    /**\r\n     * returns whether node is right edge of ancestor or not.\r\n     *\r\n     * @param {Node} node\r\n     * @param {Node} ancestor\r\n     * @return {Boolean}\r\n     */\r\n    var isRightEdgeOf = function (node, ancestor) {\r\n      while (node && node !== ancestor) {\r\n        if (position(node) !== nodeLength(node.parentNode) - 1) {\r\n          return false;\r\n        }\r\n        node = node.parentNode;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    /**\r\n     * returns whether point is left edge of ancestor or not.\r\n     * @param {BoundaryPoint} point\r\n     * @param {Node} ancestor\r\n     * @return {Boolean}\r\n     */\r\n    var isLeftEdgePointOf = function (point, ancestor) {\r\n      return isLeftEdgePoint(point) && isLeftEdgeOf(point.node, ancestor);\r\n    };\r\n\r\n    /**\r\n     * returns whether point is right edge of ancestor or not.\r\n     * @param {BoundaryPoint} point\r\n     * @param {Node} ancestor\r\n     * @return {Boolean}\r\n     */\r\n    var isRightEdgePointOf = function (point, ancestor) {\r\n      return isRightEdgePoint(point) && isRightEdgeOf(point.node, ancestor);\r\n    };\r\n\r\n    /**\r\n     * returns offset from parent.\r\n     *\r\n     * @param {Node} node\r\n     */\r\n    var position = function (node) {\r\n      var offset = 0;\r\n      while ((node = node.previousSibling)) {\r\n        offset += 1;\r\n      }\r\n      return offset;\r\n    };\r\n\r\n    var hasChildren = function (node) {\r\n      return !!(node && node.childNodes && node.childNodes.length);\r\n    };\r\n\r\n    /**\r\n     * returns previous boundaryPoint\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @param {Boolean} isSkipInnerOffset\r\n     * @return {BoundaryPoint}\r\n     */\r\n    var prevPoint = function (point, isSkipInnerOffset) {\r\n      var node, offset;\r\n\r\n      if (point.offset === 0) {\r\n        if (isEditable(point.node)) {\r\n          return null;\r\n        }\r\n\r\n        node = point.node.parentNode;\r\n        offset = position(point.node);\r\n      } else if (hasChildren(point.node)) {\r\n        node = point.node.childNodes[point.offset - 1];\r\n        offset = nodeLength(node);\r\n      } else {\r\n        node = point.node;\r\n        offset = isSkipInnerOffset ? 0 : point.offset - 1;\r\n      }\r\n\r\n      return {\r\n        node: node,\r\n        offset: offset\r\n      };\r\n    };\r\n\r\n    /**\r\n     * returns next boundaryPoint\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @param {Boolean} isSkipInnerOffset\r\n     * @return {BoundaryPoint}\r\n     */\r\n    var nextPoint = function (point, isSkipInnerOffset) {\r\n      var node, offset;\r\n\r\n      if (nodeLength(point.node) === point.offset) {\r\n        if (isEditable(point.node)) {\r\n          return null;\r\n        }\r\n\r\n        node = point.node.parentNode;\r\n        offset = position(point.node) + 1;\r\n      } else if (hasChildren(point.node)) {\r\n        node = point.node.childNodes[point.offset];\r\n        offset = 0;\r\n      } else {\r\n        node = point.node;\r\n        offset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;\r\n      }\r\n\r\n      return {\r\n        node: node,\r\n        offset: offset\r\n      };\r\n    };\r\n\r\n    /**\r\n     * returns whether pointA and pointB is same or not.\r\n     *\r\n     * @param {BoundaryPoint} pointA\r\n     * @param {BoundaryPoint} pointB\r\n     * @return {Boolean}\r\n     */\r\n    var isSamePoint = function (pointA, pointB) {\r\n      return pointA.node === pointB.node && pointA.offset === pointB.offset;\r\n    };\r\n\r\n    /**\r\n     * returns whether point is visible (can set cursor) or not.\r\n     * \r\n     * @param {BoundaryPoint} point\r\n     * @return {Boolean}\r\n     */\r\n    var isVisiblePoint = function (point) {\r\n      if (isText(point.node) || !hasChildren(point.node) || isEmpty(point.node)) {\r\n        return true;\r\n      }\r\n\r\n      var leftNode = point.node.childNodes[point.offset - 1];\r\n      var rightNode = point.node.childNodes[point.offset];\r\n      if ((!leftNode || isVoid(leftNode)) && (!rightNode || isVoid(rightNode))) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * @method prevPointUtil\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @param {Function} pred\r\n     * @return {BoundaryPoint}\r\n     */\r\n    var prevPointUntil = function (point, pred) {\r\n      while (point) {\r\n        if (pred(point)) {\r\n          return point;\r\n        }\r\n\r\n        point = prevPoint(point);\r\n      }\r\n\r\n      return null;\r\n    };\r\n\r\n    /**\r\n     * @method nextPointUntil\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @param {Function} pred\r\n     * @return {BoundaryPoint}\r\n     */\r\n    var nextPointUntil = function (point, pred) {\r\n      while (point) {\r\n        if (pred(point)) {\r\n          return point;\r\n        }\r\n\r\n        point = nextPoint(point);\r\n      }\r\n\r\n      return null;\r\n    };\r\n\r\n    /**\r\n     * returns whether point has character or not.\r\n     *\r\n     * @param {Point} point\r\n     * @return {Boolean}\r\n     */\r\n    var isCharPoint = function (point) {\r\n      if (!isText(point.node)) {\r\n        return false;\r\n      }\r\n\r\n      var ch = point.node.nodeValue.charAt(point.offset - 1);\r\n      return ch && (ch !== ' ' && ch !== NBSP_CHAR);\r\n    };\r\n\r\n    /**\r\n     * @method walkPoint\r\n     *\r\n     * @param {BoundaryPoint} startPoint\r\n     * @param {BoundaryPoint} endPoint\r\n     * @param {Function} handler\r\n     * @param {Boolean} isSkipInnerOffset\r\n     */\r\n    var walkPoint = function (startPoint, endPoint, handler, isSkipInnerOffset) {\r\n      var point = startPoint;\r\n\r\n      while (point) {\r\n        handler(point);\r\n\r\n        if (isSamePoint(point, endPoint)) {\r\n          break;\r\n        }\r\n\r\n        var isSkipOffset = isSkipInnerOffset &&\r\n                           startPoint.node !== point.node &&\r\n                           endPoint.node !== point.node;\r\n        point = nextPoint(point, isSkipOffset);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method makeOffsetPath\r\n     *\r\n     * return offsetPath(array of offset) from ancestor\r\n     *\r\n     * @param {Node} ancestor - ancestor node\r\n     * @param {Node} node\r\n     */\r\n    var makeOffsetPath = function (ancestor, node) {\r\n      var ancestors = listAncestor(node, func.eq(ancestor));\r\n      return ancestors.map(position).reverse();\r\n    };\r\n\r\n    /**\r\n     * @method fromOffsetPath\r\n     *\r\n     * return element from offsetPath(array of offset)\r\n     *\r\n     * @param {Node} ancestor - ancestor node\r\n     * @param {array} offsets - offsetPath\r\n     */\r\n    var fromOffsetPath = function (ancestor, offsets) {\r\n      var current = ancestor;\r\n      for (var i = 0, len = offsets.length; i < len; i++) {\r\n        if (current.childNodes.length <= offsets[i]) {\r\n          current = current.childNodes[current.childNodes.length - 1];\r\n        } else {\r\n          current = current.childNodes[offsets[i]];\r\n        }\r\n      }\r\n      return current;\r\n    };\r\n\r\n    /**\r\n     * @method splitNode\r\n     *\r\n     * split element or #text\r\n     *\r\n     * @param {BoundaryPoint} point\r\n     * @param {Object} [options]\r\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\r\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\r\n     * @return {Node} right node of boundaryPoint\r\n     */\r\n    var splitNode = function (point, options) {\r\n      var isSkipPaddingBlankHTML = options && options.isSkipPaddingBlankHTML;\r\n      var isNotSplitEdgePoint = options && options.isNotSplitEdgePoint;\r\n\r\n      // edge case\r\n      if (isEdgePoint(point) && (isText(point.node) || isNotSplitEdgePoint)) {\r\n        if (isLeftEdgePoint(point)) {\r\n          return point.node;\r\n        } else if (isRightEdgePoint(point)) {\r\n          return point.node.nextSibling;\r\n        }\r\n      }\r\n\r\n      // split #text\r\n      if (isText(point.node)) {\r\n        return point.node.splitText(point.offset);\r\n      } else {\r\n        var childNode = point.node.childNodes[point.offset];\r\n        var clone = insertAfter(point.node.cloneNode(false), point.node);\r\n        appendChildNodes(clone, listNext(childNode));\r\n\r\n        if (!isSkipPaddingBlankHTML) {\r\n          paddingBlankHTML(point.node);\r\n          paddingBlankHTML(clone);\r\n        }\r\n\r\n        return clone;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method splitTree\r\n     *\r\n     * split tree by point\r\n     *\r\n     * @param {Node} root - split root\r\n     * @param {BoundaryPoint} point\r\n     * @param {Object} [options]\r\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\r\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\r\n     * @return {Node} right node of boundaryPoint\r\n     */\r\n    var splitTree = function (root, point, options) {\r\n      // ex) [#text, <span>, <p>]\r\n      var ancestors = listAncestor(point.node, func.eq(root));\r\n\r\n      if (!ancestors.length) {\r\n        return null;\r\n      } else if (ancestors.length === 1) {\r\n        return splitNode(point, options);\r\n      }\r\n\r\n      return ancestors.reduce(function (node, parent) {\r\n        if (node === point.node) {\r\n          node = splitNode(point, options);\r\n        }\r\n\r\n        return splitNode({\r\n          node: parent,\r\n          offset: node ? dom.position(node) : nodeLength(parent)\r\n        }, options);\r\n      });\r\n    };\r\n\r\n    /**\r\n     * split point\r\n     *\r\n     * @param {Point} point\r\n     * @param {Boolean} isInline\r\n     * @return {Object}\r\n     */\r\n    var splitPoint = function (point, isInline) {\r\n      // find splitRoot, container\r\n      //  - inline: splitRoot is a child of paragraph\r\n      //  - block: splitRoot is a child of bodyContainer\r\n      var pred = isInline ? isPara : isBodyContainer;\r\n      var ancestors = listAncestor(point.node, pred);\r\n      var topAncestor = list.last(ancestors) || point.node;\r\n\r\n      var splitRoot, container;\r\n      if (pred(topAncestor)) {\r\n        splitRoot = ancestors[ancestors.length - 2];\r\n        container = topAncestor;\r\n      } else {\r\n        splitRoot = topAncestor;\r\n        container = splitRoot.parentNode;\r\n      }\r\n\r\n      // if splitRoot is exists, split with splitTree\r\n      var pivot = splitRoot && splitTree(splitRoot, point, {\r\n        isSkipPaddingBlankHTML: isInline,\r\n        isNotSplitEdgePoint: isInline\r\n      });\r\n\r\n      // if container is point.node, find pivot with point.offset\r\n      if (!pivot && container === point.node) {\r\n        pivot = point.node.childNodes[point.offset];\r\n      }\r\n\r\n      return {\r\n        rightNode: pivot,\r\n        container: container\r\n      };\r\n    };\r\n\r\n    var create = function (nodeName) {\r\n      return document.createElement(nodeName);\r\n    };\r\n\r\n    var createText = function (text) {\r\n      return document.createTextNode(text);\r\n    };\r\n\r\n    /**\r\n     * @method remove\r\n     *\r\n     * remove node, (isRemoveChild: remove child or not)\r\n     *\r\n     * @param {Node} node\r\n     * @param {Boolean} isRemoveChild\r\n     */\r\n    var remove = function (node, isRemoveChild) {\r\n      if (!node || !node.parentNode) { return; }\r\n      if (node.removeNode) { return node.removeNode(isRemoveChild); }\r\n\r\n      var parent = node.parentNode;\r\n      if (!isRemoveChild) {\r\n        var nodes = [];\r\n        var i, len;\r\n        for (i = 0, len = node.childNodes.length; i < len; i++) {\r\n          nodes.push(node.childNodes[i]);\r\n        }\r\n\r\n        for (i = 0, len = nodes.length; i < len; i++) {\r\n          parent.insertBefore(nodes[i], node);\r\n        }\r\n      }\r\n\r\n      parent.removeChild(node);\r\n    };\r\n\r\n    /**\r\n     * @method removeWhile\r\n     *\r\n     * @param {Node} node\r\n     * @param {Function} pred\r\n     */\r\n    var removeWhile = function (node, pred) {\r\n      while (node) {\r\n        if (isEditable(node) || !pred(node)) {\r\n          break;\r\n        }\r\n\r\n        var parent = node.parentNode;\r\n        remove(node);\r\n        node = parent;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method replace\r\n     *\r\n     * replace node with provided nodeName\r\n     *\r\n     * @param {Node} node\r\n     * @param {String} nodeName\r\n     * @return {Node} - new node\r\n     */\r\n    var replace = function (node, nodeName) {\r\n      if (node.nodeName.toUpperCase() === nodeName.toUpperCase()) {\r\n        return node;\r\n      }\r\n\r\n      var newNode = create(nodeName);\r\n\r\n      if (node.style.cssText) {\r\n        newNode.style.cssText = node.style.cssText;\r\n      }\r\n\r\n      appendChildNodes(newNode, list.from(node.childNodes));\r\n      insertAfter(newNode, node);\r\n      remove(node);\r\n\r\n      return newNode;\r\n    };\r\n\r\n    var isTextarea = makePredByNodeName('TEXTAREA');\r\n\r\n    /**\r\n     * @param {jQuery} $node\r\n     * @param {Boolean} [stripLinebreaks] - default: false\r\n     */\r\n    var value = function ($node, stripLinebreaks) {\r\n      var val = isTextarea($node[0]) ? $node.val() : $node.html();\r\n      if (stripLinebreaks) {\r\n        return val.replace(/[\\n\\r]/g, '');\r\n      }\r\n      return val;\r\n    };\r\n\r\n    /**\r\n     * @method html\r\n     *\r\n     * get the HTML contents of node\r\n     *\r\n     * @param {jQuery} $node\r\n     * @param {Boolean} [isNewlineOnBlock]\r\n     */\r\n    var html = function ($node, isNewlineOnBlock) {\r\n      var markup = value($node);\r\n\r\n      if (isNewlineOnBlock) {\r\n        var regexTag = /<(\\/?)(\\b(?!!)[^>\\s]*)(.*?)(\\s*\\/?>)/g;\r\n        markup = markup.replace(regexTag, function (match, endSlash, name) {\r\n          name = name.toUpperCase();\r\n          var isEndOfInlineContainer = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name) &&\r\n                                       !!endSlash;\r\n          var isBlockNode = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);\r\n\r\n          return match + ((isEndOfInlineContainer || isBlockNode) ? '\\n' : '');\r\n        });\r\n        markup = $.trim(markup);\r\n      }\r\n\r\n      return markup;\r\n    };\r\n\r\n    return {\r\n      /** @property {String} NBSP_CHAR */\r\n      NBSP_CHAR: NBSP_CHAR,\r\n      /** @property {String} ZERO_WIDTH_NBSP_CHAR */\r\n      ZERO_WIDTH_NBSP_CHAR: ZERO_WIDTH_NBSP_CHAR,\r\n      /** @property {String} blank */\r\n      blank: blankHTML,\r\n      /** @property {String} emptyPara */\r\n      emptyPara: '<p>' + blankHTML + '</p>',\r\n      makePredByNodeName: makePredByNodeName,\r\n      isEditable: isEditable,\r\n      isControlSizing: isControlSizing,\r\n      buildLayoutInfo: buildLayoutInfo,\r\n      makeLayoutInfo: makeLayoutInfo,\r\n      isText: isText,\r\n      isVoid: isVoid,\r\n      isPara: isPara,\r\n      isPurePara: isPurePara,\r\n      isInline: isInline,\r\n      isBlock: func.not(isInline),\r\n      isBodyInline: isBodyInline,\r\n      isBody: isBody,\r\n      isParaInline: isParaInline,\r\n      isList: isList,\r\n      isTable: isTable,\r\n      isCell: isCell,\r\n      isBlockquote: isBlockquote,\r\n      isBodyContainer: isBodyContainer,\r\n      isAnchor: isAnchor,\r\n      isDiv: makePredByNodeName('DIV'),\r\n      isLi: isLi,\r\n      isBR: makePredByNodeName('BR'),\r\n      isSpan: makePredByNodeName('SPAN'),\r\n      isB: makePredByNodeName('B'),\r\n      isU: makePredByNodeName('U'),\r\n      isS: makePredByNodeName('S'),\r\n      isI: makePredByNodeName('I'),\r\n      isImg: makePredByNodeName('IMG'),\r\n      isTextarea: isTextarea,\r\n      isEmpty: isEmpty,\r\n      isEmptyAnchor: func.and(isAnchor, isEmpty),\r\n      isClosestSibling: isClosestSibling,\r\n      withClosestSiblings: withClosestSiblings,\r\n      nodeLength: nodeLength,\r\n      isLeftEdgePoint: isLeftEdgePoint,\r\n      isRightEdgePoint: isRightEdgePoint,\r\n      isEdgePoint: isEdgePoint,\r\n      isLeftEdgeOf: isLeftEdgeOf,\r\n      isRightEdgeOf: isRightEdgeOf,\r\n      isLeftEdgePointOf: isLeftEdgePointOf,\r\n      isRightEdgePointOf: isRightEdgePointOf,\r\n      prevPoint: prevPoint,\r\n      nextPoint: nextPoint,\r\n      isSamePoint: isSamePoint,\r\n      isVisiblePoint: isVisiblePoint,\r\n      prevPointUntil: prevPointUntil,\r\n      nextPointUntil: nextPointUntil,\r\n      isCharPoint: isCharPoint,\r\n      walkPoint: walkPoint,\r\n      ancestor: ancestor,\r\n      singleChildAncestor: singleChildAncestor,\r\n      listAncestor: listAncestor,\r\n      lastAncestor: lastAncestor,\r\n      listNext: listNext,\r\n      listPrev: listPrev,\r\n      listDescendant: listDescendant,\r\n      commonAncestor: commonAncestor,\r\n      wrap: wrap,\r\n      insertAfter: insertAfter,\r\n      appendChildNodes: appendChildNodes,\r\n      position: position,\r\n      hasChildren: hasChildren,\r\n      makeOffsetPath: makeOffsetPath,\r\n      fromOffsetPath: fromOffsetPath,\r\n      splitTree: splitTree,\r\n      splitPoint: splitPoint,\r\n      create: create,\r\n      createText: createText,\r\n      remove: remove,\r\n      removeWhile: removeWhile,\r\n      replace: replace,\r\n      html: html,\r\n      value: value\r\n    };\r\n  })();\r\n\r\n\r\n  var range = (function () {\r\n\r\n    /**\r\n     * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js\r\n     *\r\n     * @param {TextRange} textRange\r\n     * @param {Boolean} isStart\r\n     * @return {BoundaryPoint}\r\n     *\r\n     * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx\r\n     */\r\n    var textRangeToPoint = function (textRange, isStart) {\r\n      var container = textRange.parentElement(), offset;\r\n  \r\n      var tester = document.body.createTextRange(), prevContainer;\r\n      var childNodes = list.from(container.childNodes);\r\n      for (offset = 0; offset < childNodes.length; offset++) {\r\n        if (dom.isText(childNodes[offset])) {\r\n          continue;\r\n        }\r\n        tester.moveToElementText(childNodes[offset]);\r\n        if (tester.compareEndPoints('StartToStart', textRange) >= 0) {\r\n          break;\r\n        }\r\n        prevContainer = childNodes[offset];\r\n      }\r\n  \r\n      if (offset !== 0 && dom.isText(childNodes[offset - 1])) {\r\n        var textRangeStart = document.body.createTextRange(), curTextNode = null;\r\n        textRangeStart.moveToElementText(prevContainer || container);\r\n        textRangeStart.collapse(!prevContainer);\r\n        curTextNode = prevContainer ? prevContainer.nextSibling : container.firstChild;\r\n  \r\n        var pointTester = textRange.duplicate();\r\n        pointTester.setEndPoint('StartToStart', textRangeStart);\r\n        var textCount = pointTester.text.replace(/[\\r\\n]/g, '').length;\r\n  \r\n        while (textCount > curTextNode.nodeValue.length && curTextNode.nextSibling) {\r\n          textCount -= curTextNode.nodeValue.length;\r\n          curTextNode = curTextNode.nextSibling;\r\n        }\r\n  \r\n        /* jshint ignore:start */\r\n        var dummy = curTextNode.nodeValue; // enforce IE to re-reference curTextNode, hack\r\n        /* jshint ignore:end */\r\n  \r\n        if (isStart && curTextNode.nextSibling && dom.isText(curTextNode.nextSibling) &&\r\n            textCount === curTextNode.nodeValue.length) {\r\n          textCount -= curTextNode.nodeValue.length;\r\n          curTextNode = curTextNode.nextSibling;\r\n        }\r\n  \r\n        container = curTextNode;\r\n        offset = textCount;\r\n      }\r\n  \r\n      return {\r\n        cont: container,\r\n        offset: offset\r\n      };\r\n    };\r\n    \r\n    /**\r\n     * return TextRange from boundary point (inspired by google closure-library)\r\n     * @param {BoundaryPoint} point\r\n     * @return {TextRange}\r\n     */\r\n    var pointToTextRange = function (point) {\r\n      var textRangeInfo = function (container, offset) {\r\n        var node, isCollapseToStart;\r\n  \r\n        if (dom.isText(container)) {\r\n          var prevTextNodes = dom.listPrev(container, func.not(dom.isText));\r\n          var prevContainer = list.last(prevTextNodes).previousSibling;\r\n          node =  prevContainer || container.parentNode;\r\n          offset += list.sum(list.tail(prevTextNodes), dom.nodeLength);\r\n          isCollapseToStart = !prevContainer;\r\n        } else {\r\n          node = container.childNodes[offset] || container;\r\n          if (dom.isText(node)) {\r\n            return textRangeInfo(node, 0);\r\n          }\r\n  \r\n          offset = 0;\r\n          isCollapseToStart = false;\r\n        }\r\n  \r\n        return {\r\n          node: node,\r\n          collapseToStart: isCollapseToStart,\r\n          offset: offset\r\n        };\r\n      };\r\n  \r\n      var textRange = document.body.createTextRange();\r\n      var info = textRangeInfo(point.node, point.offset);\r\n  \r\n      textRange.moveToElementText(info.node);\r\n      textRange.collapse(info.collapseToStart);\r\n      textRange.moveStart('character', info.offset);\r\n      return textRange;\r\n    };\r\n    \r\n    /**\r\n     * Wrapped Range\r\n     *\r\n     * @constructor\r\n     * @param {Node} sc - start container\r\n     * @param {Number} so - start offset\r\n     * @param {Node} ec - end container\r\n     * @param {Number} eo - end offset\r\n     */\r\n    var WrappedRange = function (sc, so, ec, eo) {\r\n      this.sc = sc;\r\n      this.so = so;\r\n      this.ec = ec;\r\n      this.eo = eo;\r\n  \r\n      // nativeRange: get nativeRange from sc, so, ec, eo\r\n      var nativeRange = function () {\r\n        if (agent.isW3CRangeSupport) {\r\n          var w3cRange = document.createRange();\r\n          w3cRange.setStart(sc, so);\r\n          w3cRange.setEnd(ec, eo);\r\n\r\n          return w3cRange;\r\n        } else {\r\n          var textRange = pointToTextRange({\r\n            node: sc,\r\n            offset: so\r\n          });\r\n\r\n          textRange.setEndPoint('EndToEnd', pointToTextRange({\r\n            node: ec,\r\n            offset: eo\r\n          }));\r\n\r\n          return textRange;\r\n        }\r\n      };\r\n\r\n      this.getPoints = function () {\r\n        return {\r\n          sc: sc,\r\n          so: so,\r\n          ec: ec,\r\n          eo: eo\r\n        };\r\n      };\r\n\r\n      this.getStartPoint = function () {\r\n        return {\r\n          node: sc,\r\n          offset: so\r\n        };\r\n      };\r\n\r\n      this.getEndPoint = function () {\r\n        return {\r\n          node: ec,\r\n          offset: eo\r\n        };\r\n      };\r\n\r\n      /**\r\n       * select update visible range\r\n       */\r\n      this.select = function () {\r\n        var nativeRng = nativeRange();\r\n        if (agent.isW3CRangeSupport) {\r\n          var selection = document.getSelection();\r\n          if (selection.rangeCount > 0) {\r\n            selection.removeAllRanges();\r\n          }\r\n          selection.addRange(nativeRng);\r\n        } else {\r\n          nativeRng.select();\r\n        }\r\n        \r\n        return this;\r\n      };\r\n\r\n      /**\r\n       * @return {WrappedRange}\r\n       */\r\n      this.normalize = function () {\r\n\r\n        /**\r\n         * @param {BoundaryPoint} point\r\n         * @param {Boolean} isLeftToRight\r\n         * @return {BoundaryPoint}\r\n         */\r\n        var getVisiblePoint = function (point, isLeftToRight) {\r\n          if ((dom.isVisiblePoint(point) && !dom.isEdgePoint(point)) ||\r\n              (dom.isVisiblePoint(point) && dom.isRightEdgePoint(point) && !isLeftToRight) ||\r\n              (dom.isVisiblePoint(point) && dom.isLeftEdgePoint(point) && isLeftToRight) ||\r\n              (dom.isVisiblePoint(point) && dom.isBlock(point.node) && dom.isEmpty(point.node))) {\r\n            return point;\r\n          }\r\n\r\n          // point on block's edge\r\n          var block = dom.ancestor(point.node, dom.isBlock);\r\n          if (((dom.isLeftEdgePointOf(point, block) || dom.isVoid(dom.prevPoint(point).node)) && !isLeftToRight) ||\r\n              ((dom.isRightEdgePointOf(point, block) || dom.isVoid(dom.nextPoint(point).node)) && isLeftToRight)) {\r\n\r\n            // returns point already on visible point\r\n            if (dom.isVisiblePoint(point)) {\r\n              return point;\r\n            }\r\n            // reverse direction \r\n            isLeftToRight = !isLeftToRight;\r\n          }\r\n\r\n          var nextPoint = isLeftToRight ? dom.nextPointUntil(dom.nextPoint(point), dom.isVisiblePoint) :\r\n                                          dom.prevPointUntil(dom.prevPoint(point), dom.isVisiblePoint);\r\n          return nextPoint || point;\r\n        };\r\n\r\n        var endPoint = getVisiblePoint(this.getEndPoint(), false);\r\n        var startPoint = this.isCollapsed() ? endPoint : getVisiblePoint(this.getStartPoint(), true);\r\n\r\n        return new WrappedRange(\r\n          startPoint.node,\r\n          startPoint.offset,\r\n          endPoint.node,\r\n          endPoint.offset\r\n        );\r\n      };\r\n\r\n      /**\r\n       * returns matched nodes on range\r\n       *\r\n       * @param {Function} [pred] - predicate function\r\n       * @param {Object} [options]\r\n       * @param {Boolean} [options.includeAncestor]\r\n       * @param {Boolean} [options.fullyContains]\r\n       * @return {Node[]}\r\n       */\r\n      this.nodes = function (pred, options) {\r\n        pred = pred || func.ok;\r\n\r\n        var includeAncestor = options && options.includeAncestor;\r\n        var fullyContains = options && options.fullyContains;\r\n\r\n        // TODO compare points and sort\r\n        var startPoint = this.getStartPoint();\r\n        var endPoint = this.getEndPoint();\r\n\r\n        var nodes = [];\r\n        var leftEdgeNodes = [];\r\n\r\n        dom.walkPoint(startPoint, endPoint, function (point) {\r\n          if (dom.isEditable(point.node)) {\r\n            return;\r\n          }\r\n\r\n          var node;\r\n          if (fullyContains) {\r\n            if (dom.isLeftEdgePoint(point)) {\r\n              leftEdgeNodes.push(point.node);\r\n            }\r\n            if (dom.isRightEdgePoint(point) && list.contains(leftEdgeNodes, point.node)) {\r\n              node = point.node;\r\n            }\r\n          } else if (includeAncestor) {\r\n            node = dom.ancestor(point.node, pred);\r\n          } else {\r\n            node = point.node;\r\n          }\r\n\r\n          if (node && pred(node)) {\r\n            nodes.push(node);\r\n          }\r\n        }, true);\r\n\r\n        return list.unique(nodes);\r\n      };\r\n\r\n      /**\r\n       * returns commonAncestor of range\r\n       * @return {Element} - commonAncestor\r\n       */\r\n      this.commonAncestor = function () {\r\n        return dom.commonAncestor(sc, ec);\r\n      };\r\n\r\n      /**\r\n       * returns expanded range by pred\r\n       *\r\n       * @param {Function} pred - predicate function\r\n       * @return {WrappedRange}\r\n       */\r\n      this.expand = function (pred) {\r\n        var startAncestor = dom.ancestor(sc, pred);\r\n        var endAncestor = dom.ancestor(ec, pred);\r\n\r\n        if (!startAncestor && !endAncestor) {\r\n          return new WrappedRange(sc, so, ec, eo);\r\n        }\r\n\r\n        var boundaryPoints = this.getPoints();\r\n\r\n        if (startAncestor) {\r\n          boundaryPoints.sc = startAncestor;\r\n          boundaryPoints.so = 0;\r\n        }\r\n\r\n        if (endAncestor) {\r\n          boundaryPoints.ec = endAncestor;\r\n          boundaryPoints.eo = dom.nodeLength(endAncestor);\r\n        }\r\n\r\n        return new WrappedRange(\r\n          boundaryPoints.sc,\r\n          boundaryPoints.so,\r\n          boundaryPoints.ec,\r\n          boundaryPoints.eo\r\n        );\r\n      };\r\n\r\n      /**\r\n       * @param {Boolean} isCollapseToStart\r\n       * @return {WrappedRange}\r\n       */\r\n      this.collapse = function (isCollapseToStart) {\r\n        if (isCollapseToStart) {\r\n          return new WrappedRange(sc, so, sc, so);\r\n        } else {\r\n          return new WrappedRange(ec, eo, ec, eo);\r\n        }\r\n      };\r\n\r\n      /**\r\n       * splitText on range\r\n       */\r\n      this.splitText = function () {\r\n        var isSameContainer = sc === ec;\r\n        var boundaryPoints = this.getPoints();\r\n\r\n        if (dom.isText(ec) && !dom.isEdgePoint(this.getEndPoint())) {\r\n          ec.splitText(eo);\r\n        }\r\n\r\n        if (dom.isText(sc) && !dom.isEdgePoint(this.getStartPoint())) {\r\n          boundaryPoints.sc = sc.splitText(so);\r\n          boundaryPoints.so = 0;\r\n\r\n          if (isSameContainer) {\r\n            boundaryPoints.ec = boundaryPoints.sc;\r\n            boundaryPoints.eo = eo - so;\r\n          }\r\n        }\r\n\r\n        return new WrappedRange(\r\n          boundaryPoints.sc,\r\n          boundaryPoints.so,\r\n          boundaryPoints.ec,\r\n          boundaryPoints.eo\r\n        );\r\n      };\r\n\r\n      /**\r\n       * delete contents on range\r\n       * @return {WrappedRange}\r\n       */\r\n      this.deleteContents = function () {\r\n        if (this.isCollapsed()) {\r\n          return this;\r\n        }\r\n\r\n        var rng = this.splitText();\r\n        var nodes = rng.nodes(null, {\r\n          fullyContains: true\r\n        });\r\n\r\n        // find new cursor point\r\n        var point = dom.prevPointUntil(rng.getStartPoint(), function (point) {\r\n          return !list.contains(nodes, point.node);\r\n        });\r\n\r\n        var emptyParents = [];\r\n        $.each(nodes, function (idx, node) {\r\n          // find empty parents\r\n          var parent = node.parentNode;\r\n          if (point.node !== parent && dom.nodeLength(parent) === 1) {\r\n            emptyParents.push(parent);\r\n          }\r\n          dom.remove(node, false);\r\n        });\r\n\r\n        // remove empty parents\r\n        $.each(emptyParents, function (idx, node) {\r\n          dom.remove(node, false);\r\n        });\r\n\r\n        return new WrappedRange(\r\n          point.node,\r\n          point.offset,\r\n          point.node,\r\n          point.offset\r\n        ).normalize();\r\n      };\r\n      \r\n      /**\r\n       * makeIsOn: return isOn(pred) function\r\n       */\r\n      var makeIsOn = function (pred) {\r\n        return function () {\r\n          var ancestor = dom.ancestor(sc, pred);\r\n          return !!ancestor && (ancestor === dom.ancestor(ec, pred));\r\n        };\r\n      };\r\n  \r\n      // isOnEditable: judge whether range is on editable or not\r\n      this.isOnEditable = makeIsOn(dom.isEditable);\r\n      // isOnList: judge whether range is on list node or not\r\n      this.isOnList = makeIsOn(dom.isList);\r\n      // isOnAnchor: judge whether range is on anchor node or not\r\n      this.isOnAnchor = makeIsOn(dom.isAnchor);\r\n      // isOnAnchor: judge whether range is on cell node or not\r\n      this.isOnCell = makeIsOn(dom.isCell);\r\n\r\n      /**\r\n       * @param {Function} pred\r\n       * @return {Boolean}\r\n       */\r\n      this.isLeftEdgeOf = function (pred) {\r\n        if (!dom.isLeftEdgePoint(this.getStartPoint())) {\r\n          return false;\r\n        }\r\n\r\n        var node = dom.ancestor(this.sc, pred);\r\n        return node && dom.isLeftEdgeOf(this.sc, node);\r\n      };\r\n\r\n      /**\r\n       * returns whether range was collapsed or not\r\n       */\r\n      this.isCollapsed = function () {\r\n        return sc === ec && so === eo;\r\n      };\r\n\r\n      /**\r\n       * wrap inline nodes which children of body with paragraph\r\n       *\r\n       * @return {WrappedRange}\r\n       */\r\n      this.wrapBodyInlineWithPara = function () {\r\n        if (dom.isBodyContainer(sc) && dom.isEmpty(sc)) {\r\n          sc.innerHTML = dom.emptyPara;\r\n          return new WrappedRange(sc.firstChild, 0, sc.firstChild, 0);\r\n        }\r\n\r\n        /**\r\n         * [workaround] firefox often create range on not visible point. so normalize here.\r\n         *  - firefox: |<p>text</p>|\r\n         *  - chrome: <p>|text|</p>\r\n         */\r\n        var rng = this.normalize();\r\n        if (dom.isParaInline(sc) || dom.isPara(sc)) {\r\n          return rng;\r\n        }\r\n\r\n        // find inline top ancestor\r\n        var topAncestor;\r\n        if (dom.isInline(rng.sc)) {\r\n          var ancestors = dom.listAncestor(rng.sc, func.not(dom.isInline));\r\n          topAncestor = list.last(ancestors);\r\n          if (!dom.isInline(topAncestor)) {\r\n            topAncestor = ancestors[ancestors.length - 2] || rng.sc.childNodes[rng.so];\r\n          }\r\n        } else {\r\n          topAncestor = rng.sc.childNodes[rng.so > 0 ? rng.so - 1 : 0];\r\n        }\r\n\r\n        // siblings not in paragraph\r\n        var inlineSiblings = dom.listPrev(topAncestor, dom.isParaInline).reverse();\r\n        inlineSiblings = inlineSiblings.concat(dom.listNext(topAncestor.nextSibling, dom.isParaInline));\r\n\r\n        // wrap with paragraph\r\n        if (inlineSiblings.length) {\r\n          var para = dom.wrap(list.head(inlineSiblings), 'p');\r\n          dom.appendChildNodes(para, list.tail(inlineSiblings));\r\n        }\r\n\r\n        return this.normalize();\r\n      };\r\n\r\n      /**\r\n       * insert node at current cursor\r\n       *\r\n       * @param {Node} node\r\n       * @return {Node}\r\n       */\r\n      this.insertNode = function (node) {\r\n        var rng = this.wrapBodyInlineWithPara().deleteContents();\r\n        var info = dom.splitPoint(rng.getStartPoint(), dom.isInline(node));\r\n\r\n        if (info.rightNode) {\r\n          info.rightNode.parentNode.insertBefore(node, info.rightNode);\r\n        } else {\r\n          info.container.appendChild(node);\r\n        }\r\n\r\n        return node;\r\n      };\r\n\r\n      /**\r\n       * insert html at current cursor\r\n       */\r\n      this.pasteHTML = function (markup) {\r\n        var contentsContainer = $('<div></div>').html(markup)[0];\r\n        var childNodes = list.from(contentsContainer.childNodes);\r\n\r\n        var rng = this.wrapBodyInlineWithPara().deleteContents();\r\n\r\n        return childNodes.reverse().map(function (childNode) {\r\n          return rng.insertNode(childNode);\r\n        }).reverse();\r\n      };\r\n  \r\n      /**\r\n       * returns text in range\r\n       *\r\n       * @return {String}\r\n       */\r\n      this.toString = function () {\r\n        var nativeRng = nativeRange();\r\n        return agent.isW3CRangeSupport ? nativeRng.toString() : nativeRng.text;\r\n      };\r\n\r\n      /**\r\n       * returns range for word before cursor\r\n       *\r\n       * @param {Boolean} [findAfter] - find after cursor, default: false\r\n       * @return {WrappedRange}\r\n       */\r\n      this.getWordRange = function (findAfter) {\r\n        var endPoint = this.getEndPoint();\r\n\r\n        if (!dom.isCharPoint(endPoint)) {\r\n          return this;\r\n        }\r\n\r\n        var startPoint = dom.prevPointUntil(endPoint, function (point) {\r\n          return !dom.isCharPoint(point);\r\n        });\r\n\r\n        if (findAfter) {\r\n          endPoint = dom.nextPointUntil(endPoint, function (point) {\r\n            return !dom.isCharPoint(point);\r\n          });\r\n        }\r\n\r\n        return new WrappedRange(\r\n          startPoint.node,\r\n          startPoint.offset,\r\n          endPoint.node,\r\n          endPoint.offset\r\n        );\r\n      };\r\n  \r\n      /**\r\n       * create offsetPath bookmark\r\n       *\r\n       * @param {Node} editable\r\n       */\r\n      this.bookmark = function (editable) {\r\n        return {\r\n          s: {\r\n            path: dom.makeOffsetPath(editable, sc),\r\n            offset: so\r\n          },\r\n          e: {\r\n            path: dom.makeOffsetPath(editable, ec),\r\n            offset: eo\r\n          }\r\n        };\r\n      };\r\n\r\n      /**\r\n       * create offsetPath bookmark base on paragraph\r\n       *\r\n       * @param {Node[]} paras\r\n       */\r\n      this.paraBookmark = function (paras) {\r\n        return {\r\n          s: {\r\n            path: list.tail(dom.makeOffsetPath(list.head(paras), sc)),\r\n            offset: so\r\n          },\r\n          e: {\r\n            path: list.tail(dom.makeOffsetPath(list.last(paras), ec)),\r\n            offset: eo\r\n          }\r\n        };\r\n      };\r\n\r\n      /**\r\n       * getClientRects\r\n       * @return {Rect[]}\r\n       */\r\n      this.getClientRects = function () {\r\n        var nativeRng = nativeRange();\r\n        return nativeRng.getClientRects();\r\n      };\r\n    };\r\n\r\n  /**\r\n   * @class core.range\r\n   *\r\n   * Data structure\r\n   *  * BoundaryPoint: a point of dom tree\r\n   *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range\r\n   *\r\n   * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position\r\n   *\r\n   * @singleton\r\n   * @alternateClassName range\r\n   */\r\n    return {\r\n      /**\r\n       * @method\r\n       * \r\n       * create Range Object From arguments or Browser Selection\r\n       *\r\n       * @param {Node} sc - start container\r\n       * @param {Number} so - start offset\r\n       * @param {Node} ec - end container\r\n       * @param {Number} eo - end offset\r\n       * @return {WrappedRange}\r\n       */\r\n      create : function (sc, so, ec, eo) {\r\n        if (!arguments.length) { // from Browser Selection\r\n          if (agent.isW3CRangeSupport) {\r\n            var selection = document.getSelection();\r\n            if (!selection || selection.rangeCount === 0) {\r\n              return null;\r\n            } else if (dom.isBody(selection.anchorNode)) {\r\n              // Firefox: returns entire body as range on initialization. We won't never need it.\r\n              return null;\r\n            }\r\n  \r\n            var nativeRng = selection.getRangeAt(0);\r\n            sc = nativeRng.startContainer;\r\n            so = nativeRng.startOffset;\r\n            ec = nativeRng.endContainer;\r\n            eo = nativeRng.endOffset;\r\n          } else { // IE8: TextRange\r\n            var textRange = document.selection.createRange();\r\n            var textRangeEnd = textRange.duplicate();\r\n            textRangeEnd.collapse(false);\r\n            var textRangeStart = textRange;\r\n            textRangeStart.collapse(true);\r\n  \r\n            var startPoint = textRangeToPoint(textRangeStart, true),\r\n            endPoint = textRangeToPoint(textRangeEnd, false);\r\n\r\n            // same visible point case: range was collapsed.\r\n            if (dom.isText(startPoint.node) && dom.isLeftEdgePoint(startPoint) &&\r\n                dom.isTextNode(endPoint.node) && dom.isRightEdgePoint(endPoint) &&\r\n                endPoint.node.nextSibling === startPoint.node) {\r\n              startPoint = endPoint;\r\n            }\r\n\r\n            sc = startPoint.cont;\r\n            so = startPoint.offset;\r\n            ec = endPoint.cont;\r\n            eo = endPoint.offset;\r\n          }\r\n        } else if (arguments.length === 2) { //collapsed\r\n          ec = sc;\r\n          eo = so;\r\n        }\r\n        return new WrappedRange(sc, so, ec, eo);\r\n      },\r\n\r\n      /**\r\n       * @method \r\n       * \r\n       * create WrappedRange from node\r\n       *\r\n       * @param {Node} node\r\n       * @return {WrappedRange}\r\n       */\r\n      createFromNode: function (node) {\r\n        var sc = node;\r\n        var so = 0;\r\n        var ec = node;\r\n        var eo = dom.nodeLength(ec);\r\n\r\n        // browsers can't target a picture or void node\r\n        if (dom.isVoid(sc)) {\r\n          so = dom.listPrev(sc).length - 1;\r\n          sc = sc.parentNode;\r\n        }\r\n        if (dom.isBR(ec)) {\r\n          eo = dom.listPrev(ec).length - 1;\r\n          ec = ec.parentNode;\r\n        } else if (dom.isVoid(ec)) {\r\n          eo = dom.listPrev(ec).length;\r\n          ec = ec.parentNode;\r\n        }\r\n\r\n        return this.create(sc, so, ec, eo);\r\n      },\r\n\r\n      /**\r\n       * create WrappedRange from node after position\r\n       *\r\n       * @param {Node} node\r\n       * @return {WrappedRange}\r\n       */\r\n      createFromNodeBefore: function (node) {\r\n        return this.createFromNode(node).collapse(true);\r\n      },\r\n\r\n      /**\r\n       * create WrappedRange from node after position\r\n       *\r\n       * @param {Node} node\r\n       * @return {WrappedRange}\r\n       */\r\n      createFromNodeAfter: function (node) {\r\n        return this.createFromNode(node).collapse();\r\n      },\r\n\r\n      /**\r\n       * @method \r\n       * \r\n       * create WrappedRange from bookmark\r\n       *\r\n       * @param {Node} editable\r\n       * @param {Object} bookmark\r\n       * @return {WrappedRange}\r\n       */\r\n      createFromBookmark : function (editable, bookmark) {\r\n        var sc = dom.fromOffsetPath(editable, bookmark.s.path);\r\n        var so = bookmark.s.offset;\r\n        var ec = dom.fromOffsetPath(editable, bookmark.e.path);\r\n        var eo = bookmark.e.offset;\r\n        return new WrappedRange(sc, so, ec, eo);\r\n      },\r\n\r\n      /**\r\n       * @method \r\n       *\r\n       * create WrappedRange from paraBookmark\r\n       *\r\n       * @param {Object} bookmark\r\n       * @param {Node[]} paras\r\n       * @return {WrappedRange}\r\n       */\r\n      createFromParaBookmark: function (bookmark, paras) {\r\n        var so = bookmark.s.offset;\r\n        var eo = bookmark.e.offset;\r\n        var sc = dom.fromOffsetPath(list.head(paras), bookmark.s.path);\r\n        var ec = dom.fromOffsetPath(list.last(paras), bookmark.e.path);\r\n\r\n        return new WrappedRange(sc, so, ec, eo);\r\n      }\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * @class defaults \r\n   * \r\n   * @singleton\r\n   */\r\n  var defaults = {\r\n    /** @property */\r\n    version: '0.6.16',\r\n\r\n    /**\r\n     * \r\n     * for event options, reference to EventHandler.attach\r\n     * \r\n     * @property {Object} options \r\n     * @property {String/Number} [options.width=null] set editor width \r\n     * @property {String/Number} [options.height=null] set editor height, ex) 300\r\n     * @property {String/Number} options.minHeight set minimum height of editor\r\n     * @property {String/Number} options.maxHeight\r\n     * @property {String/Number} options.focus \r\n     * @property {Number} options.tabsize \r\n     * @property {Boolean} options.styleWithSpan\r\n     * @property {Object} options.codemirror\r\n     * @property {Object} [options.codemirror.mode='text/html']\r\n     * @property {Object} [options.codemirror.htmlMode=true]\r\n     * @property {Object} [options.codemirror.lineNumbers=true]\r\n     * @property {String} [options.lang=en-US] language 'en-US', 'ko-KR', ...\r\n     * @property {String} [options.direction=null] text direction, ex) 'rtl'\r\n     * @property {Array} [options.toolbar]\r\n     * @property {Boolean} [options.airMode=false]\r\n     * @property {Array} [options.airPopover]\r\n     * @property {Fucntion} [options.onInit] initialize\r\n     * @property {Fucntion} [options.onsubmit]\r\n     */\r\n    options: {\r\n      width: null,                  // set editor width\r\n      height: null,                 // set editor height, ex) 300\r\n\r\n      minHeight: null,              // set minimum height of editor\r\n      maxHeight: null,              // set maximum height of editor\r\n\r\n      focus: false,                 // set focus to editable area after initializing summernote\r\n\r\n      tabsize: 4,                   // size of tab ex) 2 or 4\r\n      styleWithSpan: true,          // style with span (Chrome and FF only)\r\n\r\n      disableLinkTarget: false,     // hide link Target Checkbox\r\n      disableDragAndDrop: false,    // disable drag and drop event\r\n      disableResizeEditor: false,   // disable resizing editor\r\n      disableResizeImage: false,    // disable resizing image\r\n\r\n      shortcuts: true,              // enable keyboard shortcuts\r\n\r\n      textareaAutoSync: true,       // enable textarea auto sync\r\n\r\n      placeholder: false,           // enable placeholder text\r\n      prettifyHtml: true,           // enable prettifying html while toggling codeview\r\n\r\n      iconPrefix: 'fa fa-',         // prefix for css icon classes\r\n\r\n      icons: {\r\n        font: {\r\n          bold: 'bold',\r\n          italic: 'italic',\r\n          underline: 'underline',\r\n          clear: 'eraser',\r\n          height: 'text-height',\r\n          strikethrough: 'strikethrough',\r\n          superscript: 'superscript',\r\n          subscript: 'subscript'\r\n        },\r\n        image: {\r\n          image: 'picture-o',\r\n          floatLeft: 'align-left',\r\n          floatRight: 'align-right',\r\n          floatNone: 'align-justify',\r\n          shapeRounded: 'square',\r\n          shapeCircle: 'circle-o',\r\n          shapeThumbnail: 'picture-o',\r\n          shapeNone: 'times',\r\n          remove: 'trash-o'\r\n        },\r\n        link: {\r\n          link: 'link',\r\n          unlink: 'unlink',\r\n          edit: 'edit'\r\n        },\r\n        table: {\r\n          table: 'table'\r\n        },\r\n        hr: {\r\n          insert: 'minus'\r\n        },\r\n        style: {\r\n          style: 'magic'\r\n        },\r\n        lists: {\r\n          unordered: 'list-ul',\r\n          ordered: 'list-ol'\r\n        },\r\n        options: {\r\n          help: 'question',\r\n          fullscreen: 'arrows-alt',\r\n          codeview: 'code'\r\n        },\r\n        paragraph: {\r\n          paragraph: 'align-left',\r\n          outdent: 'outdent',\r\n          indent: 'indent',\r\n          left: 'align-left',\r\n          center: 'align-center',\r\n          right: 'align-right',\r\n          justify: 'align-justify'\r\n        },\r\n        color: {\r\n          recent: 'font'\r\n        },\r\n        history: {\r\n          undo: 'undo',\r\n          redo: 'repeat'\r\n        },\r\n        misc: {\r\n          check: 'check'\r\n        }\r\n      },\r\n\r\n      dialogsInBody: false,          // false will add dialogs into editor\r\n\r\n      codemirror: {                 // codemirror options\r\n        mode: 'text/html',\r\n        htmlMode: true,\r\n        lineNumbers: true\r\n      },\r\n\r\n      // language\r\n      lang: 'en-US',                // language 'en-US', 'ko-KR', ...\r\n      direction: null,              // text direction, ex) 'rtl'\r\n\r\n      // toolbar\r\n      toolbar: [\r\n        ['style', ['style']],\r\n        ['font', ['bold', 'italic', 'underline', 'clear']],\r\n        // ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],\r\n        ['fontname', ['fontname']],\r\n        ['fontsize', ['fontsize']],\r\n        ['color', ['color']],\r\n        ['para', ['ul', 'ol', 'paragraph']],\r\n        ['height', ['height']],\r\n        ['table', ['table']],\r\n        ['insert', ['link', 'picture', 'hr']],\r\n        ['view', ['fullscreen', 'codeview']],\r\n        ['help', ['help']]\r\n      ],\r\n\r\n      plugin : { },\r\n\r\n      // air mode: inline editor\r\n      airMode: false,\r\n      // airPopover: [\r\n      //   ['style', ['style']],\r\n      //   ['font', ['bold', 'italic', 'underline', 'clear']],\r\n      //   ['fontname', ['fontname']],\r\n      //   ['color', ['color']],\r\n      //   ['para', ['ul', 'ol', 'paragraph']],\r\n      //   ['height', ['height']],\r\n      //   ['table', ['table']],\r\n      //   ['insert', ['link', 'picture']],\r\n      //   ['help', ['help']]\r\n      // ],\r\n      airPopover: [\r\n        ['color', ['color']],\r\n        ['font', ['bold', 'underline', 'clear']],\r\n        ['para', ['ul', 'paragraph']],\r\n        ['table', ['table']],\r\n        ['insert', ['link', 'picture']]\r\n      ],\r\n\r\n      // style tag\r\n      styleTags: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\r\n\r\n      // default fontName\r\n      defaultFontName: 'Helvetica Neue',\r\n\r\n      // fontName\r\n      fontNames: [\r\n        'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',\r\n        'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',\r\n        'Tahoma', 'Times New Roman', 'Verdana'\r\n      ],\r\n      fontNamesIgnoreCheck: [],\r\n\r\n      fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],\r\n\r\n      // pallete colors(n x n)\r\n      colors: [\r\n        ['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F7F7', '#FFFFFF'],\r\n        ['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'],\r\n        ['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'],\r\n        ['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'],\r\n        ['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'],\r\n        ['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'],\r\n        ['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'],\r\n        ['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031']\r\n      ],\r\n\r\n      // lineHeight\r\n      lineHeights: ['1.0', '1.2', '1.4', '1.5', '1.6', '1.8', '2.0', '3.0'],\r\n\r\n      // insertTable max size\r\n      insertTableMaxSize: {\r\n        col: 10,\r\n        row: 10\r\n      },\r\n\r\n      // image\r\n      maximumImageFileSize: null, // size in bytes, null = no limit\r\n\r\n      // callbacks\r\n      oninit: null,             // initialize\r\n      onfocus: null,            // editable has focus\r\n      onblur: null,             // editable out of focus\r\n      onenter: null,            // enter key pressed\r\n      onkeyup: null,            // keyup\r\n      onkeydown: null,          // keydown\r\n      onImageUpload: null,      // imageUpload\r\n      onImageUploadError: null, // imageUploadError\r\n      onMediaDelete: null,      // media delete\r\n      onToolbarClick: null,\r\n      onsubmit: null,\r\n\r\n      /**\r\n       * manipulate link address when user create link\r\n       * @param {String} sLinkUrl\r\n       * @return {String}\r\n       */\r\n      onCreateLink: function (sLinkUrl) {\r\n        if (sLinkUrl.indexOf('@') !== -1 && sLinkUrl.indexOf(':') === -1) {\r\n          sLinkUrl =  'mailto:' + sLinkUrl;\r\n        }\r\n\r\n        return sLinkUrl;\r\n      },\r\n\r\n      keyMap: {\r\n        pc: {\r\n          'ENTER': 'insertParagraph',\r\n          'CTRL+Z': 'undo',\r\n          'CTRL+Y': 'redo',\r\n          'TAB': 'tab',\r\n          'SHIFT+TAB': 'untab',\r\n          'CTRL+B': 'bold',\r\n          'CTRL+I': 'italic',\r\n          'CTRL+U': 'underline',\r\n          'CTRL+SHIFT+S': 'strikethrough',\r\n          'CTRL+BACKSLASH': 'removeFormat',\r\n          'CTRL+SHIFT+L': 'justifyLeft',\r\n          'CTRL+SHIFT+E': 'justifyCenter',\r\n          'CTRL+SHIFT+R': 'justifyRight',\r\n          'CTRL+SHIFT+J': 'justifyFull',\r\n          'CTRL+SHIFT+NUM7': 'insertUnorderedList',\r\n          'CTRL+SHIFT+NUM8': 'insertOrderedList',\r\n          'CTRL+LEFTBRACKET': 'outdent',\r\n          'CTRL+RIGHTBRACKET': 'indent',\r\n          'CTRL+NUM0': 'formatPara',\r\n          'CTRL+NUM1': 'formatH1',\r\n          'CTRL+NUM2': 'formatH2',\r\n          'CTRL+NUM3': 'formatH3',\r\n          'CTRL+NUM4': 'formatH4',\r\n          'CTRL+NUM5': 'formatH5',\r\n          'CTRL+NUM6': 'formatH6',\r\n          'CTRL+ENTER': 'insertHorizontalRule',\r\n          'CTRL+K': 'showLinkDialog'\r\n        },\r\n\r\n        mac: {\r\n          'ENTER': 'insertParagraph',\r\n          'CMD+Z': 'undo',\r\n          'CMD+SHIFT+Z': 'redo',\r\n          'TAB': 'tab',\r\n          'SHIFT+TAB': 'untab',\r\n          'CMD+B': 'bold',\r\n          'CMD+I': 'italic',\r\n          'CMD+U': 'underline',\r\n          'CMD+SHIFT+S': 'strikethrough',\r\n          'CMD+BACKSLASH': 'removeFormat',\r\n          'CMD+SHIFT+L': 'justifyLeft',\r\n          'CMD+SHIFT+E': 'justifyCenter',\r\n          'CMD+SHIFT+R': 'justifyRight',\r\n          'CMD+SHIFT+J': 'justifyFull',\r\n          'CMD+SHIFT+NUM7': 'insertUnorderedList',\r\n          'CMD+SHIFT+NUM8': 'insertOrderedList',\r\n          'CMD+LEFTBRACKET': 'outdent',\r\n          'CMD+RIGHTBRACKET': 'indent',\r\n          'CMD+NUM0': 'formatPara',\r\n          'CMD+NUM1': 'formatH1',\r\n          'CMD+NUM2': 'formatH2',\r\n          'CMD+NUM3': 'formatH3',\r\n          'CMD+NUM4': 'formatH4',\r\n          'CMD+NUM5': 'formatH5',\r\n          'CMD+NUM6': 'formatH6',\r\n          'CMD+ENTER': 'insertHorizontalRule',\r\n          'CMD+K': 'showLinkDialog'\r\n        }\r\n      }\r\n    },\r\n\r\n    // default language: en-US\r\n    lang: {\r\n      'en-US': {\r\n        font: {\r\n          bold: 'Bold',\r\n          italic: 'Italic',\r\n          underline: 'Underline',\r\n          clear: 'Remove Font Style',\r\n          height: 'Line Height',\r\n          name: 'Font Family',\r\n          strikethrough: 'Strikethrough',\r\n          subscript: 'Subscript',\r\n          superscript: 'Superscript',\r\n          size: 'Font Size'\r\n        },\r\n        image: {\r\n          image: 'Picture',\r\n          insert: 'Insert Image',\r\n          resizeFull: 'Resize Full',\r\n          resizeHalf: 'Resize Half',\r\n          resizeQuarter: 'Resize Quarter',\r\n          floatLeft: 'Float Left',\r\n          floatRight: 'Float Right',\r\n          floatNone: 'Float None',\r\n          shapeRounded: 'Shape: Rounded',\r\n          shapeCircle: 'Shape: Circle',\r\n          shapeThumbnail: 'Shape: Thumbnail',\r\n          shapeNone: 'Shape: None',\r\n          dragImageHere: 'Drag image or text here',\r\n          dropImage: 'Drop image or Text',\r\n          selectFromFiles: 'Select from files',\r\n          maximumFileSize: 'Maximum file size',\r\n          maximumFileSizeError: 'Maximum file size exceeded.',\r\n          url: 'Image URL',\r\n          remove: 'Remove Image'\r\n        },\r\n        link: {\r\n          link: 'Link',\r\n          insert: 'Insert Link',\r\n          unlink: 'Unlink',\r\n          edit: 'Edit',\r\n          textToDisplay: 'Text to display',\r\n          url: 'To what URL should this link go?',\r\n          openInNewWindow: 'Open in new window'\r\n        },\r\n        table: {\r\n          table: 'Table'\r\n        },\r\n        hr: {\r\n          insert: 'Insert Horizontal Rule'\r\n        },\r\n        style: {\r\n          style: 'Style',\r\n          normal: 'Normal',\r\n          blockquote: 'Quote',\r\n          pre: 'Code',\r\n          h1: 'Header 1',\r\n          h2: 'Header 2',\r\n          h3: 'Header 3',\r\n          h4: 'Header 4',\r\n          h5: 'Header 5',\r\n          h6: 'Header 6'\r\n        },\r\n        lists: {\r\n          unordered: 'Unordered list',\r\n          ordered: 'Ordered list'\r\n        },\r\n        options: {\r\n          help: 'Help',\r\n          fullscreen: 'Full Screen',\r\n          codeview: 'Code View'\r\n        },\r\n        paragraph: {\r\n          paragraph: 'Paragraph',\r\n          outdent: 'Outdent',\r\n          indent: 'Indent',\r\n          left: 'Align left',\r\n          center: 'Align center',\r\n          right: 'Align right',\r\n          justify: 'Justify full'\r\n        },\r\n        color: {\r\n          recent: 'Recent Color',\r\n          more: 'More Color',\r\n          background: 'Background Color',\r\n          foreground: 'Foreground Color',\r\n          transparent: 'Transparent',\r\n          setTransparent: 'Set transparent',\r\n          reset: 'Reset',\r\n          resetToDefault: 'Reset to default'\r\n        },\r\n        shortcut: {\r\n          shortcuts: 'Keyboard shortcuts',\r\n          close: 'Close',\r\n          textFormatting: 'Text formatting',\r\n          action: 'Action',\r\n          paragraphFormatting: 'Paragraph formatting',\r\n          documentStyle: 'Document Style',\r\n          extraKeys: 'Extra keys'\r\n        },\r\n        history: {\r\n          undo: 'Undo',\r\n          redo: 'Redo'\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @class core.async\r\n   *\r\n   * Async functions which returns `Promise`\r\n   *\r\n   * @singleton\r\n   * @alternateClassName async\r\n   */\r\n  var async = (function () {\r\n    /**\r\n     * @method readFileAsDataURL\r\n     *\r\n     * read contents of file as representing URL\r\n     *\r\n     * @param {File} file\r\n     * @return {Promise} - then: sDataUrl\r\n     */\r\n    var readFileAsDataURL = function (file) {\r\n      return $.Deferred(function (deferred) {\r\n        $.extend(new FileReader(), {\r\n          onload: function (e) {\r\n            var sDataURL = e.target.result;\r\n            deferred.resolve(sDataURL);\r\n          },\r\n          onerror: function () {\r\n            deferred.reject(this);\r\n          }\r\n        }).readAsDataURL(file);\r\n      }).promise();\r\n    };\r\n  \r\n    /**\r\n     * @method createImage\r\n     *\r\n     * create `<image>` from url string\r\n     *\r\n     * @param {String} sUrl\r\n     * @param {String} filename\r\n     * @return {Promise} - then: $image\r\n     */\r\n    var createImage = function (sUrl, filename) {\r\n      return $.Deferred(function (deferred) {\r\n        var $img = $('<img>');\r\n\r\n        $img.one('load', function () {\r\n          $img.off('error abort');\r\n          deferred.resolve($img);\r\n        }).one('error abort', function () {\r\n          $img.off('load').detach();\r\n          deferred.reject($img);\r\n        }).css({\r\n          display: 'none'\r\n        }).appendTo(document.body).attr({\r\n          'src': sUrl,\r\n          'data-filename': filename\r\n        });\r\n      }).promise();\r\n    };\r\n\r\n    return {\r\n      readFileAsDataURL: readFileAsDataURL,\r\n      createImage: createImage\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * @class core.key\r\n   *\r\n   * Object for keycodes.\r\n   *\r\n   * @singleton\r\n   * @alternateClassName key\r\n   */\r\n  var key = (function () {\r\n    var keyMap = {\r\n      'BACKSPACE': 8,\r\n      'TAB': 9,\r\n      'ENTER': 13,\r\n      'SPACE': 32,\r\n\r\n      // Number: 0-9\r\n      'NUM0': 48,\r\n      'NUM1': 49,\r\n      'NUM2': 50,\r\n      'NUM3': 51,\r\n      'NUM4': 52,\r\n      'NUM5': 53,\r\n      'NUM6': 54,\r\n      'NUM7': 55,\r\n      'NUM8': 56,\r\n\r\n      // Alphabet: a-z\r\n      'B': 66,\r\n      'E': 69,\r\n      'I': 73,\r\n      'J': 74,\r\n      'K': 75,\r\n      'L': 76,\r\n      'R': 82,\r\n      'S': 83,\r\n      'U': 85,\r\n      'V': 86,\r\n      'Y': 89,\r\n      'Z': 90,\r\n\r\n      'SLASH': 191,\r\n      'LEFTBRACKET': 219,\r\n      'BACKSLASH': 220,\r\n      'RIGHTBRACKET': 221\r\n    };\r\n\r\n    return {\r\n      /**\r\n       * @method isEdit\r\n       *\r\n       * @param {Number} keyCode\r\n       * @return {Boolean}\r\n       */\r\n      isEdit: function (keyCode) {\r\n        return list.contains([8, 9, 13, 32], keyCode);\r\n      },\r\n      /**\r\n       * @method isMove\r\n       *\r\n       * @param {Number} keyCode\r\n       * @return {Boolean}\r\n       */\r\n      isMove: function (keyCode) {\r\n        return list.contains([37, 38, 39, 40], keyCode);\r\n      },\r\n      /**\r\n       * @property {Object} nameFromCode\r\n       * @property {String} nameFromCode.8 \"BACKSPACE\"\r\n       */\r\n      nameFromCode: func.invertObject(keyMap),\r\n      code: keyMap\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * @class editing.History\r\n   *\r\n   * Editor History\r\n   *\r\n   */\r\n  var History = function ($editable) {\r\n    var stack = [], stackOffset = -1;\r\n    var editable = $editable[0];\r\n\r\n    var makeSnapshot = function () {\r\n      var rng = range.create();\r\n      var emptyBookmark = {s: {path: [], offset: 0}, e: {path: [], offset: 0}};\r\n\r\n      return {\r\n        contents: $editable.html(),\r\n        bookmark: (rng ? rng.bookmark(editable) : emptyBookmark)\r\n      };\r\n    };\r\n\r\n    var applySnapshot = function (snapshot) {\r\n      if (snapshot.contents !== null) {\r\n        $editable.html(snapshot.contents);\r\n      }\r\n      if (snapshot.bookmark !== null) {\r\n        range.createFromBookmark(editable, snapshot.bookmark).select();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * undo\r\n     */\r\n    this.undo = function () {\r\n      // Create snap shot if not yet recorded\r\n      if ($editable.html() !== stack[stackOffset].contents) {\r\n        this.recordUndo();\r\n      }\r\n\r\n      if (0 < stackOffset) {\r\n        stackOffset--;\r\n        applySnapshot(stack[stackOffset]);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * redo\r\n     */\r\n    this.redo = function () {\r\n      if (stack.length - 1 > stackOffset) {\r\n        stackOffset++;\r\n        applySnapshot(stack[stackOffset]);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * recorded undo\r\n     */\r\n    this.recordUndo = function () {\r\n      stackOffset++;\r\n\r\n      // Wash out stack after stackOffset\r\n      if (stack.length > stackOffset) {\r\n        stack = stack.slice(0, stackOffset);\r\n      }\r\n\r\n      // Create new snapshot and push it to the end\r\n      stack.push(makeSnapshot());\r\n    };\r\n\r\n    // Create first undo stack\r\n    this.recordUndo();\r\n  };\r\n\r\n  /**\r\n   * @class editing.Style\r\n   *\r\n   * Style\r\n   *\r\n   */\r\n  var Style = function () {\r\n    /**\r\n     * @method jQueryCSS\r\n     *\r\n     * [workaround] for old jQuery\r\n     * passing an array of style properties to .css()\r\n     * will result in an object of property-value pairs.\r\n     * (compability with version < 1.9)\r\n     *\r\n     * @private\r\n     * @param  {jQuery} $obj\r\n     * @param  {Array} propertyNames - An array of one or more CSS properties.\r\n     * @return {Object}\r\n     */\r\n    var jQueryCSS = function ($obj, propertyNames) {\r\n      if (agent.jqueryVersion < 1.9) {\r\n        var result = {};\r\n        $.each(propertyNames, function (idx, propertyName) {\r\n          result[propertyName] = $obj.css(propertyName);\r\n        });\r\n        return result;\r\n      }\r\n      return $obj.css.call($obj, propertyNames);\r\n    };\r\n\r\n    /**\r\n     * returns style object from node\r\n     *\r\n     * @param {jQuery} $node\r\n     * @return {Object}\r\n     */\r\n    this.fromNode = function ($node) {\r\n      var properties = ['font-family', 'font-size', 'text-align', 'list-style-type', 'line-height'];\r\n      var styleInfo = jQueryCSS($node, properties) || {};\r\n      styleInfo['font-size'] = parseInt(styleInfo['font-size'], 10);\r\n      return styleInfo;\r\n    };\r\n\r\n    /**\r\n     * paragraph level style\r\n     *\r\n     * @param {WrappedRange} rng\r\n     * @param {Object} styleInfo\r\n     */\r\n    this.stylePara = function (rng, styleInfo) {\r\n      $.each(rng.nodes(dom.isPara, {\r\n        includeAncestor: true\r\n      }), function (idx, para) {\r\n        $(para).css(styleInfo);\r\n      });\r\n    };\r\n\r\n    /**\r\n     * insert and returns styleNodes on range.\r\n     *\r\n     * @param {WrappedRange} rng\r\n     * @param {Object} [options] - options for styleNodes\r\n     * @param {String} [options.nodeName] - default: `SPAN`\r\n     * @param {Boolean} [options.expandClosestSibling] - default: `false`\r\n     * @param {Boolean} [options.onlyPartialContains] - default: `false`\r\n     * @return {Node[]}\r\n     */\r\n    this.styleNodes = function (rng, options) {\r\n      rng = rng.splitText();\r\n\r\n      var nodeName = options && options.nodeName || 'SPAN';\r\n      var expandClosestSibling = !!(options && options.expandClosestSibling);\r\n      var onlyPartialContains = !!(options && options.onlyPartialContains);\r\n\r\n      if (rng.isCollapsed()) {\r\n        return [rng.insertNode(dom.create(nodeName))];\r\n      }\r\n\r\n      var pred = dom.makePredByNodeName(nodeName);\r\n      var nodes = rng.nodes(dom.isText, {\r\n        fullyContains: true\r\n      }).map(function (text) {\r\n        return dom.singleChildAncestor(text, pred) || dom.wrap(text, nodeName);\r\n      });\r\n\r\n      if (expandClosestSibling) {\r\n        if (onlyPartialContains) {\r\n          var nodesInRange = rng.nodes();\r\n          // compose with partial contains predication\r\n          pred = func.and(pred, function (node) {\r\n            return list.contains(nodesInRange, node);\r\n          });\r\n        }\r\n\r\n        return nodes.map(function (node) {\r\n          var siblings = dom.withClosestSiblings(node, pred);\r\n          var head = list.head(siblings);\r\n          var tails = list.tail(siblings);\r\n          $.each(tails, function (idx, elem) {\r\n            dom.appendChildNodes(head, elem.childNodes);\r\n            dom.remove(elem);\r\n          });\r\n          return list.head(siblings);\r\n        });\r\n      } else {\r\n        return nodes;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * get current style on cursor\r\n     *\r\n     * @param {WrappedRange} rng\r\n     * @return {Object} - object contains style properties.\r\n     */\r\n    this.current = function (rng) {\r\n      var $cont = $(dom.isText(rng.sc) ? rng.sc.parentNode : rng.sc);\r\n      var styleInfo = this.fromNode($cont);\r\n\r\n      // document.queryCommandState for toggle state\r\n      styleInfo['font-bold'] = document.queryCommandState('bold') ? 'bold' : 'normal';\r\n      styleInfo['font-italic'] = document.queryCommandState('italic') ? 'italic' : 'normal';\r\n      styleInfo['font-underline'] = document.queryCommandState('underline') ? 'underline' : 'normal';\r\n      styleInfo['font-strikethrough'] = document.queryCommandState('strikeThrough') ? 'strikethrough' : 'normal';\r\n      styleInfo['font-superscript'] = document.queryCommandState('superscript') ? 'superscript' : 'normal';\r\n      styleInfo['font-subscript'] = document.queryCommandState('subscript') ? 'subscript' : 'normal';\r\n\r\n      // list-style-type to list-style(unordered, ordered)\r\n      if (!rng.isOnList()) {\r\n        styleInfo['list-style'] = 'none';\r\n      } else {\r\n        var aOrderedType = ['circle', 'disc', 'disc-leading-zero', 'square'];\r\n        var isUnordered = $.inArray(styleInfo['list-style-type'], aOrderedType) > -1;\r\n        styleInfo['list-style'] = isUnordered ? 'unordered' : 'ordered';\r\n      }\r\n\r\n      var para = dom.ancestor(rng.sc, dom.isPara);\r\n      if (para && para.style['line-height']) {\r\n        styleInfo['line-height'] = para.style.lineHeight;\r\n      } else {\r\n        var lineHeight = parseInt(styleInfo['line-height'], 10) / parseInt(styleInfo['font-size'], 10);\r\n        styleInfo['line-height'] = lineHeight.toFixed(1);\r\n      }\r\n\r\n      styleInfo.anchor = rng.isOnAnchor() && dom.ancestor(rng.sc, dom.isAnchor);\r\n      styleInfo.ancestors = dom.listAncestor(rng.sc, dom.isEditable);\r\n      styleInfo.range = rng;\r\n\r\n      return styleInfo;\r\n    };\r\n  };\r\n\r\n\r\n  /**\r\n   * @class editing.Bullet\r\n   *\r\n   * @alternateClassName Bullet\r\n   */\r\n  var Bullet = function () {\r\n    /**\r\n     * @method insertOrderedList\r\n     *\r\n     * toggle ordered list\r\n     *\r\n     * @type command\r\n     */\r\n    this.insertOrderedList = function () {\r\n      this.toggleList('OL');\r\n    };\r\n\r\n    /**\r\n     * @method insertUnorderedList\r\n     *\r\n     * toggle unordered list\r\n     *\r\n     * @type command\r\n     */\r\n    this.insertUnorderedList = function () {\r\n      this.toggleList('UL');\r\n    };\r\n\r\n    /**\r\n     * @method indent\r\n     *\r\n     * indent\r\n     *\r\n     * @type command\r\n     */\r\n    this.indent = function () {\r\n      var self = this;\r\n      var rng = range.create().wrapBodyInlineWithPara();\r\n\r\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\r\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\r\n\r\n      $.each(clustereds, function (idx, paras) {\r\n        var head = list.head(paras);\r\n        if (dom.isLi(head)) {\r\n          self.wrapList(paras, head.parentNode.nodeName);\r\n        } else {\r\n          $.each(paras, function (idx, para) {\r\n            $(para).css('marginLeft', function (idx, val) {\r\n              return (parseInt(val, 10) || 0) + 25;\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      rng.select();\r\n    };\r\n\r\n    /**\r\n     * @method outdent\r\n     *\r\n     * outdent\r\n     *\r\n     * @type command\r\n     */\r\n    this.outdent = function () {\r\n      var self = this;\r\n      var rng = range.create().wrapBodyInlineWithPara();\r\n\r\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\r\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\r\n\r\n      $.each(clustereds, function (idx, paras) {\r\n        var head = list.head(paras);\r\n        if (dom.isLi(head)) {\r\n          self.releaseList([paras]);\r\n        } else {\r\n          $.each(paras, function (idx, para) {\r\n            $(para).css('marginLeft', function (idx, val) {\r\n              val = (parseInt(val, 10) || 0);\r\n              return val > 25 ? val - 25 : '';\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      rng.select();\r\n    };\r\n\r\n    /**\r\n     * @method toggleList\r\n     *\r\n     * toggle list\r\n     *\r\n     * @param {String} listName - OL or UL\r\n     */\r\n    this.toggleList = function (listName) {\r\n      var self = this;\r\n      var rng = range.create().wrapBodyInlineWithPara();\r\n\r\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\r\n      var bookmark = rng.paraBookmark(paras);\r\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\r\n\r\n      // paragraph to list\r\n      if (list.find(paras, dom.isPurePara)) {\r\n        var wrappedParas = [];\r\n        $.each(clustereds, function (idx, paras) {\r\n          wrappedParas = wrappedParas.concat(self.wrapList(paras, listName));\r\n        });\r\n        paras = wrappedParas;\r\n      // list to paragraph or change list style\r\n      } else {\r\n        var diffLists = rng.nodes(dom.isList, {\r\n          includeAncestor: true\r\n        }).filter(function (listNode) {\r\n          return !$.nodeName(listNode, listName);\r\n        });\r\n\r\n        if (diffLists.length) {\r\n          $.each(diffLists, function (idx, listNode) {\r\n            dom.replace(listNode, listName);\r\n          });\r\n        } else {\r\n          paras = this.releaseList(clustereds, true);\r\n        }\r\n      }\r\n\r\n      range.createFromParaBookmark(bookmark, paras).select();\r\n    };\r\n\r\n    /**\r\n     * @method wrapList\r\n     *\r\n     * @param {Node[]} paras\r\n     * @param {String} listName\r\n     * @return {Node[]}\r\n     */\r\n    this.wrapList = function (paras, listName) {\r\n      var head = list.head(paras);\r\n      var last = list.last(paras);\r\n\r\n      var prevList = dom.isList(head.previousSibling) && head.previousSibling;\r\n      var nextList = dom.isList(last.nextSibling) && last.nextSibling;\r\n\r\n      var listNode = prevList || dom.insertAfter(dom.create(listName || 'UL'), last);\r\n\r\n      // P to LI\r\n      paras = paras.map(function (para) {\r\n        return dom.isPurePara(para) ? dom.replace(para, 'LI') : para;\r\n      });\r\n\r\n      // append to list(<ul>, <ol>)\r\n      dom.appendChildNodes(listNode, paras);\r\n\r\n      if (nextList) {\r\n        dom.appendChildNodes(listNode, list.from(nextList.childNodes));\r\n        dom.remove(nextList);\r\n      }\r\n\r\n      return paras;\r\n    };\r\n\r\n    /**\r\n     * @method releaseList\r\n     *\r\n     * @param {Array[]} clustereds\r\n     * @param {Boolean} isEscapseToBody\r\n     * @return {Node[]}\r\n     */\r\n    this.releaseList = function (clustereds, isEscapseToBody) {\r\n      var releasedParas = [];\r\n\r\n      $.each(clustereds, function (idx, paras) {\r\n        var head = list.head(paras);\r\n        var last = list.last(paras);\r\n\r\n        var headList = isEscapseToBody ? dom.lastAncestor(head, dom.isList) :\r\n                                         head.parentNode;\r\n        var lastList = headList.childNodes.length > 1 ? dom.splitTree(headList, {\r\n          node: last.parentNode,\r\n          offset: dom.position(last) + 1\r\n        }, {\r\n          isSkipPaddingBlankHTML: true\r\n        }) : null;\r\n\r\n        var middleList = dom.splitTree(headList, {\r\n          node: head.parentNode,\r\n          offset: dom.position(head)\r\n        }, {\r\n          isSkipPaddingBlankHTML: true\r\n        });\r\n\r\n        paras = isEscapseToBody ? dom.listDescendant(middleList, dom.isLi) :\r\n                                  list.from(middleList.childNodes).filter(dom.isLi);\r\n\r\n        // LI to P\r\n        if (isEscapseToBody || !dom.isList(headList.parentNode)) {\r\n          paras = paras.map(function (para) {\r\n            return dom.replace(para, 'P');\r\n          });\r\n        }\r\n\r\n        $.each(list.from(paras).reverse(), function (idx, para) {\r\n          dom.insertAfter(para, headList);\r\n        });\r\n\r\n        // remove empty lists\r\n        var rootLists = list.compact([headList, middleList, lastList]);\r\n        $.each(rootLists, function (idx, rootList) {\r\n          var listNodes = [rootList].concat(dom.listDescendant(rootList, dom.isList));\r\n          $.each(listNodes.reverse(), function (idx, listNode) {\r\n            if (!dom.nodeLength(listNode)) {\r\n              dom.remove(listNode, true);\r\n            }\r\n          });\r\n        });\r\n\r\n        releasedParas = releasedParas.concat(paras);\r\n      });\r\n\r\n      return releasedParas;\r\n    };\r\n  };\r\n\r\n\r\n  /**\r\n   * @class editing.Typing\r\n   *\r\n   * Typing\r\n   *\r\n   */\r\n  var Typing = function () {\r\n\r\n    // a Bullet instance to toggle lists off\r\n    var bullet = new Bullet();\r\n\r\n    /**\r\n     * insert tab\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {WrappedRange} rng\r\n     * @param {Number} tabsize\r\n     */\r\n    this.insertTab = function ($editable, rng, tabsize) {\r\n      var tab = dom.createText(new Array(tabsize + 1).join(dom.NBSP_CHAR));\r\n      rng = rng.deleteContents();\r\n      rng.insertNode(tab, true);\r\n\r\n      rng = range.create(tab, tabsize);\r\n      rng.select();\r\n    };\r\n\r\n    /**\r\n     * insert paragraph\r\n     */\r\n    this.insertParagraph = function () {\r\n      var rng = range.create();\r\n\r\n      // deleteContents on range.\r\n      rng = rng.deleteContents();\r\n\r\n      // Wrap range if it needs to be wrapped by paragraph\r\n      rng = rng.wrapBodyInlineWithPara();\r\n\r\n      // finding paragraph\r\n      var splitRoot = dom.ancestor(rng.sc, dom.isPara);\r\n\r\n      var nextPara;\r\n      // on paragraph: split paragraph\r\n      if (splitRoot) {\r\n        // if it is an empty line with li\r\n        if (dom.isEmpty(splitRoot) && dom.isLi(splitRoot)) {\r\n          // disable UL/OL and escape!\r\n          bullet.toggleList(splitRoot.parentNode.nodeName);\r\n          return;\r\n        // if new line has content (not a line break)\r\n        } else {\r\n          nextPara = dom.splitTree(splitRoot, rng.getStartPoint());\r\n\r\n          var emptyAnchors = dom.listDescendant(splitRoot, dom.isEmptyAnchor);\r\n          emptyAnchors = emptyAnchors.concat(dom.listDescendant(nextPara, dom.isEmptyAnchor));\r\n\r\n          $.each(emptyAnchors, function (idx, anchor) {\r\n            dom.remove(anchor);\r\n          });\r\n        }\r\n      // no paragraph: insert empty paragraph\r\n      } else {\r\n        var next = rng.sc.childNodes[rng.so];\r\n        nextPara = $(dom.emptyPara)[0];\r\n        if (next) {\r\n          rng.sc.insertBefore(nextPara, next);\r\n        } else {\r\n          rng.sc.appendChild(nextPara);\r\n        }\r\n      }\r\n\r\n      range.create(nextPara, 0).normalize().select();\r\n\r\n    };\r\n\r\n  };\r\n\r\n  /**\r\n   * @class editing.Table\r\n   *\r\n   * Table\r\n   *\r\n   */\r\n  var Table = function () {\r\n    /**\r\n     * handle tab key\r\n     *\r\n     * @param {WrappedRange} rng\r\n     * @param {Boolean} isShift\r\n     */\r\n    this.tab = function (rng, isShift) {\r\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\r\n      var table = dom.ancestor(cell, dom.isTable);\r\n      var cells = dom.listDescendant(table, dom.isCell);\r\n\r\n      var nextCell = list[isShift ? 'prev' : 'next'](cells, cell);\r\n      if (nextCell) {\r\n        range.create(nextCell, 0).select();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * create empty table element\r\n     *\r\n     * @param {Number} rowCount\r\n     * @param {Number} colCount\r\n     * @return {Node}\r\n     */\r\n    this.createTable = function (colCount, rowCount) {\r\n      var tds = [], tdHTML;\r\n      for (var idxCol = 0; idxCol < colCount; idxCol++) {\r\n        tds.push('<td>' + dom.blank + '</td>');\r\n      }\r\n      tdHTML = tds.join('');\r\n\r\n      var trs = [], trHTML;\r\n      for (var idxRow = 0; idxRow < rowCount; idxRow++) {\r\n        trs.push('<tr>' + tdHTML + '</tr>');\r\n      }\r\n      trHTML = trs.join('');\r\n      return $('<table class=\"table table-bordered\">' + trHTML + '</table>')[0];\r\n    };\r\n  };\r\n\r\n\r\n  var KEY_BOGUS = 'bogus';\r\n\r\n  /**\r\n   * @class editing.Editor\r\n   *\r\n   * Editor\r\n   *\r\n   */\r\n  var Editor = function (handler) {\r\n\r\n    var self = this;\r\n    var style = new Style();\r\n    var table = new Table();\r\n    var typing = new Typing();\r\n    var bullet = new Bullet();\r\n\r\n    /**\r\n     * @method createRange\r\n     *\r\n     * create range\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @return {WrappedRange}\r\n     */\r\n    this.createRange = function ($editable) {\r\n      this.focus($editable);\r\n      return range.create();\r\n    };\r\n\r\n    /**\r\n     * @method saveRange\r\n     *\r\n     * save current range\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {Boolean} [thenCollapse=false]\r\n     */\r\n    this.saveRange = function ($editable, thenCollapse) {\r\n      this.focus($editable);\r\n      $editable.data('range', range.create());\r\n      if (thenCollapse) {\r\n        range.create().collapse().select();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method saveRange\r\n     *\r\n     * save current node list to $editable.data('childNodes')\r\n     *\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.saveNode = function ($editable) {\r\n      // copy child node reference\r\n      var copy = [];\r\n      for (var key  = 0, len = $editable[0].childNodes.length; key < len; key++) {\r\n        copy.push($editable[0].childNodes[key]);\r\n      }\r\n      $editable.data('childNodes', copy);\r\n    };\r\n\r\n    /**\r\n     * @method restoreRange\r\n     *\r\n     * restore lately range\r\n     *\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.restoreRange = function ($editable) {\r\n      var rng = $editable.data('range');\r\n      if (rng) {\r\n        rng.select();\r\n        this.focus($editable);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method restoreNode\r\n     *\r\n     * restore lately node list\r\n     *\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.restoreNode = function ($editable) {\r\n      $editable.html('');\r\n      var child = $editable.data('childNodes');\r\n      for (var index = 0, len = child.length; index < len; index++) {\r\n        $editable[0].appendChild(child[index]);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method currentStyle\r\n     *\r\n     * current style\r\n     *\r\n     * @param {Node} target\r\n     * @return {Object|Boolean} unfocus\r\n     */\r\n    this.currentStyle = function (target) {\r\n      var rng = range.create();\r\n      var styleInfo =  rng && rng.isOnEditable() ? style.current(rng.normalize()) : {};\r\n      if (dom.isImg(target)) {\r\n        styleInfo.image = target;\r\n      }\r\n      return styleInfo;\r\n    };\r\n\r\n    /**\r\n     * style from node\r\n     *\r\n     * @param {jQuery} $node\r\n     * @return {Object}\r\n     */\r\n    this.styleFromNode = function ($node) {\r\n      return style.fromNode($node);\r\n    };\r\n\r\n    var triggerOnBeforeChange = function ($editable) {\r\n      var $holder = dom.makeLayoutInfo($editable).holder();\r\n      handler.bindCustomEvent(\r\n        $holder, $editable.data('callbacks'), 'before.command'\r\n      )($editable.html(), $editable);\r\n    };\r\n\r\n    var triggerOnChange = function ($editable) {\r\n      var $holder = dom.makeLayoutInfo($editable).holder();\r\n      handler.bindCustomEvent(\r\n        $holder, $editable.data('callbacks'), 'change'\r\n      )($editable.html(), $editable);\r\n    };\r\n\r\n    /**\r\n     * @method undo\r\n     * undo\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.undo = function ($editable) {\r\n      triggerOnBeforeChange($editable);\r\n      $editable.data('NoteHistory').undo();\r\n      triggerOnChange($editable);\r\n    };\r\n\r\n    /**\r\n     * @method redo\r\n     * redo\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.redo = function ($editable) {\r\n      triggerOnBeforeChange($editable);\r\n      $editable.data('NoteHistory').redo();\r\n      triggerOnChange($editable);\r\n    };\r\n\r\n    /**\r\n     * @method beforeCommand\r\n     * before command\r\n     * @param {jQuery} $editable\r\n     */\r\n    var beforeCommand = this.beforeCommand = function ($editable) {\r\n      triggerOnBeforeChange($editable);\r\n      // keep focus on editable before command execution\r\n      self.focus($editable);\r\n    };\r\n\r\n    /**\r\n     * @method afterCommand\r\n     * after command\r\n     * @param {jQuery} $editable\r\n     * @param {Boolean} isPreventTrigger\r\n     */\r\n    var afterCommand = this.afterCommand = function ($editable, isPreventTrigger) {\r\n      $editable.data('NoteHistory').recordUndo();\r\n      if (!isPreventTrigger) {\r\n        triggerOnChange($editable);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method bold\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method italic\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method underline\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method strikethrough\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method formatBlock\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method superscript\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method subscript\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method justifyLeft\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method justifyCenter\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method justifyRight\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method justifyFull\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method formatBlock\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method removeFormat\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method backColor\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method foreColor\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method insertHorizontalRule\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /**\r\n     * @method fontName\r\n     *\r\n     * change font name\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {Mixed} value\r\n     */\r\n\r\n    /* jshint ignore:start */\r\n    // native commands(with execCommand), generate function for execCommand\r\n    var commands = ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript',\r\n                    'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull',\r\n                    'formatBlock', 'removeFormat',\r\n                    'backColor', 'foreColor', 'fontName'];\r\n\r\n    for (var idx = 0, len = commands.length; idx < len; idx ++) {\r\n      this[commands[idx]] = (function (sCmd) {\r\n        return function ($editable, value) {\r\n          beforeCommand($editable);\r\n\r\n          document.execCommand(sCmd, false, value);\r\n\r\n          afterCommand($editable, true);\r\n        };\r\n      })(commands[idx]);\r\n    }\r\n    /* jshint ignore:end */\r\n\r\n    /**\r\n     * @method tab\r\n     *\r\n     * handle tab key\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {Object} options\r\n     */\r\n    this.tab = function ($editable, options) {\r\n      var rng = this.createRange($editable);\r\n      if (rng.isCollapsed() && rng.isOnCell()) {\r\n        table.tab(rng);\r\n      } else {\r\n        beforeCommand($editable);\r\n        typing.insertTab($editable, rng, options.tabsize);\r\n        afterCommand($editable);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method untab\r\n     *\r\n     * handle shift+tab key\r\n     *\r\n     */\r\n    this.untab = function ($editable) {\r\n      var rng = this.createRange($editable);\r\n      if (rng.isCollapsed() && rng.isOnCell()) {\r\n        table.tab(rng, true);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @method insertParagraph\r\n     *\r\n     * insert paragraph\r\n     *\r\n     * @param {Node} $editable\r\n     */\r\n    this.insertParagraph = function ($editable) {\r\n      beforeCommand($editable);\r\n      typing.insertParagraph($editable);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * @method insertOrderedList\r\n     *\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.insertOrderedList = function ($editable) {\r\n      beforeCommand($editable);\r\n      bullet.insertOrderedList($editable);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.insertUnorderedList = function ($editable) {\r\n      beforeCommand($editable);\r\n      bullet.insertUnorderedList($editable);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.indent = function ($editable) {\r\n      beforeCommand($editable);\r\n      bullet.indent($editable);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.outdent = function ($editable) {\r\n      beforeCommand($editable);\r\n      bullet.outdent($editable);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * insert image\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} sUrl\r\n     */\r\n    this.insertImage = function ($editable, sUrl, filename) {\r\n      async.createImage(sUrl, filename).then(function ($image) {\r\n        beforeCommand($editable);\r\n        $image.css({\r\n          display: '',\r\n          width: Math.min($editable.width(), $image.width())\r\n        });\r\n        range.create().insertNode($image[0]);\r\n        range.createFromNodeAfter($image[0]).select();\r\n        afterCommand($editable);\r\n      }).fail(function () {\r\n        var $holder = dom.makeLayoutInfo($editable).holder();\r\n        handler.bindCustomEvent(\r\n          $holder, $editable.data('callbacks'), 'image.upload.error'\r\n        )();\r\n      });\r\n    };\r\n\r\n    /**\r\n     * @method insertNode\r\n     * insert node\r\n     * @param {Node} $editable\r\n     * @param {Node} node\r\n     */\r\n    this.insertNode = function ($editable, node) {\r\n      beforeCommand($editable);\r\n      range.create().insertNode(node);\r\n      range.createFromNodeAfter(node).select();\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * insert text\r\n     * @param {Node} $editable\r\n     * @param {String} text\r\n     */\r\n    this.insertText = function ($editable, text) {\r\n      beforeCommand($editable);\r\n      var textNode = range.create().insertNode(dom.createText(text));\r\n      range.create(textNode, dom.nodeLength(textNode)).select();\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * paste HTML\r\n     * @param {Node} $editable\r\n     * @param {String} markup\r\n     */\r\n    this.pasteHTML = function ($editable, markup) {\r\n      beforeCommand($editable);\r\n      var contents = range.create().pasteHTML(markup);\r\n      range.createFromNodeAfter(list.last(contents)).select();\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * formatBlock\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} tagName\r\n     */\r\n    this.formatBlock = function ($editable, tagName) {\r\n      beforeCommand($editable);\r\n      // [workaround] for MSIE, IE need `<`\r\n      tagName = agent.isMSIE ? '<' + tagName + '>' : tagName;\r\n      document.execCommand('FormatBlock', false, tagName);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    this.formatPara = function ($editable) {\r\n      beforeCommand($editable);\r\n      this.formatBlock($editable, 'P');\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /* jshint ignore:start */\r\n    for (var idx = 1; idx <= 6; idx ++) {\r\n      this['formatH' + idx] = function (idx) {\r\n        return function ($editable) {\r\n          this.formatBlock($editable, 'H' + idx);\r\n        };\r\n      }(idx);\r\n    };\r\n    /* jshint ignore:end */\r\n\r\n    /**\r\n     * fontSize\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} value - px\r\n     */\r\n    this.fontSize = function ($editable, value) {\r\n      var rng = range.create();\r\n\r\n      if (rng.isCollapsed()) {\r\n        var spans = style.styleNodes(rng);\r\n        var firstSpan = list.head(spans);\r\n\r\n        $(spans).css({\r\n          'font-size': value + 'px'\r\n        });\r\n\r\n        // [workaround] added styled bogus span for style\r\n        //  - also bogus character needed for cursor position\r\n        if (firstSpan && !dom.nodeLength(firstSpan)) {\r\n          firstSpan.innerHTML = dom.ZERO_WIDTH_NBSP_CHAR;\r\n          range.createFromNodeAfter(firstSpan.firstChild).select();\r\n          $editable.data(KEY_BOGUS, firstSpan);\r\n        }\r\n      } else {\r\n        beforeCommand($editable);\r\n        $(style.styleNodes(rng)).css({\r\n          'font-size': value + 'px'\r\n        });\r\n        afterCommand($editable);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * insert horizontal rule\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.insertHorizontalRule = function ($editable) {\r\n      beforeCommand($editable);\r\n\r\n      var rng = range.create();\r\n      var hrNode = rng.insertNode($('<HR/>')[0]);\r\n      if (hrNode.nextSibling) {\r\n        range.create(hrNode.nextSibling, 0).normalize().select();\r\n      }\r\n\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * remove bogus node and character\r\n     */\r\n    this.removeBogus = function ($editable) {\r\n      var bogusNode = $editable.data(KEY_BOGUS);\r\n      if (!bogusNode) {\r\n        return;\r\n      }\r\n\r\n      var textNode = list.find(list.from(bogusNode.childNodes), dom.isText);\r\n\r\n      var bogusCharIdx = textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);\r\n      if (bogusCharIdx !== -1) {\r\n        textNode.deleteData(bogusCharIdx, 1);\r\n      }\r\n\r\n      if (dom.isEmpty(bogusNode)) {\r\n        dom.remove(bogusNode);\r\n      }\r\n\r\n      $editable.removeData(KEY_BOGUS);\r\n    };\r\n\r\n    /**\r\n     * lineHeight\r\n     * @param {jQuery} $editable\r\n     * @param {String} value\r\n     */\r\n    this.lineHeight = function ($editable, value) {\r\n      beforeCommand($editable);\r\n      style.stylePara(range.create(), {\r\n        lineHeight: value\r\n      });\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * unlink\r\n     *\r\n     * @type command\r\n     *\r\n     * @param {jQuery} $editable\r\n     */\r\n    this.unlink = function ($editable) {\r\n      var rng = this.createRange($editable);\r\n      if (rng.isOnAnchor()) {\r\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\r\n        rng = range.createFromNode(anchor);\r\n        rng.select();\r\n\r\n        beforeCommand($editable);\r\n        document.execCommand('unlink');\r\n        afterCommand($editable);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * create link (command)\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {Object} linkInfo\r\n     * @param {Object} options\r\n     */\r\n    this.createLink = function ($editable, linkInfo, options) {\r\n      var linkUrl = linkInfo.url;\r\n      var linkText = linkInfo.text;\r\n      var isNewWindow = linkInfo.isNewWindow;\r\n      var rng = linkInfo.range || this.createRange($editable);\r\n      var isTextChanged = rng.toString() !== linkText;\r\n\r\n      options = options || dom.makeLayoutInfo($editable).editor().data('options');\r\n\r\n      beforeCommand($editable);\r\n\r\n      if (options.onCreateLink) {\r\n        linkUrl = options.onCreateLink(linkUrl);\r\n      }\r\n\r\n      var anchors = [];\r\n      if (isTextChanged) {\r\n        // Create a new link when text changed.\r\n        var anchor = rng.insertNode($('<A>' + linkText + '</A>')[0]);\r\n        anchors.push(anchor);\r\n      } else {\r\n        anchors = style.styleNodes(rng, {\r\n          nodeName: 'A',\r\n          expandClosestSibling: true,\r\n          onlyPartialContains: true\r\n        });\r\n      }\r\n\r\n      $.each(anchors, function (idx, anchor) {\r\n        $(anchor).attr('href', linkUrl);\r\n        if (isNewWindow) {\r\n          $(anchor).attr('target', '_blank');\r\n        } else {\r\n          $(anchor).removeAttr('target');\r\n        }\r\n      });\r\n\r\n      var startRange = range.createFromNodeBefore(list.head(anchors));\r\n      var startPoint = startRange.getStartPoint();\r\n      var endRange = range.createFromNodeAfter(list.last(anchors));\r\n      var endPoint = endRange.getEndPoint();\r\n\r\n      range.create(\r\n        startPoint.node,\r\n        startPoint.offset,\r\n        endPoint.node,\r\n        endPoint.offset\r\n      ).select();\r\n\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * returns link info\r\n     *\r\n     * @return {Object}\r\n     * @return {WrappedRange} return.range\r\n     * @return {String} return.text\r\n     * @return {Boolean} [return.isNewWindow=true]\r\n     * @return {String} [return.url=\"\"]\r\n     */\r\n    this.getLinkInfo = function ($editable) {\r\n      this.focus($editable);\r\n\r\n      var rng = range.create().expand(dom.isAnchor);\r\n\r\n      // Get the first anchor on range(for edit).\r\n      var $anchor = $(list.head(rng.nodes(dom.isAnchor)));\r\n\r\n      return {\r\n        range: rng,\r\n        text: rng.toString(),\r\n        isNewWindow: $anchor.length ? $anchor.attr('target') === '_blank' : false,\r\n        url: $anchor.length ? $anchor.attr('href') : ''\r\n      };\r\n    };\r\n\r\n    /**\r\n     * setting color\r\n     *\r\n     * @param {Node} $editable\r\n     * @param {Object} sObjColor  color code\r\n     * @param {String} sObjColor.foreColor foreground color\r\n     * @param {String} sObjColor.backColor background color\r\n     */\r\n    this.color = function ($editable, sObjColor) {\r\n      var oColor = JSON.parse(sObjColor);\r\n      var foreColor = oColor.foreColor, backColor = oColor.backColor;\r\n\r\n      beforeCommand($editable);\r\n\r\n      if (foreColor) { document.execCommand('foreColor', false, foreColor); }\r\n      if (backColor) { document.execCommand('backColor', false, backColor); }\r\n\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * insert Table\r\n     *\r\n     * @param {Node} $editable\r\n     * @param {String} sDim dimension of table (ex : \"5x5\")\r\n     */\r\n    this.insertTable = function ($editable, sDim) {\r\n      var dimension = sDim.split('x');\r\n      beforeCommand($editable);\r\n\r\n      var rng = range.create().deleteContents();\r\n      rng.insertNode(table.createTable(dimension[0], dimension[1]));\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * float me\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} value\r\n     * @param {jQuery} $target\r\n     */\r\n    this.floatMe = function ($editable, value, $target) {\r\n      beforeCommand($editable);\r\n      // bootstrap\r\n      $target.removeClass('pull-left pull-right');\r\n      if (value && value !== 'none') {\r\n        $target.addClass('pull-' + value);\r\n      }\r\n\r\n      // fallback for non-bootstrap\r\n      $target.css('float', value);\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * change image shape\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} value css class\r\n     * @param {Node} $target\r\n     */\r\n    this.imageShape = function ($editable, value, $target) {\r\n      beforeCommand($editable);\r\n\r\n      $target.removeClass('img-rounded img-circle img-thumbnail');\r\n\r\n      if (value) {\r\n        $target.addClass(value);\r\n      }\r\n\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * resize overlay element\r\n     * @param {jQuery} $editable\r\n     * @param {String} value\r\n     * @param {jQuery} $target - target element\r\n     */\r\n    this.resize = function ($editable, value, $target) {\r\n      beforeCommand($editable);\r\n\r\n      $target.css({\r\n        width: value * 100 + '%',\r\n        height: ''\r\n      });\r\n\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * @param {Position} pos\r\n     * @param {jQuery} $target - target element\r\n     * @param {Boolean} [bKeepRatio] - keep ratio\r\n     */\r\n    this.resizeTo = function (pos, $target, bKeepRatio) {\r\n      var imageSize;\r\n      if (bKeepRatio) {\r\n        var newRatio = pos.y / pos.x;\r\n        var ratio = $target.data('ratio');\r\n        imageSize = {\r\n          width: ratio > newRatio ? pos.x : pos.y / ratio,\r\n          height: ratio > newRatio ? pos.x * ratio : pos.y\r\n        };\r\n      } else {\r\n        imageSize = {\r\n          width: pos.x,\r\n          height: pos.y\r\n        };\r\n      }\r\n\r\n      $target.css(imageSize);\r\n    };\r\n\r\n    /**\r\n     * remove media object\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} value - dummy argument (for keep interface)\r\n     * @param {jQuery} $target - target element\r\n     */\r\n    this.removeMedia = function ($editable, value, $target) {\r\n      beforeCommand($editable);\r\n      $target.detach();\r\n\r\n      handler.bindCustomEvent(\r\n        $(), $editable.data('callbacks'), 'media.delete'\r\n      )($target, $editable);\r\n\r\n      afterCommand($editable);\r\n    };\r\n\r\n    /**\r\n     * set focus\r\n     *\r\n     * @param $editable\r\n     */\r\n    this.focus = function ($editable) {\r\n      $editable.focus();\r\n\r\n      // [workaround] for firefox bug http://goo.gl/lVfAaI\r\n      if (agent.isFF && !range.create().isOnEditable()) {\r\n        range.createFromNode($editable[0])\r\n             .normalize()\r\n             .collapse()\r\n             .select();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * returns whether contents is empty or not.\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @return {Boolean}\r\n     */\r\n    this.isEmpty = function ($editable) {\r\n      return dom.isEmpty($editable[0]) || dom.emptyPara === $editable.html();\r\n    };\r\n  };\r\n\r\n  /**\r\n   * @class module.Button\r\n   *\r\n   * Button\r\n   */\r\n  var Button = function () {\r\n    /**\r\n     * update button status\r\n     *\r\n     * @param {jQuery} $container\r\n     * @param {Object} styleInfo\r\n     */\r\n    this.update = function ($container, styleInfo) {\r\n      /**\r\n       * handle dropdown's check mark (for fontname, fontsize, lineHeight).\r\n       * @param {jQuery} $btn\r\n       * @param {Number} value\r\n       */\r\n      var checkDropdownMenu = function ($btn, value) {\r\n        $btn.find('.dropdown-menu li a').each(function () {\r\n          // always compare string to avoid creating another func.\r\n          var isChecked = ($(this).data('value') + '') === (value + '');\r\n          this.className = isChecked ? 'checked' : '';\r\n        });\r\n      };\r\n\r\n      /**\r\n       * update button state(active or not).\r\n       *\r\n       * @private\r\n       * @param {String} selector\r\n       * @param {Function} pred\r\n       */\r\n      var btnState = function (selector, pred) {\r\n        var $btn = $container.find(selector);\r\n        $btn.toggleClass('active', pred());\r\n      };\r\n\r\n      if (styleInfo.image) {\r\n        var $img = $(styleInfo.image);\r\n\r\n        btnState('button[data-event=\"imageShape\"][data-value=\"img-rounded\"]', function () {\r\n          return $img.hasClass('img-rounded');\r\n        });\r\n        btnState('button[data-event=\"imageShape\"][data-value=\"img-circle\"]', function () {\r\n          return $img.hasClass('img-circle');\r\n        });\r\n        btnState('button[data-event=\"imageShape\"][data-value=\"img-thumbnail\"]', function () {\r\n          return $img.hasClass('img-thumbnail');\r\n        });\r\n        btnState('button[data-event=\"imageShape\"]:not([data-value])', function () {\r\n          return !$img.is('.img-rounded, .img-circle, .img-thumbnail');\r\n        });\r\n\r\n        var imgFloat = $img.css('float');\r\n        btnState('button[data-event=\"floatMe\"][data-value=\"left\"]', function () {\r\n          return imgFloat === 'left';\r\n        });\r\n        btnState('button[data-event=\"floatMe\"][data-value=\"right\"]', function () {\r\n          return imgFloat === 'right';\r\n        });\r\n        btnState('button[data-event=\"floatMe\"][data-value=\"none\"]', function () {\r\n          return imgFloat !== 'left' && imgFloat !== 'right';\r\n        });\r\n\r\n        var style = $img.attr('style');\r\n        btnState('button[data-event=\"resize\"][data-value=\"1\"]', function () {\r\n          return !!/(^|\\s)(max-)?width\\s*:\\s*100%/.test(style);\r\n        });\r\n        btnState('button[data-event=\"resize\"][data-value=\"0.5\"]', function () {\r\n          return !!/(^|\\s)(max-)?width\\s*:\\s*50%/.test(style);\r\n        });\r\n        btnState('button[data-event=\"resize\"][data-value=\"0.25\"]', function () {\r\n          return !!/(^|\\s)(max-)?width\\s*:\\s*25%/.test(style);\r\n        });\r\n        return;\r\n      }\r\n\r\n      // fontname\r\n      var $fontname = $container.find('.note-fontname');\r\n      if ($fontname.length) {\r\n        var selectedFont = styleInfo['font-family'];\r\n        if (!!selectedFont) {\r\n\r\n          var list = selectedFont.split(',');\r\n          for (var i = 0, len = list.length; i < len; i++) {\r\n            selectedFont = list[i].replace(/[\\'\\\"]/g, '').replace(/\\s+$/, '').replace(/^\\s+/, '');\r\n            if (agent.isFontInstalled(selectedFont)) {\r\n              break;\r\n            }\r\n          }\r\n          \r\n          $fontname.find('.note-current-fontname').text(selectedFont);\r\n          checkDropdownMenu($fontname, selectedFont);\r\n\r\n        }\r\n      }\r\n\r\n      // fontsize\r\n      var $fontsize = $container.find('.note-fontsize');\r\n      $fontsize.find('.note-current-fontsize').text(styleInfo['font-size']);\r\n      checkDropdownMenu($fontsize, parseFloat(styleInfo['font-size']));\r\n\r\n      // lineheight\r\n      var $lineHeight = $container.find('.note-height');\r\n      checkDropdownMenu($lineHeight, parseFloat(styleInfo['line-height']));\r\n\r\n      btnState('button[data-event=\"bold\"]', function () {\r\n        return styleInfo['font-bold'] === 'bold';\r\n      });\r\n      btnState('button[data-event=\"italic\"]', function () {\r\n        return styleInfo['font-italic'] === 'italic';\r\n      });\r\n      btnState('button[data-event=\"underline\"]', function () {\r\n        return styleInfo['font-underline'] === 'underline';\r\n      });\r\n      btnState('button[data-event=\"strikethrough\"]', function () {\r\n        return styleInfo['font-strikethrough'] === 'strikethrough';\r\n      });\r\n      btnState('button[data-event=\"superscript\"]', function () {\r\n        return styleInfo['font-superscript'] === 'superscript';\r\n      });\r\n      btnState('button[data-event=\"subscript\"]', function () {\r\n        return styleInfo['font-subscript'] === 'subscript';\r\n      });\r\n      btnState('button[data-event=\"justifyLeft\"]', function () {\r\n        return styleInfo['text-align'] === 'left' || styleInfo['text-align'] === 'start';\r\n      });\r\n      btnState('button[data-event=\"justifyCenter\"]', function () {\r\n        return styleInfo['text-align'] === 'center';\r\n      });\r\n      btnState('button[data-event=\"justifyRight\"]', function () {\r\n        return styleInfo['text-align'] === 'right';\r\n      });\r\n      btnState('button[data-event=\"justifyFull\"]', function () {\r\n        return styleInfo['text-align'] === 'justify';\r\n      });\r\n      btnState('button[data-event=\"insertUnorderedList\"]', function () {\r\n        return styleInfo['list-style'] === 'unordered';\r\n      });\r\n      btnState('button[data-event=\"insertOrderedList\"]', function () {\r\n        return styleInfo['list-style'] === 'ordered';\r\n      });\r\n    };\r\n\r\n    /**\r\n     * update recent color\r\n     *\r\n     * @param {Node} button\r\n     * @param {String} eventName\r\n     * @param {Mixed} value\r\n     */\r\n    this.updateRecentColor = function (button, eventName, value) {\r\n      var $color = $(button).closest('.note-color');\r\n      var $recentColor = $color.find('.note-recent-color');\r\n      var colorInfo = JSON.parse($recentColor.attr('data-value'));\r\n      colorInfo[eventName] = value;\r\n      $recentColor.attr('data-value', JSON.stringify(colorInfo));\r\n      var sKey = eventName === 'backColor' ? 'background-color' : 'color';\r\n      $recentColor.find('i').css(sKey, value);\r\n    };\r\n  };\r\n\r\n  /**\r\n   * @class module.Toolbar\r\n   *\r\n   * Toolbar\r\n   */\r\n  var Toolbar = function () {\r\n    var button = new Button();\r\n\r\n    this.update = function ($toolbar, styleInfo) {\r\n      button.update($toolbar, styleInfo);\r\n    };\r\n\r\n    /**\r\n     * @param {Node} button\r\n     * @param {String} eventName\r\n     * @param {String} value\r\n     */\r\n    this.updateRecentColor = function (buttonNode, eventName, value) {\r\n      button.updateRecentColor(buttonNode, eventName, value);\r\n    };\r\n\r\n    /**\r\n     * activate buttons exclude codeview\r\n     * @param {jQuery} $toolbar\r\n     */\r\n    this.activate = function ($toolbar) {\r\n      $toolbar.find('button')\r\n              .not('button[data-event=\"codeview\"]')\r\n              .removeClass('disabled');\r\n    };\r\n\r\n    /**\r\n     * deactivate buttons exclude codeview\r\n     * @param {jQuery} $toolbar\r\n     */\r\n    this.deactivate = function ($toolbar) {\r\n      $toolbar.find('button')\r\n              .not('button[data-event=\"codeview\"]')\r\n              .addClass('disabled');\r\n    };\r\n\r\n    /**\r\n     * @param {jQuery} $container\r\n     * @param {Boolean} [bFullscreen=false]\r\n     */\r\n    this.updateFullscreen = function ($container, bFullscreen) {\r\n      var $btn = $container.find('button[data-event=\"fullscreen\"]');\r\n      $btn.toggleClass('active', bFullscreen);\r\n    };\r\n\r\n    /**\r\n     * @param {jQuery} $container\r\n     * @param {Boolean} [isCodeview=false]\r\n     */\r\n    this.updateCodeview = function ($container, isCodeview) {\r\n      var $btn = $container.find('button[data-event=\"codeview\"]');\r\n      $btn.toggleClass('active', isCodeview);\r\n\r\n      if (isCodeview) {\r\n        this.deactivate($container);\r\n      } else {\r\n        this.activate($container);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * get button in toolbar \r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {String} name\r\n     * @return {jQuery}\r\n     */\r\n    this.get = function ($editable, name) {\r\n      var $toolbar = dom.makeLayoutInfo($editable).toolbar();\r\n\r\n      return $toolbar.find('[data-name=' + name + ']');\r\n    };\r\n\r\n    /**\r\n     * set button state\r\n     * @param {jQuery} $editable\r\n     * @param {String} name\r\n     * @param {Boolean} [isActive=true]\r\n     */\r\n    this.setButtonState = function ($editable, name, isActive) {\r\n      isActive = (isActive === false) ? false : true;\r\n\r\n      var $button = this.get($editable, name);\r\n      $button.toggleClass('active', isActive);\r\n    };\r\n  };\r\n\r\n  var EDITABLE_PADDING = 24;\r\n\r\n  var Statusbar = function () {\r\n    var $document = $(document);\r\n\r\n    this.attach = function (layoutInfo, options) {\r\n      if (!options.disableResizeEditor) {\r\n        layoutInfo.statusbar().on('mousedown', hStatusbarMousedown);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * `mousedown` event handler on statusbar\r\n     *\r\n     * @param {MouseEvent} event\r\n     */\r\n    var hStatusbarMousedown = function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      var $editable = dom.makeLayoutInfo(event.target).editable();\r\n      var editableTop = $editable.offset().top - $document.scrollTop();\r\n\r\n      var layoutInfo = dom.makeLayoutInfo(event.currentTarget || event.target);\r\n      var options = layoutInfo.editor().data('options');\r\n\r\n      $document.on('mousemove', function (event) {\r\n        var nHeight = event.clientY - (editableTop + EDITABLE_PADDING);\r\n\r\n        nHeight = (options.minHeight > 0) ? Math.max(nHeight, options.minHeight) : nHeight;\r\n        nHeight = (options.maxHeight > 0) ? Math.min(nHeight, options.maxHeight) : nHeight;\r\n\r\n        $editable.height(nHeight);\r\n      }).one('mouseup', function () {\r\n        $document.off('mousemove');\r\n      });\r\n    };\r\n  };\r\n\r\n  /**\r\n   * @class module.Popover\r\n   *\r\n   * Popover (http://getbootstrap.com/javascript/#popovers)\r\n   *\r\n   */\r\n  var Popover = function () {\r\n    var button = new Button();\r\n\r\n    /**\r\n     * returns position from placeholder\r\n     *\r\n     * @private\r\n     * @param {Node} placeholder\r\n     * @param {Object} options\r\n     * @param {Boolean} options.isAirMode\r\n     * @return {Position}\r\n     */\r\n    var posFromPlaceholder = function (placeholder, options) {\r\n      var isAirMode = options && options.isAirMode;\r\n      var isLeftTop = options && options.isLeftTop;\r\n\r\n      var $placeholder = $(placeholder);\r\n      var pos = isAirMode ? $placeholder.offset() : $placeholder.position();\r\n      var height = isLeftTop ? 0 : $placeholder.outerHeight(true); // include margin\r\n\r\n      // popover below placeholder.\r\n      return {\r\n        left: pos.left,\r\n        top: pos.top + height\r\n      };\r\n    };\r\n\r\n    /**\r\n     * show popover\r\n     *\r\n     * @private\r\n     * @param {jQuery} popover\r\n     * @param {Position} pos\r\n     */\r\n    var showPopover = function ($popover, pos) {\r\n      $popover.css({\r\n        display: 'block',\r\n        left: pos.left,\r\n        top: pos.top\r\n      });\r\n    };\r\n\r\n    var PX_POPOVER_ARROW_OFFSET_X = 20;\r\n\r\n    /**\r\n     * update current state\r\n     * @param {jQuery} $popover - popover container\r\n     * @param {Object} styleInfo - style object\r\n     * @param {Boolean} isAirMode\r\n     */\r\n    this.update = function ($popover, styleInfo, isAirMode) {\r\n      button.update($popover, styleInfo);\r\n\r\n      var $linkPopover = $popover.find('.note-link-popover');\r\n      if (styleInfo.anchor) {\r\n        var $anchor = $linkPopover.find('a');\r\n        var href = $(styleInfo.anchor).attr('href');\r\n        var target = $(styleInfo.anchor).attr('target');\r\n        $anchor.attr('href', href).html(href);\r\n        if (!target) {\r\n          $anchor.removeAttr('target');\r\n        } else {\r\n          $anchor.attr('target', '_blank');\r\n        }\r\n        showPopover($linkPopover, posFromPlaceholder(styleInfo.anchor, {\r\n          isAirMode: isAirMode\r\n        }));\r\n      } else {\r\n        $linkPopover.hide();\r\n      }\r\n\r\n      var $imagePopover = $popover.find('.note-image-popover');\r\n      if (styleInfo.image) {\r\n        showPopover($imagePopover, posFromPlaceholder(styleInfo.image, {\r\n          isAirMode: isAirMode,\r\n          isLeftTop: true\r\n        }));\r\n      } else {\r\n        $imagePopover.hide();\r\n      }\r\n\r\n      var $airPopover = $popover.find('.note-air-popover');\r\n      if (isAirMode && styleInfo.range && !styleInfo.range.isCollapsed()) {\r\n        var rect = list.last(styleInfo.range.getClientRects());\r\n        if (rect) {\r\n          var bnd = func.rect2bnd(rect);\r\n          showPopover($airPopover, {\r\n            left: Math.max(bnd.left + bnd.width / 2 - PX_POPOVER_ARROW_OFFSET_X, 0),\r\n            top: bnd.top + bnd.height\r\n          });\r\n        }\r\n      } else {\r\n        $airPopover.hide();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @param {Node} button\r\n     * @param {String} eventName\r\n     * @param {String} value\r\n     */\r\n    this.updateRecentColor = function (button, eventName, value) {\r\n      button.updateRecentColor(button, eventName, value);\r\n    };\r\n\r\n    /**\r\n     * hide all popovers\r\n     * @param {jQuery} $popover - popover container\r\n     */\r\n    this.hide = function ($popover) {\r\n      $popover.children().hide();\r\n    };\r\n  };\r\n\r\n  /**\r\n   * @class module.Handle\r\n   *\r\n   * Handle\r\n   */\r\n  var Handle = function (handler) {\r\n    var $document = $(document);\r\n\r\n    /**\r\n     * `mousedown` event handler on $handle\r\n     *  - controlSizing: resize image\r\n     *\r\n     * @param {MouseEvent} event\r\n     */\r\n    var hHandleMousedown = function (event) {\r\n      if (dom.isControlSizing(event.target)) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        var layoutInfo = dom.makeLayoutInfo(event.target),\r\n            $handle = layoutInfo.handle(),\r\n            $popover = layoutInfo.popover(),\r\n            $editable = layoutInfo.editable(),\r\n            $editor = layoutInfo.editor();\r\n\r\n        var target = $handle.find('.note-control-selection').data('target'),\r\n            $target = $(target), posStart = $target.offset(),\r\n            scrollTop = $document.scrollTop();\r\n\r\n        var isAirMode = $editor.data('options').airMode;\r\n\r\n        $document.on('mousemove', function (event) {\r\n          handler.invoke('editor.resizeTo', {\r\n            x: event.clientX - posStart.left,\r\n            y: event.clientY - (posStart.top - scrollTop)\r\n          }, $target, !event.shiftKey);\r\n\r\n          handler.invoke('handle.update', $handle, {image: target}, isAirMode);\r\n          handler.invoke('popover.update', $popover, {image: target}, isAirMode);\r\n        }).one('mouseup', function () {\r\n          $document.off('mousemove');\r\n          handler.invoke('editor.afterCommand', $editable);\r\n        });\r\n\r\n        if (!$target.data('ratio')) { // original ratio.\r\n          $target.data('ratio', $target.height() / $target.width());\r\n        }\r\n      }\r\n    };\r\n\r\n    this.attach = function (layoutInfo) {\r\n      layoutInfo.handle().on('mousedown', hHandleMousedown);\r\n    };\r\n\r\n    /**\r\n     * update handle\r\n     * @param {jQuery} $handle\r\n     * @param {Object} styleInfo\r\n     * @param {Boolean} isAirMode\r\n     */\r\n    this.update = function ($handle, styleInfo, isAirMode) {\r\n      var $selection = $handle.find('.note-control-selection');\r\n      if (styleInfo.image) {\r\n        var $image = $(styleInfo.image);\r\n        var pos = isAirMode ? $image.offset() : $image.position();\r\n\r\n        // include margin\r\n        var imageSize = {\r\n          w: $image.outerWidth(true),\r\n          h: $image.outerHeight(true)\r\n        };\r\n\r\n        $selection.css({\r\n          display: 'block',\r\n          left: pos.left,\r\n          top: pos.top,\r\n          width: imageSize.w,\r\n          height: imageSize.h\r\n        }).data('target', styleInfo.image); // save current image element.\r\n        var sizingText = imageSize.w + 'x' + imageSize.h;\r\n        $selection.find('.note-control-selection-info').text(sizingText);\r\n      } else {\r\n        $selection.hide();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * hide\r\n     *\r\n     * @param {jQuery} $handle\r\n     */\r\n    this.hide = function ($handle) {\r\n      $handle.children().hide();\r\n    };\r\n  };\r\n\r\n  var Fullscreen = function (handler) {\r\n    var $window = $(window);\r\n    var $scrollbar = $('html, body');\r\n\r\n    /**\r\n     * toggle fullscreen\r\n     *\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.toggle = function (layoutInfo) {\r\n\r\n      var $editor = layoutInfo.editor(),\r\n          $toolbar = layoutInfo.toolbar(),\r\n          $editable = layoutInfo.editable(),\r\n          $codable = layoutInfo.codable();\r\n\r\n      var resize = function (size) {\r\n        $editable.css('height', size.h);\r\n        $codable.css('height', size.h);\r\n        if ($codable.data('cmeditor')) {\r\n          $codable.data('cmeditor').setsize(null, size.h);\r\n        }\r\n      };\r\n\r\n      $editor.toggleClass('fullscreen');\r\n      var isFullscreen = $editor.hasClass('fullscreen');\r\n      if (isFullscreen) {\r\n        $editable.data('orgheight', $editable.css('height'));\r\n\r\n        $window.on('resize', function () {\r\n          resize({\r\n            h: $window.height() - $toolbar.outerHeight()\r\n          });\r\n        }).trigger('resize');\r\n\r\n        $scrollbar.css('overflow', 'hidden');\r\n      } else {\r\n        $window.off('resize');\r\n        resize({\r\n          h: $editable.data('orgheight')\r\n        });\r\n        $scrollbar.css('overflow', 'visible');\r\n      }\r\n\r\n      handler.invoke('toolbar.updateFullscreen', $toolbar, isFullscreen);\r\n    };\r\n  };\r\n\r\n\r\n  var CodeMirror;\r\n  if (agent.hasCodeMirror) {\r\n    if (agent.isSupportAmd) {\r\n      require(['CodeMirror'], function (cm) {\r\n        CodeMirror = cm;\r\n      });\r\n    } else {\r\n      CodeMirror = window.CodeMirror;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @class Codeview\r\n   */\r\n  var Codeview = function (handler) {\r\n\r\n    this.sync = function (layoutInfo) {\r\n      var isCodeview = handler.invoke('codeview.isActivated', layoutInfo);\r\n      if (isCodeview && agent.hasCodeMirror) {\r\n        layoutInfo.codable().data('cmEditor').save();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @param {Object} layoutInfo\r\n     * @return {Boolean}\r\n     */\r\n    this.isActivated = function (layoutInfo) {\r\n      var $editor = layoutInfo.editor();\r\n      return $editor.hasClass('codeview');\r\n    };\r\n\r\n    /**\r\n     * toggle codeview\r\n     *\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.toggle = function (layoutInfo) {\r\n      if (this.isActivated(layoutInfo)) {\r\n        this.deactivate(layoutInfo);\r\n      } else {\r\n        this.activate(layoutInfo);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * activate code view\r\n     *\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.activate = function (layoutInfo) {\r\n      var $editor = layoutInfo.editor(),\r\n          $toolbar = layoutInfo.toolbar(),\r\n          $editable = layoutInfo.editable(),\r\n          $codable = layoutInfo.codable(),\r\n          $popover = layoutInfo.popover(),\r\n          $handle = layoutInfo.handle();\r\n\r\n      var options = $editor.data('options');\r\n\r\n      $codable.val(dom.html($editable, options.prettifyHtml));\r\n      $codable.height($editable.height());\r\n\r\n      handler.invoke('toolbar.updateCodeview', $toolbar, true);\r\n      handler.invoke('popover.hide', $popover);\r\n      handler.invoke('handle.hide', $handle);\r\n\r\n      $editor.addClass('codeview');\r\n\r\n      $codable.focus();\r\n\r\n      // activate CodeMirror as codable\r\n      if (agent.hasCodeMirror) {\r\n        var cmEditor = CodeMirror.fromTextArea($codable[0], options.codemirror);\r\n\r\n        // CodeMirror TernServer\r\n        if (options.codemirror.tern) {\r\n          var server = new CodeMirror.TernServer(options.codemirror.tern);\r\n          cmEditor.ternServer = server;\r\n          cmEditor.on('cursorActivity', function (cm) {\r\n            server.updateArgHints(cm);\r\n          });\r\n        }\r\n\r\n        // CodeMirror hasn't Padding.\r\n        cmEditor.setSize(null, $editable.outerHeight());\r\n        $codable.data('cmEditor', cmEditor);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * deactivate code view\r\n     *\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.deactivate = function (layoutInfo) {\r\n      var $holder = layoutInfo.holder(),\r\n          $editor = layoutInfo.editor(),\r\n          $toolbar = layoutInfo.toolbar(),\r\n          $editable = layoutInfo.editable(),\r\n          $codable = layoutInfo.codable();\r\n\r\n      var options = $editor.data('options');\r\n\r\n      // deactivate CodeMirror as codable\r\n      if (agent.hasCodeMirror) {\r\n        var cmEditor = $codable.data('cmEditor');\r\n        $codable.val(cmEditor.getValue());\r\n        cmEditor.toTextArea();\r\n      }\r\n\r\n      var value = dom.value($codable, options.prettifyHtml) || dom.emptyPara;\r\n      var isChange = $editable.html() !== value;\r\n\r\n      $editable.html(value);\r\n      $editable.height(options.height ? $codable.height() : 'auto');\r\n      $editor.removeClass('codeview');\r\n\r\n      if (isChange) {\r\n        handler.bindCustomEvent(\r\n          $holder, $editable.data('callbacks'), 'change'\r\n        )($editable.html(), $editable);\r\n      }\r\n\r\n      $editable.focus();\r\n\r\n      handler.invoke('toolbar.updateCodeview', $toolbar, false);\r\n    };\r\n  };\r\n\r\n  var DragAndDrop = function (handler) {\r\n    var $document = $(document);\r\n\r\n    /**\r\n     * attach Drag and Drop Events\r\n     *\r\n     * @param {Object} layoutInfo - layout Informations\r\n     * @param {Object} options\r\n     */\r\n    this.attach = function (layoutInfo, options) {\r\n      if (options.airMode || options.disableDragAndDrop) {\r\n        // prevent default drop event\r\n        $document.on('drop', function (e) {\r\n          e.preventDefault();\r\n        });\r\n      } else {\r\n        this.attachDragAndDropEvent(layoutInfo, options);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * attach Drag and Drop Events\r\n     *\r\n     * @param {Object} layoutInfo - layout Informations\r\n     * @param {Object} options\r\n     */\r\n    this.attachDragAndDropEvent = function (layoutInfo, options) {\r\n      var collection = $(),\r\n          $editor = layoutInfo.editor(),\r\n          $dropzone = layoutInfo.dropzone(),\r\n          $dropzoneMessage = $dropzone.find('.note-dropzone-message');\r\n\r\n      // show dropzone on dragenter when dragging a object to document\r\n      // -but only if the editor is visible, i.e. has a positive width and height\r\n      $document.on('dragenter', function (e) {\r\n        var isCodeview = handler.invoke('codeview.isActivated', layoutInfo);\r\n        var hasEditorSize = $editor.width() > 0 && $editor.height() > 0;\r\n        if (!isCodeview && !collection.length && hasEditorSize) {\r\n          $editor.addClass('dragover');\r\n          $dropzone.width($editor.width());\r\n          $dropzone.height($editor.height());\r\n          $dropzoneMessage.text(options.langInfo.image.dragImageHere);\r\n        }\r\n        collection = collection.add(e.target);\r\n      }).on('dragleave', function (e) {\r\n        collection = collection.not(e.target);\r\n        if (!collection.length) {\r\n          $editor.removeClass('dragover');\r\n        }\r\n      }).on('drop', function () {\r\n        collection = $();\r\n        $editor.removeClass('dragover');\r\n      });\r\n\r\n      // change dropzone's message on hover.\r\n      $dropzone.on('dragenter', function () {\r\n        $dropzone.addClass('hover');\r\n        $dropzoneMessage.text(options.langInfo.image.dropImage);\r\n      }).on('dragleave', function () {\r\n        $dropzone.removeClass('hover');\r\n        $dropzoneMessage.text(options.langInfo.image.dragImageHere);\r\n      });\r\n\r\n      // attach dropImage\r\n      $dropzone.on('drop', function (event) {\r\n\r\n        var dataTransfer = event.originalEvent.dataTransfer;\r\n        var layoutInfo = dom.makeLayoutInfo(event.currentTarget || event.target);\r\n\r\n        if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\r\n          event.preventDefault();\r\n          layoutInfo.editable().focus();\r\n          handler.insertImages(layoutInfo, dataTransfer.files);\r\n        } else {\r\n          var insertNodefunc = function () {\r\n            layoutInfo.holder().summernote('insertNode', this);\r\n          };\r\n\r\n          for (var i = 0, len = dataTransfer.types.length; i < len; i++) {\r\n            var type = dataTransfer.types[i];\r\n            var content = dataTransfer.getData(type);\r\n\r\n            if (type.toLowerCase().indexOf('text') > -1) {\r\n              layoutInfo.holder().summernote('pasteHTML', content);\r\n            } else {\r\n              $(content).each(insertNodefunc);\r\n            }\r\n          }\r\n        }\r\n      }).on('dragover', false); // prevent default dragover event\r\n    };\r\n  };\r\n\r\n  var Clipboard = function (handler) {\r\n    var $paste;\r\n\r\n    this.attach = function (layoutInfo) {\r\n      // [workaround] getting image from clipboard\r\n      //  - IE11 and Firefox: CTRL+v hook\r\n      //  - Webkit: event.clipboardData\r\n      if ((agent.isMSIE && agent.browserVersion > 10) || agent.isFF) {\r\n        $paste = $('<div />').attr('contenteditable', true).css({\r\n          position : 'absolute',\r\n          left : -100000,\r\n          opacity : 0\r\n        });\r\n\r\n        layoutInfo.editable().on('keydown', function (e) {\r\n          if (e.ctrlKey && e.keyCode === key.code.V) {\r\n            handler.invoke('saveRange', layoutInfo.editable());\r\n            $paste.focus();\r\n\r\n            setTimeout(function () {\r\n              pasteByHook(layoutInfo);\r\n            }, 0);\r\n          }\r\n        });\r\n\r\n        layoutInfo.editable().before($paste);\r\n      } else {\r\n        layoutInfo.editable().on('paste', pasteByEvent);\r\n      }\r\n    };\r\n\r\n    var pasteByHook = function (layoutInfo) {\r\n      var $editable = layoutInfo.editable();\r\n      var node = $paste[0].firstChild;\r\n\r\n      if (dom.isImg(node)) {\r\n        var dataURI = node.src;\r\n        var decodedData = atob(dataURI.split(',')[1]);\r\n        var array = new Uint8Array(decodedData.length);\r\n        for (var i = 0; i < decodedData.length; i++) {\r\n          array[i] = decodedData.charCodeAt(i);\r\n        }\r\n\r\n        var blob = new Blob([array], { type : 'image/png' });\r\n        blob.name = 'clipboard.png';\r\n\r\n        handler.invoke('restoreRange', $editable);\r\n        handler.invoke('focus', $editable);\r\n        handler.insertImages(layoutInfo, [blob]);\r\n      } else {\r\n        var pasteContent = $('<div />').html($paste.html()).html();\r\n        handler.invoke('restoreRange', $editable);\r\n        handler.invoke('focus', $editable);\r\n\r\n        if (pasteContent) {\r\n          handler.invoke('pasteHTML', $editable, pasteContent);\r\n        }\r\n      }\r\n\r\n      $paste.empty();\r\n    };\r\n\r\n    /**\r\n     * paste by clipboard event\r\n     *\r\n     * @param {Event} event\r\n     */\r\n    var pasteByEvent = function (event) {\r\n      var clipboardData = event.originalEvent.clipboardData;\r\n      var layoutInfo = dom.makeLayoutInfo(event.currentTarget || event.target);\r\n      var $editable = layoutInfo.editable();\r\n\r\n      if (clipboardData && clipboardData.items && clipboardData.items.length) {\r\n        var item = list.head(clipboardData.items);\r\n        if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {\r\n          handler.insertImages(layoutInfo, [item.getAsFile()]);\r\n        }\r\n        handler.invoke('editor.afterCommand', $editable);\r\n      }\r\n    };\r\n  };\r\n\r\n  var LinkDialog = function (handler) {\r\n\r\n    /**\r\n     * toggle button status\r\n     *\r\n     * @private\r\n     * @param {jQuery} $btn\r\n     * @param {Boolean} isEnable\r\n     */\r\n    var toggleBtn = function ($btn, isEnable) {\r\n      $btn.toggleClass('disabled', !isEnable);\r\n      $btn.attr('disabled', !isEnable);\r\n    };\r\n\r\n    /**\r\n     * bind enter key\r\n     *\r\n     * @private\r\n     * @param {jQuery} $input\r\n     * @param {jQuery} $btn\r\n     */\r\n    var bindEnterKey = function ($input, $btn) {\r\n      $input.on('keypress', function (event) {\r\n        if (event.keyCode === key.code.ENTER) {\r\n          $btn.trigger('click');\r\n        }\r\n      });\r\n    };\r\n\r\n    /**\r\n     * Show link dialog and set event handlers on dialog controls.\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {jQuery} $dialog\r\n     * @param {Object} linkInfo\r\n     * @return {Promise}\r\n     */\r\n    this.showLinkDialog = function ($editable, $dialog, linkInfo) {\r\n      return $.Deferred(function (deferred) {\r\n        var $linkDialog = $dialog.find('.note-link-dialog');\r\n\r\n        var $linkText = $linkDialog.find('.note-link-text'),\r\n        $linkUrl = $linkDialog.find('.note-link-url'),\r\n        $linkBtn = $linkDialog.find('.note-link-btn'),\r\n        $openInNewWindow = $linkDialog.find('input[type=checkbox]');\r\n\r\n        $linkDialog.one('shown.bs.modal', function () {\r\n          $linkText.val(linkInfo.text);\r\n\r\n          $linkText.on('input', function () {\r\n            toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\r\n            // if linktext was modified by keyup,\r\n            // stop cloning text from linkUrl\r\n            linkInfo.text = $linkText.val();\r\n          });\r\n\r\n          // if no url was given, copy text to url\r\n          if (!linkInfo.url) {\r\n            linkInfo.url = linkInfo.text || 'http://';\r\n            toggleBtn($linkBtn, linkInfo.text);\r\n          }\r\n\r\n          $linkUrl.on('input', function () {\r\n            toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\r\n            // display same link on `Text to display` input\r\n            // when create a new link\r\n            if (!linkInfo.text) {\r\n              $linkText.val($linkUrl.val());\r\n            }\r\n          }).val(linkInfo.url).trigger('focus').trigger('select');\r\n\r\n          bindEnterKey($linkUrl, $linkBtn);\r\n          bindEnterKey($linkText, $linkBtn);\r\n\r\n          $openInNewWindow.prop('checked', linkInfo.isNewWindow);\r\n\r\n          $linkBtn.one('click', function (event) {\r\n            event.preventDefault();\r\n\r\n            deferred.resolve({\r\n              range: linkInfo.range,\r\n              url: $linkUrl.val(),\r\n              text: $linkText.val(),\r\n              isNewWindow: $openInNewWindow.is(':checked')\r\n            });\r\n            $linkDialog.modal('hide');\r\n          });\r\n        }).one('hidden.bs.modal', function () {\r\n          // detach events\r\n          $linkText.off('input keypress');\r\n          $linkUrl.off('input keypress');\r\n          $linkBtn.off('click');\r\n\r\n          if (deferred.state() === 'pending') {\r\n            deferred.reject();\r\n          }\r\n        }).modal('show');\r\n      }).promise();\r\n    };\r\n\r\n    /**\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.show = function (layoutInfo) {\r\n      var $editor = layoutInfo.editor(),\r\n          $dialog = layoutInfo.dialog(),\r\n          $editable = layoutInfo.editable(),\r\n          $popover = layoutInfo.popover(),\r\n          linkInfo = handler.invoke('editor.getLinkInfo', $editable);\r\n\r\n      var options = $editor.data('options');\r\n\r\n      handler.invoke('editor.saveRange', $editable);\r\n      this.showLinkDialog($editable, $dialog, linkInfo).then(function (linkInfo) {\r\n        handler.invoke('editor.restoreRange', $editable);\r\n        handler.invoke('editor.createLink', $editable, linkInfo, options);\r\n        // hide popover after creating link\r\n        handler.invoke('popover.hide', $popover);\r\n      }).fail(function () {\r\n        handler.invoke('editor.restoreRange', $editable);\r\n      });\r\n    };\r\n  };\r\n\r\n  var ImageDialog = function (handler) {\r\n    /**\r\n     * toggle button status\r\n     *\r\n     * @private\r\n     * @param {jQuery} $btn\r\n     * @param {Boolean} isEnable\r\n     */\r\n    var toggleBtn = function ($btn, isEnable) {\r\n      $btn.toggleClass('disabled', !isEnable);\r\n      $btn.attr('disabled', !isEnable);\r\n    };\r\n\r\n    /**\r\n     * bind enter key\r\n     *\r\n     * @private\r\n     * @param {jQuery} $input\r\n     * @param {jQuery} $btn\r\n     */\r\n    var bindEnterKey = function ($input, $btn) {\r\n      $input.on('keypress', function (event) {\r\n        if (event.keyCode === key.code.ENTER) {\r\n          $btn.trigger('click');\r\n        }\r\n      });\r\n    };\r\n\r\n    this.show = function (layoutInfo) {\r\n      var $dialog = layoutInfo.dialog(),\r\n          $editable = layoutInfo.editable();\r\n\r\n      handler.invoke('editor.saveRange', $editable);\r\n      this.showImageDialog($editable, $dialog).then(function (data) {\r\n        handler.invoke('editor.restoreRange', $editable);\r\n\r\n        if (typeof data === 'string') {\r\n          // image url\r\n          handler.invoke('editor.insertImage', $editable, data);\r\n        } else {\r\n          // array of files\r\n          handler.insertImages(layoutInfo, data);\r\n        }\r\n      }).fail(function () {\r\n        handler.invoke('editor.restoreRange', $editable);\r\n      });\r\n    };\r\n\r\n    /**\r\n     * show image dialog\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {jQuery} $dialog\r\n     * @return {Promise}\r\n     */\r\n    this.showImageDialog = function ($editable, $dialog) {\r\n      return $.Deferred(function (deferred) {\r\n        var $imageDialog = $dialog.find('.note-image-dialog');\r\n\r\n        var $imageInput = $dialog.find('.note-image-input'),\r\n            $imageUrl = $dialog.find('.note-image-url'),\r\n            $imageBtn = $dialog.find('.note-image-btn');\r\n\r\n        $imageDialog.one('shown.bs.modal', function () {\r\n          // Cloning imageInput to clear element.\r\n          $imageInput.replaceWith($imageInput.clone()\r\n            .on('change', function () {\r\n              deferred.resolve(this.files || this.value);\r\n              $imageDialog.modal('hide');\r\n            })\r\n            .val('')\r\n          );\r\n\r\n          $imageBtn.click(function (event) {\r\n            event.preventDefault();\r\n\r\n            deferred.resolve($imageUrl.val());\r\n            $imageDialog.modal('hide');\r\n          });\r\n\r\n          $imageUrl.on('keyup paste', function (event) {\r\n            var url;\r\n            \r\n            if (event.type === 'paste') {\r\n              url = event.originalEvent.clipboardData.getData('text');\r\n            } else {\r\n              url = $imageUrl.val();\r\n            }\r\n            \r\n            toggleBtn($imageBtn, url);\r\n          }).val('').trigger('focus');\r\n          bindEnterKey($imageUrl, $imageBtn);\r\n        }).one('hidden.bs.modal', function () {\r\n          $imageInput.off('change');\r\n          $imageUrl.off('keyup paste keypress');\r\n          $imageBtn.off('click');\r\n\r\n          if (deferred.state() === 'pending') {\r\n            deferred.reject();\r\n          }\r\n        }).modal('show');\r\n      });\r\n    };\r\n  };\r\n\r\n  var HelpDialog = function (handler) {\r\n    /**\r\n     * show help dialog\r\n     *\r\n     * @param {jQuery} $editable\r\n     * @param {jQuery} $dialog\r\n     * @return {Promise}\r\n     */\r\n    this.showHelpDialog = function ($editable, $dialog) {\r\n      return $.Deferred(function (deferred) {\r\n        var $helpDialog = $dialog.find('.note-help-dialog');\r\n\r\n        $helpDialog.one('hidden.bs.modal', function () {\r\n          deferred.resolve();\r\n        }).modal('show');\r\n      }).promise();\r\n    };\r\n\r\n    /**\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.show = function (layoutInfo) {\r\n      var $dialog = layoutInfo.dialog(),\r\n          $editable = layoutInfo.editable();\r\n\r\n      handler.invoke('editor.saveRange', $editable, true);\r\n      this.showHelpDialog($editable, $dialog).then(function () {\r\n        handler.invoke('editor.restoreRange', $editable);\r\n      });\r\n    };\r\n  };\r\n\r\n\r\n  /**\r\n   * @class EventHandler\r\n   *\r\n   * EventHandler\r\n   *  - TODO: new instance per a editor\r\n   */\r\n  var EventHandler = function () {\r\n    var self = this;\r\n\r\n    /**\r\n     * Modules\r\n     */\r\n    var modules = this.modules = {\r\n      editor: new Editor(this),\r\n      toolbar: new Toolbar(this),\r\n      statusbar: new Statusbar(this),\r\n      popover: new Popover(this),\r\n      handle: new Handle(this),\r\n      fullscreen: new Fullscreen(this),\r\n      codeview: new Codeview(this),\r\n      dragAndDrop: new DragAndDrop(this),\r\n      clipboard: new Clipboard(this),\r\n      linkDialog: new LinkDialog(this),\r\n      imageDialog: new ImageDialog(this),\r\n      helpDialog: new HelpDialog(this)\r\n    };\r\n\r\n    /**\r\n     * invoke module's method\r\n     *\r\n     * @param {String} moduleAndMethod - ex) 'editor.redo'\r\n     * @param {...*} arguments - arguments of method\r\n     * @return {*}\r\n     */\r\n    this.invoke = function () {\r\n      var moduleAndMethod = list.head(list.from(arguments));\r\n      var args = list.tail(list.from(arguments));\r\n\r\n      var splits = moduleAndMethod.split('.');\r\n      var hasSeparator = splits.length > 1;\r\n      var moduleName = hasSeparator && list.head(splits);\r\n      var methodName = hasSeparator ? list.last(splits) : list.head(splits);\r\n\r\n      var module = this.getModule(moduleName);\r\n      var method = module[methodName];\r\n\r\n      return method && method.apply(module, args);\r\n    };\r\n\r\n    /**\r\n     * returns module\r\n     *\r\n     * @param {String} moduleName - name of module\r\n     * @return {Module} - defaults is editor\r\n     */\r\n    this.getModule = function (moduleName) {\r\n      return this.modules[moduleName] || this.modules.editor;\r\n    };\r\n\r\n    /**\r\n     * @param {jQuery} $holder\r\n     * @param {Object} callbacks\r\n     * @param {String} eventNamespace\r\n     * @returns {Function}\r\n     */\r\n    var bindCustomEvent = this.bindCustomEvent = function ($holder, callbacks, eventNamespace) {\r\n      return function () {\r\n        var callback = callbacks[func.namespaceToCamel(eventNamespace, 'on')];\r\n        if (callback) {\r\n          callback.apply($holder[0], arguments);\r\n        }\r\n        return $holder.trigger('summernote.' + eventNamespace, arguments);\r\n      };\r\n    };\r\n\r\n    /**\r\n     * insert Images from file array.\r\n     *\r\n     * @private\r\n     * @param {Object} layoutInfo\r\n     * @param {File[]} files\r\n     */\r\n    this.insertImages = function (layoutInfo, files) {\r\n      var $editor = layoutInfo.editor(),\r\n          $editable = layoutInfo.editable(),\r\n          $holder = layoutInfo.holder();\r\n\r\n      var callbacks = $editable.data('callbacks');\r\n      var options = $editor.data('options');\r\n\r\n      // If onImageUpload options setted\r\n      if (callbacks.onImageUpload) {\r\n        bindCustomEvent($holder, callbacks, 'image.upload')(files);\r\n      // else insert Image as dataURL\r\n      } else {\r\n        $.each(files, function (idx, file) {\r\n          var filename = file.name;\r\n          if (options.maximumImageFileSize && options.maximumImageFileSize < file.size) {\r\n            bindCustomEvent($holder, callbacks, 'image.upload.error')(options.langInfo.image.maximumFileSizeError);\r\n          } else {\r\n            async.readFileAsDataURL(file).then(function (sDataURL) {\r\n              modules.editor.insertImage($editable, sDataURL, filename);\r\n            }).fail(function () {\r\n              bindCustomEvent($holder, callbacks, 'image.upload.error')(options.langInfo.image.maximumFileSizeError);\r\n            });\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    var commands = {\r\n      /**\r\n       * @param {Object} layoutInfo\r\n       */\r\n      showLinkDialog: function (layoutInfo) {\r\n        modules.linkDialog.show(layoutInfo);\r\n      },\r\n\r\n      /**\r\n       * @param {Object} layoutInfo\r\n       */\r\n      showImageDialog: function (layoutInfo) {\r\n        modules.imageDialog.show(layoutInfo);\r\n      },\r\n\r\n      /**\r\n       * @param {Object} layoutInfo\r\n       */\r\n      showHelpDialog: function (layoutInfo) {\r\n        modules.helpDialog.show(layoutInfo);\r\n      },\r\n\r\n      /**\r\n       * @param {Object} layoutInfo\r\n       */\r\n      fullscreen: function (layoutInfo) {\r\n        modules.fullscreen.toggle(layoutInfo);\r\n      },\r\n\r\n      /**\r\n       * @param {Object} layoutInfo\r\n       */\r\n      codeview: function (layoutInfo) {\r\n        modules.codeview.toggle(layoutInfo);\r\n      }\r\n    };\r\n\r\n    var hMousedown = function (event) {\r\n      //preventDefault Selection for FF, IE8+\r\n      if (dom.isImg(event.target)) {\r\n        event.preventDefault();\r\n      }\r\n    };\r\n\r\n    var hKeyupAndMouseup = function (event) {\r\n      var layoutInfo = dom.makeLayoutInfo(event.currentTarget || event.target);\r\n      modules.editor.removeBogus(layoutInfo.editable());\r\n      hToolbarAndPopoverUpdate(event);\r\n    };\r\n\r\n    /**\r\n     * update sytle info\r\n     * @param {Object} styleInfo\r\n     * @param {Object} layoutInfo\r\n     */\r\n    this.updateStyleInfo = function (styleInfo, layoutInfo) {\r\n      if (!styleInfo) {\r\n        return;\r\n      }\r\n      var isAirMode = layoutInfo.editor().data('options').airMode;\r\n      if (!isAirMode) {\r\n        modules.toolbar.update(layoutInfo.toolbar(), styleInfo);\r\n      }\r\n\r\n      modules.popover.update(layoutInfo.popover(), styleInfo, isAirMode);\r\n      modules.handle.update(layoutInfo.handle(), styleInfo, isAirMode);\r\n    };\r\n\r\n    var hToolbarAndPopoverUpdate = function (event) {\r\n      var target = event.target;\r\n      // delay for range after mouseup\r\n      setTimeout(function () {\r\n        var layoutInfo = dom.makeLayoutInfo(target);\r\n        var styleInfo = modules.editor.currentStyle(target);\r\n        self.updateStyleInfo(styleInfo, layoutInfo);\r\n      }, 0);\r\n    };\r\n\r\n    var hScroll = function (event) {\r\n      var layoutInfo = dom.makeLayoutInfo(event.currentTarget || event.target);\r\n      //hide popover and handle when scrolled\r\n      modules.popover.hide(layoutInfo.popover());\r\n      modules.handle.hide(layoutInfo.handle());\r\n    };\r\n\r\n    var hToolbarAndPopoverMousedown = function (event) {\r\n      // prevent default event when insertTable (FF, Webkit)\r\n      var $btn = $(event.target).closest('[data-event]');\r\n      if ($btn.length) {\r\n        event.preventDefault();\r\n      }\r\n    };\r\n\r\n    var hToolbarAndPopoverClick = function (event) {\r\n      var $btn = $(event.target).closest('[data-event]');\r\n\r\n      if (!$btn.length) {\r\n        return;\r\n      }\r\n\r\n      var eventName = $btn.attr('data-event'),\r\n          value = $btn.attr('data-value'),\r\n          hide = $btn.attr('data-hide');\r\n\r\n      var layoutInfo = dom.makeLayoutInfo(event.target);\r\n\r\n      // before command: detect control selection element($target)\r\n      var $target;\r\n      if ($.inArray(eventName, ['resize', 'floatMe', 'removeMedia', 'imageShape']) !== -1) {\r\n        var $selection = layoutInfo.handle().find('.note-control-selection');\r\n        $target = $($selection.data('target'));\r\n      }\r\n\r\n      // If requested, hide the popover when the button is clicked.\r\n      // Useful for things like showHelpDialog.\r\n      if (hide) {\r\n        $btn.parents('.popover').hide();\r\n      }\r\n\r\n      if ($.isFunction($.summernote.pluginEvents[eventName])) {\r\n        $.summernote.pluginEvents[eventName](event, modules.editor, layoutInfo, value);\r\n      } else if (modules.editor[eventName]) { // on command\r\n        var $editable = layoutInfo.editable();\r\n        $editable.focus();\r\n        modules.editor[eventName]($editable, value, $target);\r\n        event.preventDefault();\r\n      } else if (commands[eventName]) {\r\n        commands[eventName].call(this, layoutInfo);\r\n        event.preventDefault();\r\n      }\r\n\r\n      // after command\r\n      if ($.inArray(eventName, ['backColor', 'foreColor']) !== -1) {\r\n        var options = layoutInfo.editor().data('options', options);\r\n        var module = options.airMode ? modules.popover : modules.toolbar;\r\n        module.updateRecentColor(list.head($btn), eventName, value);\r\n      }\r\n\r\n      hToolbarAndPopoverUpdate(event);\r\n    };\r\n\r\n    var PX_PER_EM = 18;\r\n    var hDimensionPickerMove = function (event, options) {\r\n      var $picker = $(event.target.parentNode); // target is mousecatcher\r\n      var $dimensionDisplay = $picker.next();\r\n      var $catcher = $picker.find('.note-dimension-picker-mousecatcher');\r\n      var $highlighted = $picker.find('.note-dimension-picker-highlighted');\r\n      var $unhighlighted = $picker.find('.note-dimension-picker-unhighlighted');\r\n\r\n      var posOffset;\r\n      // HTML5 with jQuery - e.offsetX is undefined in Firefox\r\n      if (event.offsetX === undefined) {\r\n        var posCatcher = $(event.target).offset();\r\n        posOffset = {\r\n          x: event.pageX - posCatcher.left,\r\n          y: event.pageY - posCatcher.top\r\n        };\r\n      } else {\r\n        posOffset = {\r\n          x: event.offsetX,\r\n          y: event.offsetY\r\n        };\r\n      }\r\n\r\n      var dim = {\r\n        c: Math.ceil(posOffset.x / PX_PER_EM) || 1,\r\n        r: Math.ceil(posOffset.y / PX_PER_EM) || 1\r\n      };\r\n\r\n      $highlighted.css({ width: dim.c + 'em', height: dim.r + 'em' });\r\n      $catcher.attr('data-value', dim.c + 'x' + dim.r);\r\n\r\n      if (3 < dim.c && dim.c < options.insertTableMaxSize.col) {\r\n        $unhighlighted.css({ width: dim.c + 1 + 'em'});\r\n      }\r\n\r\n      if (3 < dim.r && dim.r < options.insertTableMaxSize.row) {\r\n        $unhighlighted.css({ height: dim.r + 1 + 'em'});\r\n      }\r\n\r\n      $dimensionDisplay.html(dim.c + ' x ' + dim.r);\r\n    };\r\n    \r\n    /**\r\n     * bind KeyMap on keydown\r\n     *\r\n     * @param {Object} layoutInfo\r\n     * @param {Object} keyMap\r\n     */\r\n    this.bindKeyMap = function (layoutInfo, keyMap) {\r\n      var $editor = layoutInfo.editor();\r\n      var $editable = layoutInfo.editable();\r\n\r\n      $editable.on('keydown', function (event) {\r\n        var keys = [];\r\n\r\n        // modifier\r\n        if (event.metaKey) { keys.push('CMD'); }\r\n        if (event.ctrlKey && !event.altKey) { keys.push('CTRL'); }\r\n        if (event.shiftKey) { keys.push('SHIFT'); }\r\n\r\n        // keycode\r\n        var keyName = key.nameFromCode[event.keyCode];\r\n        if (keyName) {\r\n          keys.push(keyName);\r\n        }\r\n\r\n        var pluginEvent;\r\n        var keyString = keys.join('+');\r\n        var eventName = keyMap[keyString];\r\n        if (eventName) {\r\n          // FIXME Summernote doesn't support event pipeline yet.\r\n          //  - Plugin -> Base Code\r\n          pluginEvent = $.summernote.pluginEvents[keyString];\r\n          if ($.isFunction(pluginEvent)) {\r\n            if (pluginEvent(event, modules.editor, layoutInfo)) {\r\n              return false;\r\n            }\r\n          }\r\n\r\n          pluginEvent = $.summernote.pluginEvents[eventName];\r\n\r\n          if ($.isFunction(pluginEvent)) {\r\n            pluginEvent(event, modules.editor, layoutInfo);\r\n          } else if (modules.editor[eventName]) {\r\n            modules.editor[eventName]($editable, $editor.data('options'));\r\n            event.preventDefault();\r\n          } else if (commands[eventName]) {\r\n            commands[eventName].call(this, layoutInfo);\r\n            event.preventDefault();\r\n          }\r\n        } else if (key.isEdit(event.keyCode)) {\r\n          modules.editor.afterCommand($editable);\r\n        }\r\n      });\r\n    };\r\n\r\n    /**\r\n     * attach eventhandler\r\n     *\r\n     * @param {Object} layoutInfo - layout Informations\r\n     * @param {Object} options - user options include custom event handlers\r\n     */\r\n    this.attach = function (layoutInfo, options) {\r\n      // handlers for editable\r\n      if (options.shortcuts) {\r\n        this.bindKeyMap(layoutInfo, options.keyMap[agent.isMac ? 'mac' : 'pc']);\r\n      }\r\n      layoutInfo.editable().on('mousedown', hMousedown);\r\n      layoutInfo.editable().on('keyup mouseup', hKeyupAndMouseup);\r\n      layoutInfo.editable().on('scroll', hScroll);\r\n\r\n      // handler for clipboard\r\n      modules.clipboard.attach(layoutInfo, options);\r\n\r\n      // handler for handle and popover\r\n      modules.handle.attach(layoutInfo, options);\r\n      layoutInfo.popover().on('click', hToolbarAndPopoverClick);\r\n      layoutInfo.popover().on('mousedown', hToolbarAndPopoverMousedown);\r\n\r\n      // handler for drag and drop\r\n      modules.dragAndDrop.attach(layoutInfo, options);\r\n\r\n      // handlers for frame mode (toolbar, statusbar)\r\n      if (!options.airMode) {\r\n        // handler for toolbar\r\n        layoutInfo.toolbar().on('click', hToolbarAndPopoverClick);\r\n        layoutInfo.toolbar().on('mousedown', hToolbarAndPopoverMousedown);\r\n\r\n        // handler for statusbar\r\n        modules.statusbar.attach(layoutInfo, options);\r\n      }\r\n\r\n      // handler for table dimension\r\n      var $catcherContainer = options.airMode ? layoutInfo.popover() :\r\n                                                layoutInfo.toolbar();\r\n      var $catcher = $catcherContainer.find('.note-dimension-picker-mousecatcher');\r\n      $catcher.css({\r\n        width: options.insertTableMaxSize.col + 'em',\r\n        height: options.insertTableMaxSize.row + 'em'\r\n      }).on('mousemove', function (event) {\r\n        hDimensionPickerMove(event, options);\r\n      });\r\n\r\n      // save options on editor\r\n      layoutInfo.editor().data('options', options);\r\n\r\n      // ret styleWithCSS for backColor / foreColor clearing with 'inherit'.\r\n      if (!agent.isMSIE) {\r\n        // [workaround] for Firefox\r\n        //  - protect FF Error: NS_ERROR_FAILURE: Failure\r\n        setTimeout(function () {\r\n          document.execCommand('styleWithCSS', 0, options.styleWithSpan);\r\n        }, 0);\r\n      }\r\n\r\n      // History\r\n      var history = new History(layoutInfo.editable());\r\n      layoutInfo.editable().data('NoteHistory', history);\r\n\r\n      // All editor status will be saved on editable with jquery's data\r\n      // for support multiple editor with singleton object.\r\n      layoutInfo.editable().data('callbacks', {\r\n        onInit: options.onInit,\r\n        onFocus: options.onFocus,\r\n        onBlur: options.onBlur,\r\n        onKeydown: options.onKeydown,\r\n        onKeyup: options.onKeyup,\r\n        onMousedown: options.onMousedown,\r\n        onEnter: options.onEnter,\r\n        onPaste: options.onPaste,\r\n        onBeforeCommand: options.onBeforeCommand,\r\n        onChange: options.onChange,\r\n        onImageUpload: options.onImageUpload,\r\n        onImageUploadError: options.onImageUploadError,\r\n        onMediaDelete: options.onMediaDelete,\r\n        onToolbarClick: options.onToolbarClick\r\n      });\r\n\r\n      var styleInfo = modules.editor.styleFromNode(layoutInfo.editable());\r\n      this.updateStyleInfo(styleInfo, layoutInfo);\r\n    };\r\n\r\n    /**\r\n     * attach jquery custom event\r\n     *\r\n     * @param {Object} layoutInfo - layout Informations\r\n     */\r\n    this.attachCustomEvent = function (layoutInfo, options) {\r\n      var $holder = layoutInfo.holder();\r\n      var $editable = layoutInfo.editable();\r\n      var callbacks = $editable.data('callbacks');\r\n\r\n      $editable.focus(bindCustomEvent($holder, callbacks, 'focus'));\r\n      $editable.blur(bindCustomEvent($holder, callbacks, 'blur'));\r\n\r\n      $editable.keydown(function (event) {\r\n        if (event.keyCode === key.code.ENTER) {\r\n          bindCustomEvent($holder, callbacks, 'enter').call(this, event);\r\n        }\r\n        bindCustomEvent($holder, callbacks, 'keydown').call(this, event);\r\n      });\r\n      $editable.keyup(bindCustomEvent($holder, callbacks, 'keyup'));\r\n\r\n      $editable.on('mousedown', bindCustomEvent($holder, callbacks, 'mousedown'));\r\n      $editable.on('mouseup', bindCustomEvent($holder, callbacks, 'mouseup'));\r\n      $editable.on('scroll', bindCustomEvent($holder, callbacks, 'scroll'));\r\n\r\n      $editable.on('paste', bindCustomEvent($holder, callbacks, 'paste'));\r\n      \r\n      // [workaround] IE doesn't have input events for contentEditable\r\n      //  - see: https://goo.gl/4bfIvA\r\n      var changeEventName = agent.isMSIE ? 'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted' : 'input';\r\n      $editable.on(changeEventName, function () {\r\n        bindCustomEvent($holder, callbacks, 'change')($editable.html(), $editable);\r\n      });\r\n\r\n      if (!options.airMode) {\r\n        layoutInfo.toolbar().click(bindCustomEvent($holder, callbacks, 'toolbar.click'));\r\n        layoutInfo.popover().click(bindCustomEvent($holder, callbacks, 'popover.click'));\r\n      }\r\n\r\n      // Textarea: auto filling the code before form submit.\r\n      if (dom.isTextarea(list.head($holder))) {\r\n        $holder.closest('form').submit(function (e) {\r\n          layoutInfo.holder().val(layoutInfo.holder().code());\r\n          bindCustomEvent($holder, callbacks, 'submit').call(this, e, $holder.code());\r\n        });\r\n      }\r\n\r\n      // textarea auto sync\r\n      if (dom.isTextarea(list.head($holder)) && options.textareaAutoSync) {\r\n        $holder.on('summernote.change', function () {\r\n          layoutInfo.holder().val(layoutInfo.holder().code());\r\n        });\r\n      }\r\n\r\n      // fire init event\r\n      bindCustomEvent($holder, callbacks, 'init')(layoutInfo);\r\n\r\n      // fire plugin init event\r\n      for (var i = 0, len = $.summernote.plugins.length; i < len; i++) {\r\n        if ($.isFunction($.summernote.plugins[i].init)) {\r\n          $.summernote.plugins[i].init(layoutInfo);\r\n        }\r\n      }\r\n    };\r\n      \r\n    this.detach = function (layoutInfo, options) {\r\n      layoutInfo.holder().off();\r\n      layoutInfo.editable().off();\r\n\r\n      layoutInfo.popover().off();\r\n      layoutInfo.handle().off();\r\n      layoutInfo.dialog().off();\r\n\r\n      if (!options.airMode) {\r\n        layoutInfo.dropzone().off();\r\n        layoutInfo.toolbar().off();\r\n        layoutInfo.statusbar().off();\r\n      }\r\n    };\r\n  };\r\n\r\n  /**\r\n   * @class Renderer\r\n   *\r\n   * renderer\r\n   *\r\n   * rendering toolbar and editable\r\n   */\r\n  var Renderer = function () {\r\n\r\n    /**\r\n     * bootstrap button template\r\n     * @private\r\n     * @param {String} label button name\r\n     * @param {Object} [options] button options\r\n     * @param {String} [options.event] data-event\r\n     * @param {String} [options.className] button's class name\r\n     * @param {String} [options.value] data-value\r\n     * @param {String} [options.title] button's title for popup\r\n     * @param {String} [options.dropdown] dropdown html\r\n     * @param {String} [options.hide] data-hide\r\n     */\r\n    var tplButton = function (label, options) {\r\n      var event = options.event;\r\n      var value = options.value;\r\n      var title = options.title;\r\n      var className = options.className;\r\n      var dropdown = options.dropdown;\r\n      var hide = options.hide;\r\n\r\n      return (dropdown ? '<div class=\"btn-group' +\r\n               (className ? ' ' + className : '') + '\">' : '') +\r\n               '<button type=\"button\"' +\r\n                 ' class=\"btn btn-default btn-sm' +\r\n                   ((!dropdown && className) ? ' ' + className : '') +\r\n                   (dropdown ? ' dropdown-toggle' : '') +\r\n                 '\"' +\r\n                 (dropdown ? ' data-toggle=\"dropdown\"' : '') +\r\n                 (title ? ' title=\"' + title + '\"' : '') +\r\n                 (event ? ' data-event=\"' + event + '\"' : '') +\r\n                 (value ? ' data-value=\\'' + value + '\\'' : '') +\r\n                 (hide ? ' data-hide=\\'' + hide + '\\'' : '') +\r\n                 ' tabindex=\"-1\">' +\r\n                 label +\r\n                 (dropdown ? ' <span class=\"caret\"></span>' : '') +\r\n               '</button>' +\r\n               (dropdown || '') +\r\n             (dropdown ? '</div>' : '');\r\n    };\r\n\r\n    /**\r\n     * bootstrap icon button template\r\n     * @private\r\n     * @param {String} iconClassName\r\n     * @param {Object} [options]\r\n     * @param {String} [options.event]\r\n     * @param {String} [options.value]\r\n     * @param {String} [options.title]\r\n     * @param {String} [options.dropdown]\r\n     */\r\n    var tplIconButton = function (iconClassName, options) {\r\n      var label = '<i class=\"' + iconClassName + '\"></i>';\r\n      return tplButton(label, options);\r\n    };\r\n\r\n    /**\r\n     * bootstrap popover template\r\n     * @private\r\n     * @param {String} className\r\n     * @param {String} content\r\n     */\r\n    var tplPopover = function (className, content) {\r\n      var $popover = $('<div class=\"' + className + ' popover bottom in\" style=\"display: none;\">' +\r\n               '<div class=\"arrow\"></div>' +\r\n               '<div class=\"popover-content\">' +\r\n               '</div>' +\r\n             '</div>');\r\n\r\n      $popover.find('.popover-content').append(content);\r\n      return $popover;\r\n    };\r\n\r\n    /**\r\n     * bootstrap dialog template\r\n     *\r\n     * @param {String} className\r\n     * @param {String} [title='']\r\n     * @param {String} body\r\n     * @param {String} [footer='']\r\n     */\r\n    var tplDialog = function (className, title, body, footer) {\r\n      return '<div class=\"' + className + ' modal\" aria-hidden=\"false\">' +\r\n               '<div class=\"modal-dialog\">' +\r\n                 '<div class=\"modal-content\">' +\r\n                   (title ?\r\n                   '<div class=\"modal-header\">' +\r\n                     '<button type=\"button\" class=\"close\" aria-hidden=\"true\" tabindex=\"-1\">&times;</button>' +\r\n                     '<h4 class=\"modal-title\">' + title + '</h4>' +\r\n                   '</div>' : ''\r\n                   ) +\r\n                   '<div class=\"modal-body\">' + body + '</div>' +\r\n                   (footer ?\r\n                   '<div class=\"modal-footer\">' + footer + '</div>' : ''\r\n                   ) +\r\n                 '</div>' +\r\n               '</div>' +\r\n             '</div>';\r\n    };\r\n\r\n    /**\r\n     * bootstrap dropdown template\r\n     *\r\n     * @param {String|String[]} contents\r\n     * @param {String} [className='']\r\n     * @param {String} [nodeName='']\r\n     */\r\n    var tplDropdown = function (contents, className, nodeName) {\r\n      var classes = 'dropdown-menu' + (className ? ' ' + className : '');\r\n      nodeName = nodeName || 'ul';\r\n      if (contents instanceof Array) {\r\n        contents = contents.join('');\r\n      }\r\n\r\n      return '<' + nodeName + ' class=\"' + classes + '\">' + contents + '</' + nodeName + '>';\r\n    };\r\n\r\n    var tplButtonInfo = {\r\n      picture: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.image.image, {\r\n          event: 'showImageDialog',\r\n          title: lang.image.image,\r\n          hide: true\r\n        });\r\n      },\r\n      link: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.link.link, {\r\n          event: 'showLinkDialog',\r\n          title: lang.link.link,\r\n          hide: true\r\n        });\r\n      },\r\n      table: function (lang, options) {\r\n        var dropdown = [\r\n          '<div class=\"note-dimension-picker\">',\r\n          '<div class=\"note-dimension-picker-mousecatcher\" data-event=\"insertTable\" data-value=\"1x1\"></div>',\r\n          '<div class=\"note-dimension-picker-highlighted\"></div>',\r\n          '<div class=\"note-dimension-picker-unhighlighted\"></div>',\r\n          '</div>',\r\n          '<div class=\"note-dimension-display\"> 1 x 1 </div>'\r\n        ];\r\n\r\n        return tplIconButton(options.iconPrefix + options.icons.table.table, {\r\n          title: lang.table.table,\r\n          dropdown: tplDropdown(dropdown, 'note-table')\r\n        });\r\n      },\r\n      style: function (lang, options) {\r\n        var items = options.styleTags.reduce(function (memo, v) {\r\n          var label = lang.style[v === 'p' ? 'normal' : v];\r\n          return memo + '<li><a data-event=\"formatBlock\" href=\"#\" data-value=\"' + v + '\">' +\r\n                   (\r\n                     (v === 'p' || v === 'pre') ? label :\r\n                     '<' + v + '>' + label + '</' + v + '>'\r\n                   ) +\r\n                 '</a></li>';\r\n        }, '');\r\n\r\n        return tplIconButton(options.iconPrefix + options.icons.style.style, {\r\n          title: lang.style.style,\r\n          dropdown: tplDropdown(items)\r\n        });\r\n      },\r\n      fontname: function (lang, options) {\r\n        var realFontList = [];\r\n        var items = options.fontNames.reduce(function (memo, v) {\r\n          if (!agent.isFontInstalled(v) && !list.contains(options.fontNamesIgnoreCheck, v)) {\r\n            return memo;\r\n          }\r\n          realFontList.push(v);\r\n          return memo + '<li><a data-event=\"fontName\" href=\"#\" data-value=\"' + v + '\" style=\"font-family:\\'' + v + '\\'\">' +\r\n                          '<i class=\"' + options.iconPrefix + options.icons.misc.check + '\"></i> ' + v +\r\n                        '</a></li>';\r\n        }, '');\r\n\r\n        var hasDefaultFont = agent.isFontInstalled(options.defaultFontName);\r\n        var defaultFontName = (hasDefaultFont) ? options.defaultFontName : realFontList[0];\r\n\r\n        var label = '<span class=\"note-current-fontname\">' +\r\n                        defaultFontName +\r\n                     '</span>';\r\n        return tplButton(label, {\r\n          title: lang.font.name,\r\n          className: 'note-fontname',\r\n          dropdown: tplDropdown(items, 'note-check')\r\n        });\r\n      },\r\n      fontsize: function (lang, options) {\r\n        var items = options.fontSizes.reduce(function (memo, v) {\r\n          return memo + '<li><a data-event=\"fontSize\" href=\"#\" data-value=\"' + v + '\">' +\r\n                          '<i class=\"' + options.iconPrefix + options.icons.misc.check + '\"></i> ' + v +\r\n                        '</a></li>';\r\n        }, '');\r\n\r\n        var label = '<span class=\"note-current-fontsize\">11</span>';\r\n        return tplButton(label, {\r\n          title: lang.font.size,\r\n          className: 'note-fontsize',\r\n          dropdown: tplDropdown(items, 'note-check')\r\n        });\r\n      },\r\n      color: function (lang, options) {\r\n        var colorButtonLabel = '<i class=\"' +\r\n                                  options.iconPrefix + options.icons.color.recent +\r\n                                '\" style=\"color:black;background-color:yellow;\"></i>';\r\n\r\n        var colorButton = tplButton(colorButtonLabel, {\r\n          className: 'note-recent-color',\r\n          title: lang.color.recent,\r\n          event: 'color',\r\n          value: '{\"backColor\":\"yellow\"}'\r\n        });\r\n\r\n        var items = [\r\n          '<li><div class=\"btn-group\">',\r\n          '<div class=\"note-palette-title\">' + lang.color.background + '</div>',\r\n          '<div class=\"note-color-reset\" data-event=\"backColor\"',\r\n          ' data-value=\"inherit\" title=\"' + lang.color.transparent + '\">' + lang.color.setTransparent + '</div>',\r\n          '<div class=\"note-color-palette\" data-target-event=\"backColor\"></div>',\r\n          '</div><div class=\"btn-group\">',\r\n          '<div class=\"note-palette-title\">' + lang.color.foreground + '</div>',\r\n          '<div class=\"note-color-reset\" data-event=\"foreColor\" data-value=\"inherit\" title=\"' + lang.color.reset + '\">',\r\n          lang.color.resetToDefault,\r\n          '</div>',\r\n          '<div class=\"note-color-palette\" data-target-event=\"foreColor\"></div>',\r\n          '</div></li>'\r\n        ];\r\n\r\n        var moreButton = tplButton('', {\r\n          title: lang.color.more,\r\n          dropdown: tplDropdown(items)\r\n        });\r\n\r\n        return colorButton + moreButton;\r\n      },\r\n      bold: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.bold, {\r\n          event: 'bold',\r\n          title: lang.font.bold\r\n        });\r\n      },\r\n      italic: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.italic, {\r\n          event: 'italic',\r\n          title: lang.font.italic\r\n        });\r\n      },\r\n      underline: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.underline, {\r\n          event: 'underline',\r\n          title: lang.font.underline\r\n        });\r\n      },\r\n      strikethrough: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.strikethrough, {\r\n          event: 'strikethrough',\r\n          title: lang.font.strikethrough\r\n        });\r\n      },\r\n      superscript: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.superscript, {\r\n          event: 'superscript',\r\n          title: lang.font.superscript\r\n        });\r\n      },\r\n      subscript: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.subscript, {\r\n          event: 'subscript',\r\n          title: lang.font.subscript\r\n        });\r\n      },\r\n      clear: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.font.clear, {\r\n          event: 'removeFormat',\r\n          title: lang.font.clear\r\n        });\r\n      },\r\n      ul: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.lists.unordered, {\r\n          event: 'insertUnorderedList',\r\n          title: lang.lists.unordered\r\n        });\r\n      },\r\n      ol: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.lists.ordered, {\r\n          event: 'insertOrderedList',\r\n          title: lang.lists.ordered\r\n        });\r\n      },\r\n      paragraph: function (lang, options) {\r\n        var leftButton = tplIconButton(options.iconPrefix + options.icons.paragraph.left, {\r\n          title: lang.paragraph.left,\r\n          event: 'justifyLeft'\r\n        });\r\n        var centerButton = tplIconButton(options.iconPrefix + options.icons.paragraph.center, {\r\n          title: lang.paragraph.center,\r\n          event: 'justifyCenter'\r\n        });\r\n        var rightButton = tplIconButton(options.iconPrefix + options.icons.paragraph.right, {\r\n          title: lang.paragraph.right,\r\n          event: 'justifyRight'\r\n        });\r\n        var justifyButton = tplIconButton(options.iconPrefix + options.icons.paragraph.justify, {\r\n          title: lang.paragraph.justify,\r\n          event: 'justifyFull'\r\n        });\r\n\r\n        var outdentButton = tplIconButton(options.iconPrefix + options.icons.paragraph.outdent, {\r\n          title: lang.paragraph.outdent,\r\n          event: 'outdent'\r\n        });\r\n        var indentButton = tplIconButton(options.iconPrefix + options.icons.paragraph.indent, {\r\n          title: lang.paragraph.indent,\r\n          event: 'indent'\r\n        });\r\n\r\n        var dropdown = [\r\n          '<div class=\"note-align btn-group\">',\r\n          leftButton + centerButton + rightButton + justifyButton,\r\n          '</div><div class=\"note-list btn-group\">',\r\n          indentButton + outdentButton,\r\n          '</div>'\r\n        ];\r\n\r\n        return tplIconButton(options.iconPrefix + options.icons.paragraph.paragraph, {\r\n          title: lang.paragraph.paragraph,\r\n          dropdown: tplDropdown(dropdown, '', 'div')\r\n        });\r\n      },\r\n      height: function (lang, options) {\r\n        var items = options.lineHeights.reduce(function (memo, v) {\r\n          return memo + '<li><a data-event=\"lineHeight\" href=\"#\" data-value=\"' + parseFloat(v) + '\">' +\r\n                          '<i class=\"' + options.iconPrefix + options.icons.misc.check + '\"></i> ' + v +\r\n                        '</a></li>';\r\n        }, '');\r\n\r\n        return tplIconButton(options.iconPrefix + options.icons.font.height, {\r\n          title: lang.font.height,\r\n          dropdown: tplDropdown(items, 'note-check')\r\n        });\r\n\r\n      },\r\n      help: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.options.help, {\r\n          event: 'showHelpDialog',\r\n          title: lang.options.help,\r\n          hide: true\r\n        });\r\n      },\r\n      fullscreen: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.options.fullscreen, {\r\n          event: 'fullscreen',\r\n          title: lang.options.fullscreen\r\n        });\r\n      },\r\n      codeview: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.options.codeview, {\r\n          event: 'codeview',\r\n          title: lang.options.codeview\r\n        });\r\n      },\r\n      undo: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.history.undo, {\r\n          event: 'undo',\r\n          title: lang.history.undo\r\n        });\r\n      },\r\n      redo: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.history.redo, {\r\n          event: 'redo',\r\n          title: lang.history.redo\r\n        });\r\n      },\r\n      hr: function (lang, options) {\r\n        return tplIconButton(options.iconPrefix + options.icons.hr.insert, {\r\n          event: 'insertHorizontalRule',\r\n          title: lang.hr.insert\r\n        });\r\n      }\r\n    };\r\n\r\n    var tplPopovers = function (lang, options) {\r\n      var tplLinkPopover = function () {\r\n        var linkButton = tplIconButton(options.iconPrefix + options.icons.link.edit, {\r\n          title: lang.link.edit,\r\n          event: 'showLinkDialog',\r\n          hide: true\r\n        });\r\n        var unlinkButton = tplIconButton(options.iconPrefix + options.icons.link.unlink, {\r\n          title: lang.link.unlink,\r\n          event: 'unlink'\r\n        });\r\n        var content = '<a href=\"http://www.google.com\" target=\"_blank\">www.google.com</a>&nbsp;&nbsp;' +\r\n                      '<div class=\"note-insert btn-group\">' +\r\n                        linkButton + unlinkButton +\r\n                      '</div>';\r\n        return tplPopover('note-link-popover', content);\r\n      };\r\n\r\n      var tplImagePopover = function () {\r\n        var fullButton = tplButton('<span class=\"note-fontsize-10\">100%</span>', {\r\n          title: lang.image.resizeFull,\r\n          event: 'resize',\r\n          value: '1'\r\n        });\r\n        var halfButton = tplButton('<span class=\"note-fontsize-10\">50%</span>', {\r\n          title: lang.image.resizeHalf,\r\n          event: 'resize',\r\n          value: '0.5'\r\n        });\r\n        var quarterButton = tplButton('<span class=\"note-fontsize-10\">25%</span>', {\r\n          title: lang.image.resizeQuarter,\r\n          event: 'resize',\r\n          value: '0.25'\r\n        });\r\n\r\n        var leftButton = tplIconButton(options.iconPrefix + options.icons.image.floatLeft, {\r\n          title: lang.image.floatLeft,\r\n          event: 'floatMe',\r\n          value: 'left'\r\n        });\r\n        var rightButton = tplIconButton(options.iconPrefix + options.icons.image.floatRight, {\r\n          title: lang.image.floatRight,\r\n          event: 'floatMe',\r\n          value: 'right'\r\n        });\r\n        var justifyButton = tplIconButton(options.iconPrefix + options.icons.image.floatNone, {\r\n          title: lang.image.floatNone,\r\n          event: 'floatMe',\r\n          value: 'none'\r\n        });\r\n\r\n        var roundedButton = tplIconButton(options.iconPrefix + options.icons.image.shapeRounded, {\r\n          title: lang.image.shapeRounded,\r\n          event: 'imageShape',\r\n          value: 'img-rounded'\r\n        });\r\n        var circleButton = tplIconButton(options.iconPrefix + options.icons.image.shapeCircle, {\r\n          title: lang.image.shapeCircle,\r\n          event: 'imageShape',\r\n          value: 'img-circle'\r\n        });\r\n        var thumbnailButton = tplIconButton(options.iconPrefix + options.icons.image.shapeThumbnail, {\r\n          title: lang.image.shapeThumbnail,\r\n          event: 'imageShape',\r\n          value: 'img-thumbnail'\r\n        });\r\n        var noneButton = tplIconButton(options.iconPrefix + options.icons.image.shapeNone, {\r\n          title: lang.image.shapeNone,\r\n          event: 'imageShape',\r\n          value: ''\r\n        });\r\n\r\n        var removeButton = tplIconButton(options.iconPrefix + options.icons.image.remove, {\r\n          title: lang.image.remove,\r\n          event: 'removeMedia',\r\n          value: 'none'\r\n        });\r\n\r\n        var content = (options.disableResizeImage ? '' : '<div class=\"btn-group\">' + fullButton + halfButton + quarterButton + '</div>') +\r\n                      '<div class=\"btn-group\">' + leftButton + rightButton + justifyButton + '</div><br>' +\r\n                      '<div class=\"btn-group\">' + roundedButton + circleButton + thumbnailButton + noneButton + '</div>' +\r\n                      '<div class=\"btn-group\">' + removeButton + '</div>';\r\n        return tplPopover('note-image-popover', content);\r\n      };\r\n\r\n      var tplAirPopover = function () {\r\n        var $content = $('<div />');\r\n        for (var idx = 0, len = options.airPopover.length; idx < len; idx ++) {\r\n          var group = options.airPopover[idx];\r\n\r\n          var $group = $('<div class=\"note-' + group[0] + ' btn-group\">');\r\n          for (var i = 0, lenGroup = group[1].length; i < lenGroup; i++) {\r\n            var $button = $(tplButtonInfo[group[1][i]](lang, options));\r\n\r\n            $button.attr('data-name', group[1][i]);\r\n\r\n            $group.append($button);\r\n          }\r\n          $content.append($group);\r\n        }\r\n\r\n        return tplPopover('note-air-popover', $content.children());\r\n      };\r\n\r\n      var $notePopover = $('<div class=\"note-popover\" />');\r\n\r\n      $notePopover.append(tplLinkPopover());\r\n      $notePopover.append(tplImagePopover());\r\n\r\n      if (options.airMode) {\r\n        $notePopover.append(tplAirPopover());\r\n      }\r\n\r\n      return $notePopover;\r\n    };\r\n\r\n    var tplHandles = function (options) {\r\n      return '<div class=\"note-handle\">' +\r\n               '<div class=\"note-control-selection\">' +\r\n                 '<div class=\"note-control-selection-bg\"></div>' +\r\n                 '<div class=\"note-control-holder note-control-nw\"></div>' +\r\n                 '<div class=\"note-control-holder note-control-ne\"></div>' +\r\n                 '<div class=\"note-control-holder note-control-sw\"></div>' +\r\n                 '<div class=\"' +\r\n                 (options.disableResizeImage ? 'note-control-holder' : 'note-control-sizing') +\r\n                 ' note-control-se\"></div>' +\r\n                 (options.disableResizeImage ? '' : '<div class=\"note-control-selection-info\"></div>') +\r\n               '</div>' +\r\n             '</div>';\r\n    };\r\n\r\n    /**\r\n     * shortcut table template\r\n     * @param {String} title\r\n     * @param {String} body\r\n     */\r\n    var tplShortcut = function (title, keys) {\r\n      var keyClass = 'note-shortcut-col col-xs-6 note-shortcut-';\r\n      var body = [];\r\n\r\n      for (var i in keys) {\r\n        if (keys.hasOwnProperty(i)) {\r\n          body.push(\r\n            '<div class=\"' + keyClass + 'key\">' + keys[i].kbd + '</div>' +\r\n            '<div class=\"' + keyClass + 'name\">' + keys[i].text + '</div>'\r\n            );\r\n        }\r\n      }\r\n\r\n      return '<div class=\"note-shortcut-row row\"><div class=\"' + keyClass + 'title col-xs-offset-6\">' + title + '</div></div>' +\r\n             '<div class=\"note-shortcut-row row\">' + body.join('</div><div class=\"note-shortcut-row row\">') + '</div>';\r\n    };\r\n\r\n    var tplShortcutText = function (lang) {\r\n      var keys = [\r\n        { kbd: ' + B', text: lang.font.bold },\r\n        { kbd: ' + I', text: lang.font.italic },\r\n        { kbd: ' + U', text: lang.font.underline },\r\n        { kbd: ' + \\\\', text: lang.font.clear }\r\n      ];\r\n\r\n      return tplShortcut(lang.shortcut.textFormatting, keys);\r\n    };\r\n\r\n    var tplShortcutAction = function (lang) {\r\n      var keys = [\r\n        { kbd: ' + Z', text: lang.history.undo },\r\n        { kbd: ' +  + Z', text: lang.history.redo },\r\n        { kbd: ' + ]', text: lang.paragraph.indent },\r\n        { kbd: ' + [', text: lang.paragraph.outdent },\r\n        { kbd: ' + ENTER', text: lang.hr.insert }\r\n      ];\r\n\r\n      return tplShortcut(lang.shortcut.action, keys);\r\n    };\r\n\r\n    var tplShortcutPara = function (lang) {\r\n      var keys = [\r\n        { kbd: ' +  + L', text: lang.paragraph.left },\r\n        { kbd: ' +  + E', text: lang.paragraph.center },\r\n        { kbd: ' +  + R', text: lang.paragraph.right },\r\n        { kbd: ' +  + J', text: lang.paragraph.justify },\r\n        { kbd: ' +  + NUM7', text: lang.lists.ordered },\r\n        { kbd: ' +  + NUM8', text: lang.lists.unordered }\r\n      ];\r\n\r\n      return tplShortcut(lang.shortcut.paragraphFormatting, keys);\r\n    };\r\n\r\n    var tplShortcutStyle = function (lang) {\r\n      var keys = [\r\n        { kbd: ' + NUM0', text: lang.style.normal },\r\n        { kbd: ' + NUM1', text: lang.style.h1 },\r\n        { kbd: ' + NUM2', text: lang.style.h2 },\r\n        { kbd: ' + NUM3', text: lang.style.h3 },\r\n        { kbd: ' + NUM4', text: lang.style.h4 },\r\n        { kbd: ' + NUM5', text: lang.style.h5 },\r\n        { kbd: ' + NUM6', text: lang.style.h6 }\r\n      ];\r\n\r\n      return tplShortcut(lang.shortcut.documentStyle, keys);\r\n    };\r\n\r\n    var tplExtraShortcuts = function (lang, options) {\r\n      var extraKeys = options.extraKeys;\r\n      var keys = [];\r\n\r\n      for (var key in extraKeys) {\r\n        if (extraKeys.hasOwnProperty(key)) {\r\n          keys.push({ kbd: key, text: extraKeys[key] });\r\n        }\r\n      }\r\n\r\n      return tplShortcut(lang.shortcut.extraKeys, keys);\r\n    };\r\n\r\n    var tplShortcutTable = function (lang, options) {\r\n      var colClass = 'class=\"note-shortcut note-shortcut-col col-sm-6 col-xs-12\"';\r\n      var template = [\r\n        '<div ' + colClass + '>' + tplShortcutAction(lang, options) + '</div>' +\r\n        '<div ' + colClass + '>' + tplShortcutText(lang, options) + '</div>',\r\n        '<div ' + colClass + '>' + tplShortcutStyle(lang, options) + '</div>' +\r\n        '<div ' + colClass + '>' + tplShortcutPara(lang, options) + '</div>'\r\n      ];\r\n\r\n      if (options.extraKeys) {\r\n        template.push('<div ' + colClass + '>' + tplExtraShortcuts(lang, options) + '</div>');\r\n      }\r\n\r\n      return '<div class=\"note-shortcut-row row\">' +\r\n               template.join('</div><div class=\"note-shortcut-row row\">') +\r\n             '</div>';\r\n    };\r\n\r\n    var replaceMacKeys = function (sHtml) {\r\n      return sHtml.replace(//g, 'Ctrl').replace(//g, 'Shift');\r\n    };\r\n\r\n    var tplDialogInfo = {\r\n      image: function (lang, options) {\r\n        var imageLimitation = '';\r\n        if (options.maximumImageFileSize) {\r\n          var unit = Math.floor(Math.log(options.maximumImageFileSize) / Math.log(1024));\r\n          var readableSize = (options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 +\r\n                             ' ' + ' KMGTP'[unit] + 'B';\r\n          imageLimitation = '<small>' + lang.image.maximumFileSize + ' : ' + readableSize + '</small>';\r\n        }\r\n\r\n        var body = '<div class=\"form-group row note-group-select-from-files\">' +\r\n                     '<label>' + lang.image.selectFromFiles + '</label>' +\r\n                     '<input class=\"note-image-input form-control\" type=\"file\" name=\"files\" accept=\"image/*\" multiple=\"multiple\" />' +\r\n                     imageLimitation +\r\n                   '</div>' +\r\n                   '<div class=\"form-group row\">' +\r\n                     '<label>' + lang.image.url + '</label>' +\r\n                     '<input class=\"note-image-url form-control col-md-12\" type=\"text\" />' +\r\n                   '</div>';\r\n        var footer = '<button href=\"#\" class=\"btn btn-primary note-image-btn disabled\" disabled>' + lang.image.insert + '</button>';\r\n        return tplDialog('note-image-dialog', lang.image.insert, body, footer);\r\n      },\r\n\r\n      link: function (lang, options) {\r\n        var body = '<div class=\"form-group row\">' +\r\n                     '<label>' + lang.link.textToDisplay + '</label>' +\r\n                     '<input class=\"note-link-text form-control col-md-12\" type=\"text\" />' +\r\n                   '</div>' +\r\n                   '<div class=\"form-group row\">' +\r\n                     '<label>' + lang.link.url + '</label>' +\r\n                     '<input class=\"note-link-url form-control col-md-12\" type=\"text\" value=\"http://\" />' +\r\n                   '</div>' +\r\n                   (!options.disableLinkTarget ?\r\n                     '<div class=\"checkbox\">' +\r\n                       '<label>' + '<input type=\"checkbox\" checked> ' +\r\n                         lang.link.openInNewWindow +\r\n                       '</label>' +\r\n                     '</div>' : ''\r\n                   );\r\n        var footer = '<button href=\"#\" class=\"btn btn-primary note-link-btn disabled\" disabled>' + lang.link.insert + '</button>';\r\n        return tplDialog('note-link-dialog', lang.link.insert, body, footer);\r\n      },\r\n\r\n      help: function (lang, options) {\r\n        var body = '<a class=\"modal-close pull-right\" aria-hidden=\"true\" tabindex=\"-1\">' + lang.shortcut.close + '</a>' +\r\n                   '<div class=\"title\">' + lang.shortcut.shortcuts + '</div>' +\r\n                   (agent.isMac ? tplShortcutTable(lang, options) : replaceMacKeys(tplShortcutTable(lang, options))) +\r\n                   '<p class=\"text-center\">' +\r\n                     '<a href=\"//summernote.org/\" target=\"_blank\">Summernote 0.6.16</a>  ' +\r\n                     '<a href=\"//github.com/summernote/summernote\" target=\"_blank\">Project</a>  ' +\r\n                     '<a href=\"//github.com/summernote/summernote/issues\" target=\"_blank\">Issues</a>' +\r\n                   '</p>';\r\n        return tplDialog('note-help-dialog', '', body, '');\r\n      }\r\n    };\r\n\r\n    var tplDialogs = function (lang, options) {\r\n      var dialogs = '';\r\n\r\n      $.each(tplDialogInfo, function (idx, tplDialog) {\r\n        dialogs += tplDialog(lang, options);\r\n      });\r\n\r\n      return '<div class=\"note-dialog\">' + dialogs + '</div>';\r\n    };\r\n\r\n    var tplStatusbar = function () {\r\n      return '<div class=\"note-resizebar\">' +\r\n               '<div class=\"note-icon-bar\"></div>' +\r\n               '<div class=\"note-icon-bar\"></div>' +\r\n               '<div class=\"note-icon-bar\"></div>' +\r\n             '</div>';\r\n    };\r\n\r\n    var representShortcut = function (str) {\r\n      if (agent.isMac) {\r\n        str = str.replace('CMD', '').replace('SHIFT', '');\r\n      }\r\n\r\n      return str.replace('BACKSLASH', '\\\\')\r\n                .replace('SLASH', '/')\r\n                .replace('LEFTBRACKET', '[')\r\n                .replace('RIGHTBRACKET', ']');\r\n    };\r\n\r\n    /**\r\n     * createTooltip\r\n     *\r\n     * @param {jQuery} $container\r\n     * @param {Object} keyMap\r\n     * @param {String} [sPlacement]\r\n     */\r\n    var createTooltip = function ($container, keyMap, sPlacement) {\r\n      var invertedKeyMap = func.invertObject(keyMap);\r\n      var $buttons = $container.find('button');\r\n\r\n      $buttons.each(function (i, elBtn) {\r\n        var $btn = $(elBtn);\r\n        var sShortcut = invertedKeyMap[$btn.data('event')];\r\n        if (sShortcut) {\r\n          $btn.attr('title', function (i, v) {\r\n            return v + ' (' + representShortcut(sShortcut) + ')';\r\n          });\r\n        }\r\n      // bootstrap tooltip on btn-group bug\r\n      // https://github.com/twbs/bootstrap/issues/5687\r\n      }).tooltip({\r\n        container: 'body',\r\n        trigger: 'hover',\r\n        placement: sPlacement || 'top'\r\n      }).on('click', function () {\r\n        $(this).tooltip('hide');\r\n      });\r\n    };\r\n\r\n    // createPalette\r\n    var createPalette = function ($container, options) {\r\n      var colorInfo = options.colors;\r\n      $container.find('.note-color-palette').each(function () {\r\n        var $palette = $(this), eventName = $palette.attr('data-target-event');\r\n        var paletteContents = [];\r\n        for (var row = 0, lenRow = colorInfo.length; row < lenRow; row++) {\r\n          var colors = colorInfo[row];\r\n          var buttons = [];\r\n          for (var col = 0, lenCol = colors.length; col < lenCol; col++) {\r\n            var color = colors[col];\r\n            buttons.push(['<button type=\"button\" class=\"note-color-btn\" style=\"background-color:', color,\r\n                           ';\" data-event=\"', eventName,\r\n                           '\" data-value=\"', color,\r\n                           '\" title=\"', color,\r\n                           '\" data-toggle=\"button\" tabindex=\"-1\"></button>'].join(''));\r\n          }\r\n          paletteContents.push('<div class=\"note-color-row\">' + buttons.join('') + '</div>');\r\n        }\r\n        $palette.html(paletteContents.join(''));\r\n      });\r\n    };\r\n\r\n    /**\r\n     * create summernote layout (air mode)\r\n     *\r\n     * @param {jQuery} $holder\r\n     * @param {Object} options\r\n     */\r\n    this.createLayoutByAirMode = function ($holder, options) {\r\n      var langInfo = options.langInfo;\r\n      var keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\r\n      var id = func.uniqueId();\r\n\r\n      $holder.addClass('note-air-editor note-editable panel-body');\r\n      $holder.attr({\r\n        'id': 'note-editor-' + id,\r\n        'contentEditable': true\r\n      });\r\n\r\n      var body = document.body;\r\n\r\n      // create Popover\r\n      var $popover = $(tplPopovers(langInfo, options));\r\n      $popover.addClass('note-air-layout');\r\n      $popover.attr('id', 'note-popover-' + id);\r\n      $popover.appendTo(body);\r\n      createTooltip($popover, keyMap);\r\n      createPalette($popover, options);\r\n\r\n      // create Handle\r\n      var $handle = $(tplHandles(options));\r\n      $handle.addClass('note-air-layout');\r\n      $handle.attr('id', 'note-handle-' + id);\r\n      $handle.appendTo(body);\r\n\r\n      // create Dialog\r\n      var $dialog = $(tplDialogs(langInfo, options));\r\n      $dialog.addClass('note-air-layout');\r\n      $dialog.attr('id', 'note-dialog-' + id);\r\n      $dialog.find('button.close, a.modal-close').click(function () {\r\n        $(this).closest('.modal').modal('hide');\r\n      });\r\n      $dialog.appendTo(body);\r\n    };\r\n\r\n    /**\r\n     * create summernote layout (normal mode)\r\n     *\r\n     * @param {jQuery} $holder\r\n     * @param {Object} options\r\n     */\r\n    this.createLayoutByFrame = function ($holder, options) {\r\n      var langInfo = options.langInfo;\r\n\r\n      //01. create Editor\r\n      var $editor = $('<div class=\"note-editor panel panel-default\" />');\r\n      if (options.width) {\r\n        $editor.width(options.width);\r\n      }\r\n\r\n      //02. statusbar (resizebar)\r\n      if (options.height > 0) {\r\n        $('<div class=\"note-statusbar\">' + (options.disableResizeEditor ? '' : tplStatusbar()) + '</div>').prependTo($editor);\r\n      }\r\n\r\n      //03 editing area\r\n      var $editingArea = $('<div class=\"note-editing-area\" />');\r\n      //03. create editable\r\n      var isContentEditable = !$holder.is(':disabled');\r\n      var $editable = $('<div class=\"note-editable panel-body\" contentEditable=\"' + isContentEditable + '\"></div>').prependTo($editingArea);\r\n      \r\n      if (options.height) {\r\n        $editable.height(options.height);\r\n      }\r\n      if (options.direction) {\r\n        $editable.attr('dir', options.direction);\r\n      }\r\n      var placeholder = $holder.attr('placeholder') || options.placeholder;\r\n      if (placeholder) {\r\n        $editable.attr('data-placeholder', placeholder);\r\n      }\r\n\r\n      $editable.html(dom.html($holder) || dom.emptyPara);\r\n\r\n      //031. create codable\r\n      $('<textarea class=\"note-codable\"></textarea>').prependTo($editingArea);\r\n\r\n      //04. create Popover\r\n      var $popover = $(tplPopovers(langInfo, options)).prependTo($editingArea);\r\n      createPalette($popover, options);\r\n      createTooltip($popover, keyMap);\r\n\r\n      //05. handle(control selection, ...)\r\n      $(tplHandles(options)).prependTo($editingArea);\r\n\r\n      $editingArea.prependTo($editor);\r\n\r\n      //06. create Toolbar\r\n      var $toolbar = $('<div class=\"note-toolbar panel-heading\" />');\r\n      for (var idx = 0, len = options.toolbar.length; idx < len; idx ++) {\r\n        var groupName = options.toolbar[idx][0];\r\n        var groupButtons = options.toolbar[idx][1];\r\n\r\n        var $group = $('<div class=\"note-' + groupName + ' btn-group\" />');\r\n        for (var i = 0, btnLength = groupButtons.length; i < btnLength; i++) {\r\n          var buttonInfo = tplButtonInfo[groupButtons[i]];\r\n          // continue creating toolbar even if a button doesn't exist\r\n          if (!$.isFunction(buttonInfo)) { continue; }\r\n\r\n          var $button = $(buttonInfo(langInfo, options));\r\n          $button.attr('data-name', groupButtons[i]);  // set button's alias, becuase to get button element from $toolbar\r\n          $group.append($button);\r\n        }\r\n        $toolbar.append($group);\r\n      }\r\n\r\n      var keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\r\n      createPalette($toolbar, options);\r\n      createTooltip($toolbar, keyMap, 'bottom');\r\n      $toolbar.prependTo($editor);\r\n\r\n      //07. create Dropzone\r\n      $('<div class=\"note-dropzone\"><div class=\"note-dropzone-message\"></div></div>').prependTo($editor);\r\n\r\n      //08. create Dialog\r\n      var $dialogContainer = options.dialogsInBody ? $(document.body) : $editor;\r\n      var $dialog = $(tplDialogs(langInfo, options)).prependTo($dialogContainer);\r\n      $dialog.find('button.close, a.modal-close').click(function () {\r\n        $(this).closest('.modal').modal('hide');\r\n      });\r\n\r\n      //09. Editor/Holder switch\r\n      $editor.insertAfter($holder);\r\n      $holder.hide();\r\n    };\r\n\r\n    this.hasNoteEditor = function ($holder) {\r\n      return this.noteEditorFromHolder($holder).length > 0;\r\n    };\r\n\r\n    this.noteEditorFromHolder = function ($holder) {\r\n      if ($holder.hasClass('note-air-editor')) {\r\n        return $holder;\r\n      } else if ($holder.next().hasClass('note-editor')) {\r\n        return $holder.next();\r\n      } else {\r\n        return $();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * create summernote layout\r\n     *\r\n     * @param {jQuery} $holder\r\n     * @param {Object} options\r\n     */\r\n    this.createLayout = function ($holder, options) {\r\n      if (options.airMode) {\r\n        this.createLayoutByAirMode($holder, options);\r\n      } else {\r\n        this.createLayoutByFrame($holder, options);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * returns layoutInfo from holder\r\n     *\r\n     * @param {jQuery} $holder - placeholder\r\n     * @return {Object}\r\n     */\r\n    this.layoutInfoFromHolder = function ($holder) {\r\n      var $editor = this.noteEditorFromHolder($holder);\r\n      if (!$editor.length) {\r\n        return;\r\n      }\r\n\r\n      // connect $holder to $editor\r\n      $editor.data('holder', $holder);\r\n\r\n      return dom.buildLayoutInfo($editor);\r\n    };\r\n\r\n    /**\r\n     * removeLayout\r\n     *\r\n     * @param {jQuery} $holder - placeholder\r\n     * @param {Object} layoutInfo\r\n     * @param {Object} options\r\n     *\r\n     */\r\n    this.removeLayout = function ($holder, layoutInfo, options) {\r\n      if (options.airMode) {\r\n        $holder.removeClass('note-air-editor note-editable')\r\n               .removeAttr('id contentEditable');\r\n\r\n        layoutInfo.popover().remove();\r\n        layoutInfo.handle().remove();\r\n        layoutInfo.dialog().remove();\r\n      } else {\r\n        $holder.html(layoutInfo.editable().html());\r\n\r\n        if (options.dialogsInBody) {\r\n          layoutInfo.dialog().remove();\r\n        }\r\n        layoutInfo.editor().remove();\r\n        $holder.show();\r\n      }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @return {Object}\r\n     * @return {function(label, options=):string} return.button {@link #tplButton function to make text button}\r\n     * @return {function(iconClass, options=):string} return.iconButton {@link #tplIconButton function to make icon button}\r\n     * @return {function(className, title=, body=, footer=):string} return.dialog {@link #tplDialog function to make dialog}\r\n     */\r\n    this.getTemplate = function () {\r\n      return {\r\n        button: tplButton,\r\n        iconButton: tplIconButton,\r\n        dialog: tplDialog\r\n      };\r\n    };\r\n\r\n    /**\r\n     * add button information\r\n     *\r\n     * @param {String} name button name\r\n     * @param {Function} buttonInfo function to make button, reference to {@link #tplButton},{@link #tplIconButton}\r\n     */\r\n    this.addButtonInfo = function (name, buttonInfo) {\r\n      tplButtonInfo[name] = buttonInfo;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} name\r\n     * @param {Function} dialogInfo function to make dialog, reference to {@link #tplDialog}\r\n     */\r\n    this.addDialogInfo = function (name, dialogInfo) {\r\n      tplDialogInfo[name] = dialogInfo;\r\n    };\r\n  };\r\n\r\n\r\n  // jQuery namespace for summernote\r\n  /**\r\n   * @class $.summernote \r\n   * \r\n   * summernote attribute  \r\n   * \r\n   * @mixin defaults\r\n   * @singleton  \r\n   * \r\n   */\r\n  $.summernote = $.summernote || {};\r\n\r\n  // extends default settings\r\n  //  - $.summernote.version\r\n  //  - $.summernote.options\r\n  //  - $.summernote.lang\r\n  $.extend($.summernote, defaults);\r\n\r\n  var renderer = new Renderer();\r\n  var eventHandler = new EventHandler();\r\n\r\n  $.extend($.summernote, {\r\n    /** @property {Renderer} */\r\n    renderer: renderer,\r\n    /** @property {EventHandler} */\r\n    eventHandler: eventHandler,\r\n    /** \r\n     * @property {Object} core \r\n     * @property {core.agent} core.agent \r\n     * @property {core.dom} core.dom\r\n     * @property {core.range} core.range \r\n     */\r\n    core: {\r\n      agent: agent,\r\n      list : list,\r\n      dom: dom,\r\n      range: range\r\n    },\r\n    /** \r\n     * @property {Object} \r\n     * pluginEvents event list for plugins\r\n     * event has name and callback function.\r\n     * \r\n     * ``` \r\n     * $.summernote.addPlugin({\r\n     *     events : {\r\n     *          'hello' : function(layoutInfo, value, $target) {\r\n     *              console.log('event name is hello, value is ' + value );\r\n     *          }\r\n     *     }     \r\n     * })\r\n     * ```\r\n     * \r\n     * * event name is data-event property.\r\n     * * layoutInfo is a summernote layout information.\r\n     * * value is data-value property.\r\n     */\r\n    pluginEvents: {},\r\n\r\n    plugins : []\r\n  });\r\n\r\n  /**\r\n   * @method addPlugin\r\n   *\r\n   * add Plugin in Summernote \r\n   * \r\n   * Summernote can make a own plugin.\r\n   *\r\n   * ### Define plugin\r\n   * ```\r\n   * // get template function  \r\n   * var tmpl = $.summernote.renderer.getTemplate();\r\n   * \r\n   * // add a button   \r\n   * $.summernote.addPlugin({\r\n   *     buttons : {\r\n   *        // \"hello\"  is button's namespace.      \r\n   *        \"hello\" : function(lang, options) {\r\n   *            // make icon button by template function          \r\n   *            return tmpl.iconButton(options.iconPrefix + 'header', {\r\n   *                // callback function name when button clicked \r\n   *                event : 'hello',\r\n   *                // set data-value property                 \r\n   *                value : 'hello',                \r\n   *                hide : true\r\n   *            });           \r\n   *        }\r\n   *     \r\n   *     }, \r\n   *     \r\n   *     events : {\r\n   *        \"hello\" : function(layoutInfo, value) {\r\n   *            // here is event code \r\n   *        }\r\n   *     }     \r\n   * });\r\n   * ``` \r\n   * ### Use a plugin in toolbar\r\n   * \r\n   * ``` \r\n   *    $(\"#editor\").summernote({\r\n   *    ...\r\n   *    toolbar : [\r\n   *        // display hello plugin in toolbar     \r\n   *        ['group', [ 'hello' ]]\r\n   *    ]\r\n   *    ...    \r\n   *    });\r\n   * ```\r\n   *  \r\n   *  \r\n   * @param {Object} plugin\r\n   * @param {Object} [plugin.buttons] define plugin button. for detail, see to Renderer.addButtonInfo\r\n   * @param {Object} [plugin.dialogs] define plugin dialog. for detail, see to Renderer.addDialogInfo\r\n   * @param {Object} [plugin.events] add event in $.summernote.pluginEvents \r\n   * @param {Object} [plugin.langs] update $.summernote.lang\r\n   * @param {Object} [plugin.options] update $.summernote.options\r\n   */\r\n  $.summernote.addPlugin = function (plugin) {\r\n\r\n    // save plugin list\r\n    $.summernote.plugins.push(plugin);\r\n\r\n    if (plugin.buttons) {\r\n      $.each(plugin.buttons, function (name, button) {\r\n        renderer.addButtonInfo(name, button);\r\n      });\r\n    }\r\n\r\n    if (plugin.dialogs) {\r\n      $.each(plugin.dialogs, function (name, dialog) {\r\n        renderer.addDialogInfo(name, dialog);\r\n      });\r\n    }\r\n\r\n    if (plugin.events) {\r\n      $.each(plugin.events, function (name, event) {\r\n        $.summernote.pluginEvents[name] = event;\r\n      });\r\n    }\r\n\r\n    if (plugin.langs) {\r\n      $.each(plugin.langs, function (locale, lang) {\r\n        if ($.summernote.lang[locale]) {\r\n          $.extend($.summernote.lang[locale], lang);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (plugin.options) {\r\n      $.extend($.summernote.options, plugin.options);\r\n    }\r\n  };\r\n\r\n  /*\r\n   * extend $.fn\r\n   */\r\n  $.fn.extend({\r\n    /**\r\n     * @method\r\n     * Initialize summernote\r\n     *  - create editor layout and attach Mouse and keyboard events.\r\n     * \r\n     * ```\r\n     * $(\"#summernote\").summernote( { options ..} );\r\n     * ```\r\n     *   \r\n     * @member $.fn\r\n     * @param {Object|String} options reference to $.summernote.options\r\n     * @return {this}\r\n     */\r\n    summernote: function () {\r\n      // check first argument's type\r\n      //  - {String}: External API call {{module}}.{{method}}\r\n      //  - {Object}: init options\r\n      var type = $.type(list.head(arguments));\r\n      var isExternalAPICalled = type === 'string';\r\n      var hasInitOptions = type === 'object';\r\n\r\n      // extend default options with custom user options\r\n      var options = hasInitOptions ? list.head(arguments) : {};\r\n\r\n      options = $.extend({}, $.summernote.options, options);\r\n      options.icons = $.extend({}, $.summernote.options.icons, options.icons);\r\n\r\n      // Include langInfo in options for later use, e.g. for image drag-n-drop\r\n      // Setup language info with en-US as default\r\n      options.langInfo = $.extend(true, {}, $.summernote.lang['en-US'], $.summernote.lang[options.lang]);\r\n\r\n      // override plugin options\r\n      if (!isExternalAPICalled && hasInitOptions) {\r\n        for (var i = 0, len = $.summernote.plugins.length; i < len; i++) {\r\n          var plugin = $.summernote.plugins[i];\r\n\r\n          if (options.plugin[plugin.name]) {\r\n            $.summernote.plugins[i] = $.extend(true, plugin, options.plugin[plugin.name]);\r\n          }\r\n        }\r\n      }\r\n\r\n      this.each(function (idx, holder) {\r\n        var $holder = $(holder);\r\n\r\n        // if layout isn't created yet, createLayout and attach events\r\n        if (!renderer.hasNoteEditor($holder)) {\r\n          renderer.createLayout($holder, options);\r\n\r\n          var layoutInfo = renderer.layoutInfoFromHolder($holder);\r\n          $holder.data('layoutInfo', layoutInfo);\r\n\r\n          eventHandler.attach(layoutInfo, options);\r\n          eventHandler.attachCustomEvent(layoutInfo, options);\r\n        }\r\n      });\r\n\r\n      var $first = this.first();\r\n      if ($first.length) {\r\n        var layoutInfo = renderer.layoutInfoFromHolder($first);\r\n\r\n        // external API\r\n        if (isExternalAPICalled) {\r\n          var moduleAndMethod = list.head(list.from(arguments));\r\n          var args = list.tail(list.from(arguments));\r\n\r\n          // TODO now external API only works for editor\r\n          var params = [moduleAndMethod, layoutInfo.editable()].concat(args);\r\n          return eventHandler.invoke.apply(eventHandler, params);\r\n        } else if (options.focus) {\r\n          // focus on first editable element for initialize editor\r\n          layoutInfo.editable().focus();\r\n        }\r\n      }\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @method \r\n     * \r\n     * get the HTML contents of note or set the HTML contents of note.\r\n     *\r\n     * * get contents \r\n     * ```\r\n     * var content = $(\"#summernote\").code();\r\n     * ```\r\n     * * set contents \r\n     *\r\n     * ```\r\n     * $(\"#summernote\").code(html);\r\n     * ```\r\n     *\r\n     * @member $.fn \r\n     * @param {String} [html] - HTML contents(optional, set)\r\n     * @return {this|String} - context(set) or HTML contents of note(get).\r\n     */\r\n    code: function (html) {\r\n      // get the HTML contents of note\r\n      if (html === undefined) {\r\n        var $holder = this.first();\r\n        if (!$holder.length) {\r\n          return;\r\n        }\r\n\r\n        var layoutInfo = renderer.layoutInfoFromHolder($holder);\r\n        var $editable = layoutInfo && layoutInfo.editable();\r\n\r\n        if ($editable && $editable.length) {\r\n          var isCodeview = eventHandler.invoke('codeview.isActivated', layoutInfo);\r\n          eventHandler.invoke('codeview.sync', layoutInfo);\r\n          return isCodeview ? layoutInfo.codable().val() :\r\n                              layoutInfo.editable().html();\r\n        }\r\n        return dom.value($holder);\r\n      }\r\n\r\n      // set the HTML contents of note\r\n      this.each(function (i, holder) {\r\n        var layoutInfo = renderer.layoutInfoFromHolder($(holder));\r\n        var $editable = layoutInfo && layoutInfo.editable();\r\n        if ($editable) {\r\n          $editable.html(html);\r\n        }\r\n      });\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @method\r\n     * \r\n     * destroy Editor Layout and detach Key and Mouse Event\r\n     *\r\n     * @member $.fn\r\n     * @return {this}\r\n     */\r\n    destroy: function () {\r\n      this.each(function (idx, holder) {\r\n        var $holder = $(holder);\r\n\r\n        if (!renderer.hasNoteEditor($holder)) {\r\n          return;\r\n        }\r\n\r\n        var info = renderer.layoutInfoFromHolder($holder);\r\n        var options = info.editor().data('options');\r\n\r\n        eventHandler.detach(info, options);\r\n        renderer.removeLayout($holder, info, options);\r\n      });\r\n\r\n      return this;\r\n    }\r\n  });\r\n}));\r\n"]}