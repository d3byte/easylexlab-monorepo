{"version":3,"sources":["../../server/controllers/userController.js"],"names":["userController","post","req","res","body","firstName","lastName","username","email","password","permissions","groupCode","school","city","User","findOne","err","user","json","error","length","Group","code","then","_groups","group","_id","save","transporter","createTransport","service","secure","port","auth","pass","tls","rejectUnauthorized","newUser","HelperOptions","from","to","subject","text","sendMail","info","console","log","success","status","userId","catch","message","login","verifyPassword","valid","token","sign","id","getGroups","groupId","findById","updateInfo","myUser","query","changed","findByIdAndUpdate","$set","changePassword","newPassword","recoverToken","addGroup","findOneAndUpdate","$push","getNotifications","notifications","removeNotification","filter","notif","notificationsCopy","suc—Åess","getUser","populate","path","model","learnWords","amount","stackId","userResult","pairsLength","Stack","result","stack","results","difference","Math","abs","newAmount","round","$inc","wordsLearnt","firstTime","recoverPassword","uri","encodeURI","checkToken","sendFeedback","name","leaveGroup","getAvatar","picName","filePath","exists","readFile","encoding","data","ext","extname","img"],"mappings":"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","file":"userController.js","sourcesContent":["import { verifyPassword, encryptPassword } from 'mongoose-bcrypt';\nimport jwt from 'jsonwebtoken';\nimport secret from './../secret';\nimport helper from './helperFunctions';\nimport nodemailer from 'nodemailer';\nimport fs from 'fs';\nimport path from 'path';\n\nimport db from './../models';\n\nconst userController = {};\n\nuserController.post = (req, res) => {\n    const {\n        firstName,\n        lastName,\n        username,\n        email,\n        password,\n        permissions,\n        groupCode,\n        school,\n        city\n    } = req.body;\n\n    db.User.findOne({username}, (err, user) => {\n        if (err)\n            throw err;\n        else if (user)\n            return res.json({error: '–î–∞–Ω–Ω—ã–π –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç'});\n        else {\n            db.User.findOne({email}, (err, user) => {\n                if (err)\n                    throw err;\n                else if (user)\n                    res.json({error: '–î–∞–Ω–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞'});\n                else {\n                    if (!!groupCode.length) {\n                        db.Group.findOne({code: groupCode}).then(group => {\n                            const user = new db.User({\n                                firstName,\n                                lastName,\n                                username,\n                                email,\n                                password,\n                                permissions,\n                                _groups: [group._id],\n                                school,\n                                city\n                            });\n                            user.save().then(newUser => {\n                                let transporter = nodemailer.createTransport({\n                                  service: 'gmail',\n                                  secure: false,\n                                  port: 25,\n                                  auth: {\n                                    user: 'easylexlab@gmail.com',\n                                    pass: '45aCRawa@hut'\n                                  },\n                                  tls: {\n                                    rejectUnauthorized: false\n                                  }\n                                });\n                                if(newUser.permissions == 'student') {\n                                    let HelperOptions = {\n                                        from: '\"EasyLexLab\" <easylexlab@gmail.com>',\n                                        to: newUser.email,\n                                        // to: 'easylexlab@gmail.com',\n                                        subject: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ EasyLexLab',\n                                        text:\n                                            `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${newUser.firstName} ${newUser.lastName}!\\n \n                                            –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ —Ç–æ, —á—Ç–æ –≤—ã —Å—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º EasyLexLab!\\n\n                                            –õ–æ–≥–∏–Ω: ${newUser.username}\n                                            –ü–∞—Ä–æ–ª—å: ${password}\\n\n                                            EasyLexLab ‚Äì —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π –∏ —É—á–µ–Ω–∏–∫–æ–≤, –∏–∑—É—á–∞—é—â–∏—Ö —è–∑—ã–∫–∏.\\n\n                                            EasyLexLab –º–æ–∂–µ—Ç –í–∞–º –ø–æ–º–æ—á—å:\\n\n                                            \\t- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –§–ì–û–°.\n                                            \\t- –ü—Ä–æ–≤–æ–¥–∏—Ç—å —É—Ä–æ–∫–∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è –∏ —É—Å–≤–æ–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω –∑–∞ —Ä–∞–º–∫–∏ —É—Ä–æ–∫–∞ (–¥–µ—Ç–∏ –¥–µ–ª–∞—é—Ç –≤—Å–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –¥–æ–º–∞).\n                                            \\t- –ë–æ–ª–µ–µ –≥–∏–±–∫–æ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, —É—á–∏—Ç—ã–≤–∞—è —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã.\n                                            \\t- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤, –ø–æ–º–æ–≥–∞—è —É—á–µ–Ω–∏–∫–∞–º –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —É—Å–ø–µ—Ö–æ–≤ –≤ –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫–æ–≤.\\n\n                                            –° –Ω–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É—á–∏—Ç—å –∏ –ª–µ–≥–∫–æ —É—á–∏—Ç—å—Å—è!\\n\n                                            –° —É–≤–∞–∂–µ–Ω–∏–µ–º,\n                                            –ö–æ–º–∞–Ω–¥–∞ EasyLexLab`\n                                    };\n                                    transporter.sendMail(HelperOptions, (error, info) => {\n                                        if (error) {\n                                            console.log(error);\n                                        } else {\n                                            return res.json({ success: true })\n                                        }\n                                    });\n                                } else if(newUser.permissions == 'teacher') {\n                                    let HelperOptions = {\n                                        from: '\"EasyLexLab\" <easylexlab@gmail.com>',\n                                        to: newUser.email,\n                                        // to: 'easylexlab@gmail.com',\n                                        subject: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ EasyLexLab',\n                                        text:\n                                            `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${newUser.firstName} ${newUser.lastName}!\\n\n                                            –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ —Ç–æ, —á—Ç–æ –≤—ã —Å—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º EasyLexLab!\\n\n                                            –õ–æ–≥–∏–Ω: ${newUser.username}\n                                            –ü–∞—Ä–æ–ª—å: ${password}\\n\n                                            EasyLexLab ‚Äì —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π –∏ —É—á–µ–Ω–∏–∫–æ–≤, –∏–∑—É—á–∞—é—â–∏—Ö —è–∑—ã–∫–∏.\\n\n                                            EasyLexLab –º–æ–∂–µ—Ç –í–∞–º –ø–æ–º–æ—á—å:\\n\n                                            \\t- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –§–ì–û–°.\n                                            \\t- –ü—Ä–æ–≤–æ–¥–∏—Ç—å —É—Ä–æ–∫–∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è –∏ —É—Å–≤–æ–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω –∑–∞ —Ä–∞–º–∫–∏ —É—Ä–æ–∫–∞ (–¥–µ—Ç–∏ –¥–µ–ª–∞—é—Ç –≤—Å–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –¥–æ–º–∞).\n                                            \\t- –ë–æ–ª–µ–µ –≥–∏–±–∫–æ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, —É—á–∏—Ç—ã–≤–∞—è —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã.\n                                            \\t- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤, –ø–æ–º–æ–≥–∞—è —É—á–µ–Ω–∏–∫–∞–º –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —É—Å–ø–µ—Ö–æ–≤ –≤ –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫–æ–≤.\\n\n                                            –° –Ω–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É—á–∏—Ç—å –∏ –ª–µ–≥–∫–æ —É—á–∏—Ç—å—Å—è!\\n\n                                            –° —É–≤–∞–∂–µ–Ω–∏–µ–º, \n                                            –ö–æ–º–∞–Ω–¥–∞ EasyLexLab`\n                                    };\n                                    transporter.sendMail(HelperOptions, (error, info) => {\n                                        if (error) {\n                                            console.log(error);\n                                        } else {\n                                            return res.json({ success: true })\n                                        }\n                                    });\n                                }\n                                return res.status(200).json({\n                                    success: true,\n                                    userId: newUser._id\n                                });\n                            }).catch(err => {\n                                res.status(500).json({\n                                    message: err\n                                });\n                            });\n                        });\n                    } else {\n                        const user = new db.User({\n                            firstName,\n                            lastName,\n                            username,\n                            email,\n                            password,\n                            permissions,\n                            _groups: [],\n                            school,\n                            city\n                        });\n                        user.save().then(newUser => {\n                          let transporter = nodemailer.createTransport({\n                            service: 'gmail',\n                            secure: false,\n                            port: 25,\n                            auth: {\n                              user: 'easylexlab@gmail.com',\n                              pass: '45aCRawa@hut'\n                            },\n                            tls: {\n                              rejectUnauthorized: false\n                            }\n                          });\n                          if (newUser.permissions == 'student') {\n                              let HelperOptions = {\n                                  from: '\"EasyLexLab\" <easylexlab@gmail.com>',\n                                  to: newUser.email,\n                                  // to: 'easylexlab@gmail.com',\n                                  subject: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ EasyLexLab',\n                                  text:\n                                    `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${newUser.firstName} ${newUser.lastName}!\\n\n                                    –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ —Ç–æ, —á—Ç–æ –≤—ã —Å—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º EasyLexLab!\\n\n                                    –õ–æ–≥–∏–Ω: ${newUser.username}\n                                    –ü–∞—Ä–æ–ª—å: ${password}\\n\n                                    EasyLexLab ‚Äì —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π –∏ —É—á–µ–Ω–∏–∫–æ–≤, –∏–∑—É—á–∞—é—â–∏—Ö —è–∑—ã–∫–∏.\\n\n                                    EasyLexLab –º–æ–∂–µ—Ç –í–∞–º –ø–æ–º–æ—á—å:\\n\n                                    \\t- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –§–ì–û–°.\n                                    \\t- –ü—Ä–æ–≤–æ–¥–∏—Ç—å —É—Ä–æ–∫–∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è –∏ —É—Å–≤–æ–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω –∑–∞ —Ä–∞–º–∫–∏ —É—Ä–æ–∫–∞ (–¥–µ—Ç–∏ –¥–µ–ª–∞—é—Ç –≤—Å–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –¥–æ–º–∞).\n                                    \\t- –ë–æ–ª–µ–µ –≥–∏–±–∫–æ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, —É—á–∏—Ç—ã–≤–∞—è —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã.\n                                    \\t- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤, –ø–æ–º–æ–≥–∞—è —É—á–µ–Ω–∏–∫–∞–º –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —É—Å–ø–µ—Ö–æ–≤ –≤ –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫–æ–≤.\\n\n                                    –° –Ω–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É—á–∏—Ç—å –∏ –ª–µ–≥–∫–æ —É—á–∏—Ç—å—Å—è!\\n\n                                    –° —É–≤–∞–∂–µ–Ω–∏–µ–º, \n                                    –ö–æ–º–∞–Ω–¥–∞ EasyLexLab`\n                              };\n                              transporter.sendMail(HelperOptions, (error, info) => {\n                                  if (error) {\n                                      console.log(error);\n                                  } else {\n                                      return res.json({ success: true })\n                                  }\n                              });\n                          } else if (newUser.permissions == 'teacher') {\n                              let HelperOptions = {\n                                  from: '\"EasyLexLab\" <easylexlab@gmail.com>',\n                                  to: newUser.email,\n                                  // to: 'easylexlab@gmail.com',\n                                  subject: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ EasyLexLab',\n                                  text:\n                                    `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${newUser.firstName} ${newUser.lastName}!\\n \n                                    –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ —Ç–æ, —á—Ç–æ –≤—ã —Å—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º EasyLexLab!\\n\n                                    –õ–æ–≥–∏–Ω: ${newUser.username}\n                                    –ü–∞—Ä–æ–ª—å: ${password}\\n\n                                    EasyLexLab ‚Äì —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π –∏ —É—á–µ–Ω–∏–∫–æ–≤, –∏–∑—É—á–∞—é—â–∏—Ö —è–∑—ã–∫–∏.\\n\n                                    EasyLexLab –º–æ–∂–µ—Ç –í–∞–º –ø–æ–º–æ—á—å:\\n\n                                    \\t- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –§–ì–û–°.\n                                    \\t- –ü—Ä–æ–≤–æ–¥–∏—Ç—å —É—Ä–æ–∫–∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è –∏ —É—Å–≤–æ–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω –∑–∞ —Ä–∞–º–∫–∏ —É—Ä–æ–∫–∞ (–¥–µ—Ç–∏ –¥–µ–ª–∞—é—Ç –≤—Å–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –¥–æ–º–∞).\n                                    \\t- –ë–æ–ª–µ–µ –≥–∏–±–∫–æ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –∏–∑—É—á–µ–Ω–∏—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, —É—á–∏—Ç—ã–≤–∞—è —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã.\n                                    \\t- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤, –ø–æ–º–æ–≥–∞—è —É—á–µ–Ω–∏–∫–∞–º –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —É—Å–ø–µ—Ö–æ–≤ –≤ –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫–æ–≤.\\n\n                                    –° –Ω–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É—á–∏—Ç—å –∏ –ª–µ–≥–∫–æ —É—á–∏—Ç—å—Å—è!\\n\n                                    –° —É–≤–∞–∂–µ–Ω–∏–µ–º,\n                                    –ö–æ–º–∞–Ω–¥–∞ EasyLexLab`\n                              };\n                              transporter.sendMail(HelperOptions, (error, info) => {\n                                  if (error) {\n                                      console.log(error);\n                                  } else {\n                                      return res.json({ success: true })\n                                  }\n                              });\n                          }\n                          return res.status(200).json({\n                                success: true,\n                                userId: newUser._id\n                            });\n                        }).catch(err => {\n                            res.status(500).json({\n                                message: err\n                            });\n                        });\n                    }\n                }\n            });\n        }\n    });\n};\n\nuserController.login = (req, res) => {\n    const { username, password } = req.body;\n\n    db.User.findOne({username}).then(user => {\n        user.verifyPassword(password).then(valid => {\n            if (valid) {\n                const token = jwt.sign(\n                    {\n                        id: user._id,\n                        permissions: user.permissions\n                    },\n                    secret\n                );\n                res.status(200).json({\n                    success: valid,\n                    token\n                });\n            } else {\n                res.status(200).json({\n                    success: valid\n                });\n            }\n        }).catch(err => {\n            res.status(500).json({\n                message: err\n            });\n        });\n    }).catch((err) => {\n        res.status(500).json({\n            message: err\n        });\n    });\n};\n\nuserController.getGroups = (req, res) => {\n    const user = req.user;\n    const groupId = req.body.groupId;\n    if (user.permissions == 'student' || user.permissions == 'teacher') {\n        db.Group.findById(groupId).then(group => {\n            res.json({\n                group\n            });\n        }).catch(err => {\n            res.status(500).json({\n                message: err\n            });\n        });\n    }\n};\n\nuserController.updateInfo = (req, res) => {\n    const myUser = req.user;\n    const {\n      firstName,\n      lastName,\n      username\n    } = req.body;\n\n    const query = {};\n\n    if(firstName)\n      query.firstName = firstName;\n    if(lastName)\n      query.lastName = lastName;\n    if(username)\n      query.username = username;\n    else if (!firstName && !lastName) {\n        return res.json({\n            changed: false\n        });\n    }\n\n    if(query.username) {\n        db.User.findOne({ username: query.username }).then(user => {\n          if(user)\n            return res.json({error: '–î–∞–Ω–Ω—ã–π –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç'});\n          else {\n            db.User.findByIdAndUpdate(myUser.id, {\n                $set: query\n            }).then(user => {\n                return res.json({\n                    success: true\n                });\n            }).catch(err => {\n                return res.status(500).json({\n                    message: err\n                });\n            });\n          }\n        })\n    } else {\n      db.User.findByIdAndUpdate(myUser.id, {\n          $set: query\n      }).then(user => {\n          return res.json({\n              success: true\n          });\n      }).catch(err => {\n          return res.status(500).json({\n              message: err\n          });\n      });\n    }\n};\n\nuserController.verifyPassword = (req, res) => {\n    const user = req.user;\n    const password = req.body.password;\n    db.User.findById(user.id).then(myUser => {\n        myUser.verifyPassword(password).then(valid => {\n            return res.json({ success: valid });\n        }).catch(err => {\n            res.status(500).json({\n                message: err\n            });\n        });\n    }).catch(err => {\n        res.status(500).json({\n            message: err\n        });\n    });\n};\n\nuserController.changePassword = (req, res) => {\n    const user = req.user;\n    const newPassword = req.body.newPassword;\n\n    db.User.findByIdAndUpdate(user.id, {$set: {password: newPassword, recoverToken: ''}})\n        .then(myUser => {\n            return res.json({success: true});\n        }).catch((err) => {\n          return res.status(500).json({\n            message: err\n        });\n    });\n};\n\nuserController.addGroup = (req, res) => {\n    const groupCode = req.body.groupCode;\n    const user = req.user;\n\n    db.Group.findOneAndUpdate({ code: groupCode },\n    { $push: {'_students': user.id} }).then(group => {\n        db.User.findByIdAndUpdate(\n            user.id,\n            { $push: {'_groups': group._id }}).then(myUser => {\n            res.json({ success: true });\n        }).catch(err => {\n            res.status(500).json({\n                body: err\n            });\n        });\n    }).catch(err => {\n      res.status(500).json({\n           body: err\n      });\n    });\n};\n\n\nuserController.getNotifications = (req, res) => {\n    const user = req.user;\n\n    db.User.findById(user.id).then(myUser => {\n        res.json({ notifications: myUser.notifications });\n    }).catch((err) => {\n        res.status(500).json({\n            message: err\n        });\n    });\n};\n\nuserController.removeNotification = (req, res) => {\n    const user = req.user;\n    const id = req.body.id;\n\n    db.User.findById(user.id).then(myUser => {\n        myUser.notifications = myUser.notifications.filter(notif => notif.id != id);\n        let notificationsCopy = myUser.notifications;\n        myUser.save();\n        res.json({ suc—Åess: true, notifications: notificationsCopy });\n    }).catch((err) => {\n        res.status(500).json({\n            message: err\n        });\n    });\n};\n\nuserController.getUser = (req, res) => {\n    const user = req.user;\n\n    db.User.findById(user.id)\n        .populate({\n            path: '_groups',\n            model: 'Group',\n            populate: {\n                path: '_tests',\n                model: 'Stack'\n            }\n        })\n        .then(user => {\n          return res.json({ user })\n        });\n};\n\nuserController.learnWords = (req, res) => {\n  const user = req.user;\n  const {\n    amount,\n    stackId,\n    userResult,\n    pairsLength\n  } = req.body;\n\n  db.Stack.findById(stackId).then(stack => {\n    let result = stack.results.filter(result => result.userId == user.id);\n    if(result[0]) {\n      let difference = Math.abs(result[0].result - userResult);\n      let newAmount = Math.round(pairsLength * (difference / 100));\n      db.User.findByIdAndUpdate(user.id, { $inc: { wordsLearnt: newAmount } }).then(success => {\n        return res.json({ wordsLearnt: newAmount });\n      })\n    } else {\n      db.User.findByIdAndUpdate(user.id, { $inc: { wordsLearnt: amount } }).then(success => {\n        return res.json({ wordsLearnt: amount, firstTime: true });\n      })\n    }\n  })\n};\n\nuserController.recoverPassword = (req, res) => {\n  const email = req.body.email;\n\n  db.User.findOne({ email }).then(user => {\n    if(!user) {\n      return res.json({ success: false })\n    }\n    const token = jwt.sign(\n      {\n        id: user._id,\n        email\n      },\n      secret\n    );\n    let uri = encodeURI(token);\n    user.recoverToken = token;\n    user.save().then(res => {\n      let transporter = nodemailer.createTransport({\n        service: 'gmail',\n        secure: false,\n        port: 25,\n        auth: {\n          user: 'easylexlab@gmail.com',\n          pass: '45aCRawa@hut'\n        },\n        tls: {\n          rejectUnauthorized: false\n        }\n      });\n      let HelperOptions = {\n        from: '\"EasyLexLab\" <easylexlab@gmail.com>',\n        to: user.email,\n        // to: 'easylexlab@gmail.com',\n        subject: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è',\n        text: \n        `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${user.firstName + ' ' + user.lastName}!\n        \n        –ß—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —ç—Ç–æ–π —Å—Å—ã–ª–∫–µ:\n        easylexlab.ru/recover/${token}\n        \n        –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ URL-–∞–¥—Ä–µ—Å –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –±—Ä–∞—É–∑–µ—Ä.\n\n        –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n\n        –° —É–≤–∞–∂–µ–Ω–∏–µ–º, \n        –ö–æ–º–∞–Ω–¥–∞ EasyLexLab`\n      };\n      transporter.sendMail(HelperOptions, (error, info) => {\n        if(error) {\n          console.log(error);\n        } else {\n          return res.json({ success: true })\n        }\n      });\n    });\n  })\n};\n\nuserController.checkToken = (req, res) => {\n  const token = req.body.token;\n  db.User.findOne({ recoverToken: token }).then(user => {\n    if(user) {\n      return res.json({ success: true });\n    }\n    return res.json({ success: false });\n  });\n};\n\nuserController.sendFeedback = (req, res) => {\n  const user = req.user;\n  const {\n    name,\n    text,\n    email\n  } = req.body;\n\n  let transporter = nodemailer.createTransport({\n    service: 'gmail',\n    secure: false,\n    port: 25,\n    auth: {\n      user: 'easylexlab@gmail.com',\n      pass: '45aCRawa@hut'\n    },\n    tls: {\n      rejectUnauthorized: false\n    }\n  });\n  let HelperOptions = {\n    from: `${name} <${email}>`,\n    to: 'easylexlab@gmail.com',\n    subject: '–û—Ç–∑—ã–≤',\n    text: `${name}: ${text}\\n${email}`\n  };\n  transporter.sendMail(HelperOptions, (error, info) => {\n    if(error) {\n      console.log(error);\n    } else {\n      return res.json({ success: true })\n    }\n  });\n};\n\nuserController.leaveGroup = (req, res) => {\n    const user = req.user;\n    const groupId = req.body.groupId;\n    db.User.findById(user.id).then(myUser => {\n        myUser._groups = myUser._groups.filter(group => group != groupId);\n        console.log(myUser._groups);\n        myUser.save().then(success => {\n            res.json({\n                success: true\n            })\n        })\n    })\n}\n\nuserController.getAvatar = (req, res) => {\n    const user = req.user;\n    const picName = req.body.picName;\n    var filePath = `uploads/${picName}`;\n    if(user && picName) {\n        fs.exists(filePath, exists => {\n            if(exists) {\n                fs.readFile(filePath, { encoding: \"base64\" }, (err, data) => {\n                    if (err) {\n                        console.log(err)\n                    }\n                    let ext = path.extname(filePath);\n                    // res.writeHead(200, { 'Content-Type': `image/${ext}` })\n                    // res.end(data, 'binary');\n                    return res.json({\n                        img: data,\n                        ext\n                    })\n                })\n            }\n        });\n    }\n}\n\nexport default userController;\n"]}